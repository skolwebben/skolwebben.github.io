<!DOCTYPE html>
<html lang="sv">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Fysikquiz: Källkritik (Åk 9)</title>
   <!-- Importerar moderna fonter från Google Fonts -->
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  
   <style>
       :root {
           /* Färgpalett - Professionell & Ren */
           --card-bg: #ffffff;
          
           --brand-color: #2c3e50;
           --brand-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
          
           --accent-color: #3498db;
          
           --success-color: #10ac84;
           --success-bg: #e3f9f1;
          
           --error-color: #ee5253;
           --error-bg: #ffeded;
          
           --text-main: #2d3436;
           --text-muted: #636e72;
          
           --shadow-card: 0 10px 25px rgba(0,0,0,0.15);
           --shadow-hover: 0 6px 16px rgba(0,0,0,0.12);
           --radius-main: 16px;
       }


       body {
           font-family: 'Open Sans', sans-serif;
           /* Gråaktig fade (Silver/Metallic style) */
           background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
           color: var(--text-main);
           margin: 0;
           padding: 15px;
           display: flex;
           justify-content: center;
           align-items: flex-start;
           min-height: 100vh;
       }


       .container {
           background-color: var(--card-bg);
           width: 100%;
           max-width: 680px;
           border-radius: var(--radius-main);
           box-shadow: var(--shadow-card);
           overflow: hidden;
           display: flex;
           flex-direction: column;
           position: relative;
           margin-top: 3vh;
           margin-bottom: 3vh;
       }


       header {
           background: var(--brand-gradient);
           color: white;
           padding: 20px;
           text-align: center;
           position: relative;
           overflow: hidden;
       }


       h1 {
           font-family: 'Poppins', sans-serif;
           margin: 0;
           font-size: 1.5rem;
           font-weight: 700;
           letter-spacing: -0.3px;
       }


       .content-area {
           padding: 25px 30px;
           flex-grow: 1;
       }


       h2 {
           font-family: 'Poppins', sans-serif;
           color: var(--brand-color);
           margin-top: 0;
           font-size: 1.3rem;
           margin-bottom: 0.8rem;
           line-height: 1.3;
       }


       /* Fact Section Styles */
       .fact-box {
           background: #f8f9fa;
           border-radius: 12px;
           padding: 20px;
           margin-bottom: 20px;
           border-left: 4px solid var(--accent-color);
           display: flex;
           gap: 15px;
           align-items: flex-start;
       }
      
       .fact-icon {
           font-size: 2rem;
           display: block;
           margin-top: -5px;
       }
      
       .fact-content {
           flex: 1;
       }


       .btn {
           background: var(--brand-gradient);
           color: white;
           border: none;
           padding: 12px 24px;
           font-family: 'Poppins', sans-serif;
           font-size: 1rem;
           font-weight: 600;
           border-radius: 8px;
           cursor: pointer;
           transition: all 0.2s ease;
           display: block;
           width: 100%;
           margin-top: 20px;
           box-shadow: 0 4px 10px rgba(52, 152, 219, 0.2);
       }


       .btn:hover {
           transform: translateY(-2px);
           box-shadow: 0 6px 14px rgba(52, 152, 219, 0.3);
           opacity: 0.95;
       }


       /* Question Styles */
       .question-meta {
           display: inline-block;
           color: var(--text-muted);
           font-size: 0.85rem;
           margin-bottom: 10px;
           font-weight: 600;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }


       .options-grid {
           display: grid;
           gap: 12px;
           margin-top: 20px;
       }


       .option-btn {
           background-color: #fff;
           border: 2px solid #f1f2f6;
           padding: 15px 20px;
           text-align: left;
           border-radius: 10px;
           cursor: pointer;
           font-family: 'Open Sans', sans-serif;
           font-size: 0.95rem;
           font-weight: 500;
           transition: all 0.15s ease;
           color: var(--text-main);
           position: relative;
       }


       .option-btn:hover:not(:disabled) {
           border-color: var(--accent-color);
           background-color: #f8fcff;
           transform: translateX(3px);
           box-shadow: 0 2px 5px rgba(0,0,0,0.05);
       }
      
       /* Status states for options */
       .option-btn.correct {
           background-color: var(--success-bg);
           border-color: var(--success-color);
           color: #0b6e4f;
           font-weight: 600;
       }
      
       .option-btn.correct::after {
           content: "✓";
           position: absolute;
           right: 15px;
           font-weight: bold;
       }


       .option-btn.incorrect {
           background-color: var(--error-bg);
           border-color: var(--error-color);
           color: #c0392b;
           opacity: 0.8;
       }


       .option-btn:disabled {
           cursor: default;
       }


       /* Feedback Box */
       .feedback-box {
           margin-top: 20px;
           padding: 20px 25px;
           border-radius: 12px;
           background-color: #f8f9fa;
           color: var(--text-main);
           border: 1px solid #e9ecef;
           display: none;
           animation: fadeIn 0.3s ease;
       }
      
       .feedback-box h3 {
           margin-top: 0;
           font-family: 'Poppins', sans-serif;
           font-size: 1.2rem;
           display: flex;
           align-items: center;
           gap: 8px;
           margin-bottom: 8px;
       }


       .feedback-box.success h3 {
           color: var(--success-color);
       }
      
       .feedback-box.error h3 {
           color: var(--error-color);
       }


       .feedback-box strong {
           color: var(--brand-color);
       }


       @keyframes fadeIn {
           from { opacity: 0; transform: translateY(5px); }
           to { opacity: 1; transform: translateY(0); }
       }


       /* Progress Bar Styles */
       .progress-bar-container {
           height: 6px;
           background-color: #f1f3f5;
           width: 100%;
           position: relative;
           z-index: 10;
       }


       .progress-bar {
           height: 100%;
           background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
           width: 0%;
           transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
           border-radius: 0 4px 4px 0;
           box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
       }


       /* Summary Styles */
       .summary-stats {
           text-align: center;
           background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
           border: 1px solid #dee2e6;
           padding: 30px 20px;
           border-radius: 12px;
           margin-bottom: 20px;
       }


       .summary-score {
           font-size: 3.5rem;
           font-family: 'Poppins', sans-serif;
           font-weight: 700;
           display: block;
           margin: 5px 0;
           line-height: 1;
           background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
           -webkit-background-clip: text;
           -webkit-text-fill-color: transparent;
       }
      
       .summary-list {
           max-height: 400px;
           overflow-y: auto;
           padding-right: 10px;
       }
      
       .summary-item {
           background: white;
           border-bottom: 1px solid #f1f1f1;
           padding: 12px 0;
       }
      
       .summary-item:last-child {
           border-bottom: none;
       }


       .summary-question {
           font-weight: 600;
           margin-bottom: 4px;
           display: block;
           font-size: 0.95rem;
       }
      
       .summary-answer-row {
           font-size: 0.9rem;
       }


       .summary-correct-text { color: var(--success-color); font-weight: 600; }
       .summary-wrong-text { color: var(--error-color); text-decoration: line-through; opacity: 0.8;}
       .real-answer { color: var(--success-color); font-weight: 600; margin-left: 5px; }


       /* Helpers */
       strong {
           color: var(--brand-color);
           font-weight: 700;
       }


   </style>
</head>
<body>


<div class="container">
   <header>
       <h1 id="header-title">Fysikquiz: Källkritik</h1>
   </header>
   <div class="progress-bar-container">
       <div class="progress-bar" id="progress-bar"></div>
   </div>


   <div class="content-area" id="app">
       <!-- Content will be injected here by JavaScript -->
   </div>
</div>


<script>
   // --- DATA ---
   const quizData = [
       {
           title: "Del 1: Den vetenskapliga metoden",
           icon: "🔬",
           text: "Inom naturvetenskapen räcker det inte med att göra ett experiment en gång. För att ett resultat ska räknas som fakta måste det vara <strong>reproducerbart</strong>. Det betyder att om en annan forskare gör om exakt samma experiment, ska resultatet bli detsamma. För att veta vad som påverkar resultatet måste man ha <strong>variabelkontroll</strong>. Man ändrar bara en sak (den oberoende variabeln) och håller alla andra faktorer konstanta.",
           questions: [
               {
                   q: "Varför är det avgörande att forskare beskriver sin metod väldigt noggrant i sina rapporter?",
                   options: [
                       "För att bevisa att hypotesen är sann oavsett vad resultatet visar.",
                       "För att säkerställa att ingen annan forskare kan stjäla deras idéer.",
                       "För att andra forskare ska kunna upprepa försöket och verifiera resultatet.", // Rätt (Index 2)
                       "För att uppfylla de formella kraven på språklig korrekthet i vetenskapliga journaler."
                   ],
                   correct: 2,
                   explanation: "Inom vetenskapen är <strong>reproducerbarhet</strong> avgörande för trovärdigheten. Om en annan forskare inte kan följa instruktionerna och få samma resultat, betraktas upptäckten inte som fakta. Därför måste metoden beskrivas in i minsta detalj."
               },
               {
                   q: "Pelle ska testa om varmt vatten fryser snabbare än kallt. Han ställer en kopp varmt vatten i frysen och en hink kallt vatten utomhus. Vad är det största felet?",
                   options: [
                       "Han borde ha använt termometrar med högre precision för att se skillnaden.",
                       "Han borde ha upprepat försöket minst tio gånger för att få ett medelvärde.",
                       "Vattnets kemiska sammansättning ändras när det värms upp i mikron.",
                       "Han har inte isolerat variablerna, utan ändrat både mängd och plats samtidigt." // Rätt (Index 3)
                   ],
                   correct: 3,
                   explanation: "För att veta vad som påverkar frysningstiden måste man ha strikt <strong>variabelkontroll</strong>. Eftersom Pelle ändrade både vattenmängden och placeringen (frys vs utomhus) går det inte att veta vilken av faktorerna som orsakade resultatet."
               },
               {
                   q: "En forskare mäter spänningen i ett batteri fem gånger och får lite olika värden. Varför gör hen så många mätningar?",
                   options: [
                       "För att kalibrera mätinstrumentet så att det visar exakt rätt värde.",
                       "För att det är standard att alltid kasta bort de två första mätvärdena.",
                       "För att beräkna ett medelvärde och därmed minska inverkan av slumpmässiga fel.", // Rätt (Index 2)
                       "För att batteriets spänning fluktuerar kraftigt beroende på lufttrycket."
                   ],
                   correct: 2,
                   explanation: "Alla mätningar innehåller små slumpmässiga fel eller variationer. Genom att mäta flera gånger och beräkna ett <strong>medelvärde</strong> får forskaren ett resultat som ligger närmare det sanna värdet och ökar mätningens <strong>tillförlitlighet</strong>."
               }
           ]
       },
       {
           title: "Del 2: Källans syfte och jäv",
           icon: "⚖️",
           text: "När du granskar en källa måste du alltid titta på avsändaren och syftet. Är syftet att informera, sälja eller påverka? Om den som betalar för en studie tjänar pengar på ett visst resultat finns det risk för <strong>jäv</strong> (intressekonflikt). Myndigheter och universitet anses ofta mer trovärdiga än företag, eftersom deras uppdrag är att vara opartiska och tjäna allmänheten, inte att göra vinst.",
           questions: [
               {
                   q: "Du läser en artikel med rubriken 'Kärnkraft är den enda lösningen'. Vem av följande författare bör du vara mest kritisk mot?",
                   options: [
                       "En professor i energisystem vid Chalmers Tekniska Högskola.",
                       "En expertgrupp från FN:s internationella klimatpanel (IPCC).",
                       "En oberoende vetenskapsjournalist på tidningen Forskning & Framsteg.",
                       "VD:n för ett bolag som tillverkar och säljer kärnreaktorer." // Rätt (Index 3)
                   ],
                   correct: 3,
                   explanation: "VD:n har ett tydligt <strong>ekonomiskt intresse</strong> (vinstsyfte) av att kärnkraften framställs positivt. Detta skapar en situation av <strong>jäv</strong>, vilket innebär att informationen kan vara vinklad för att gynna företaget snarare än att vara objektiv."
               },
               {
                   q: "Varför anses Strålsäkerhetsmyndigheten ofta vara en mer trovärdig källa än privata teknikföretag?",
                   options: [
                       "För att det är en statlig myndighet med uppdrag att objektivt skydda allmänheten.", // Rätt (Index 0)
                       "För att de har störst budget av alla aktörer på den svenska telekommarknaden.",
                       "För att de säljer utrustning som skyddar privatpersoner mot farlig strålning.",
                       "För att de sponsras av de stora mobiltillverkarna för att lugna folket."
                   ],
                   correct: 0,
                   explanation: "Myndigheter som Strålsäkerhetsmyndigheten har inget vinstintresse utan arbetar på uppdrag av regeringen. Deras syfte är att vara <strong>objektiva</strong> och se till medborgarnas säkerhet, vilket oftast gör dem mer trovärdiga än företag som vill sälja produkter."
               }
           ]
       },
       {
           title: "Del 3: Korrelation och Kausalitet",
           icon: "📈",
           text: "Ett vanligt misstag är att blanda ihop <strong>korrelation</strong> (samband) med <strong>kausalitet</strong> (orsak). Bara för att två kurvor följs åt betyder det inte att den ena orsakar den andra. Det kan vara en slump eller en tredje faktor som påverkar båda. Exempel: Glassförsäljning och drunkningsolyckor ökar samtidigt på sommaren, men glass orsakar inte drunkning. Den bakomliggande faktorn är värmen.",
           questions: [
               {
                   q: "En studie visar att barn med större fötter är bättre på fysik än barn med små fötter. Vad är den troligaste förklaringen?",
                   options: [
                       "Det finns ett biologiskt samband där fötternas nervbanor stimulerar hjärnan.",
                       "Det är ett skensamband där en tredje faktor, barnets ålder, påverkar både fotstorlek och kunskap.", // Rätt (Index 1)
                       "Resultatet är troligen en slump eftersom studier på barn alltid är osäkra.",
                       "Barn med stora fötter rör sig mer och får därmed mer syre till hjärnan."
                   ],
                   correct: 1,
                   explanation: "Detta är ett klassiskt exempel på att <strong>korrelation</strong> (samband) inte innebär <strong>kausalitet</strong> (orsak). Äldre barn har naturligtvis större fötter än yngre barn, och de har också hunnit lära sig mer fysik i skolan."
               },
               {
                   q: "Hur kan forskare ta reda på om mobilstrålning faktiskt orsakar huvudvärk, och inte bara råkar sammanfalla med det?",
                   options: [
                       "Genom att samla in tusentals anekdoter från personer som upplever besvär.",
                       "Genom ett kontrollerat blindtest där försökspersonerna inte vet om strålningen är på eller av.", // Rätt (Index 1)
                       "Genom att jämföra huvudvärksfrekvensen i länder med och utan 5G-nät.",
                       "Genom att mäta strålningen från alla master i en storstad under ett dygn."
                   ],
                   correct: 1,
                   explanation: "För att utesluta placeboeffekten (att man får ont för att man *tror* att man utsätts för strålning) krävs ett <strong>blindtest</strong>. Endast genom att isolera variabeln i en kontrollerad miljö kan man fastställa om det finns ett verkligt orsakssamband."
               }
           ]
       },
       {
           title: "Del 4: Granskning & Pseudovetenskap",
           icon: "🕵️‍♀️",
           text: "Vetenskapliga studier granskas alltid av andra experter innan de publiceras. Detta kallas <strong>Peer-review</strong> (fackgranskning) och är ett kvalitetsfilter. <strong>Pseudovetenskap</strong> är sådant som låter som vetenskap men inte följer metoderna. Varningstecken är anekdoter ('Det funkade för mig!'), löften om mirakellösningar, konspirationsteorier och felaktig användning av svåra ord (t.ex. 'kvant-energi').",
           questions: [
               {
                   q: "Vad innebär begreppet 'Peer-review' (fackgranskning) inom forskarvärlden?",
                   options: [
                       "Att oberoende experter granskar studien för att hitta fel innan den publiceras.", // Rätt (Index 0)
                       "Att studien publiceras i en dagstidning för att nå så många som möjligt.",
                       "Att forskaren betalar en avgift för att garantera att resultatet sprids.",
                       "Att allmänheten får rösta om forskningsresultatet verkar rimligt."
                   ],
                   correct: 0,
                   explanation: "<strong>Peer-review</strong> (fackgranskning) fungerar som vetenskapens kvalitetsfilter. Oberoende experter kontrollerar metoder och slutsatser för att sålla bort fusk och misstag innan studien får publiceras i en vetenskaplig tidskrift."
               },
               {
                   q: "Du ser en annons för ett 'Energi-halsband'. Vilken text är en tydlig varningssignal för pseudovetenskap?",
                   options: [
                       "Produkten har genomgått tester som inte visat någon mätbar effekt.",
                       "Det finns en tydlig innehållsförteckning över materialen i halsbandet.",
                       "Annonsen hänvisar till publicerade studier i välkända vetenskapliga tidskrifter.",
                       "Påståenden om att 'läkemedelsindustrin tystar ner denna hemliga mirakelmetod'." // Rätt (Index 3)
                   ],
                   correct: 3,
                   explanation: "Typiska tecken på <strong>pseudovetenskap</strong> är konspirationsteorier om att etablerad vetenskap 'mörkar' sanningen. Även löften om mirakellösningar och användning av vagt vetenskapliga ord som 'kvantenergi' utan förklaring är varningssignaler."
               },
               {
                   q: "Vilken typ av källa väger tyngst om du ska skriva ett arbete om klimatförändringar?",
                   options: [
                       "En rapport från FN:s klimatpanel (IPCC) som sammanställer tusentals granskade studier.", // Rätt (Index 0)
                       "En nysläppt forskningsrapport som ännu inte har genomgått fackgranskning.",
                       "En dokumentärfilm som intervjuar flera engagerade privatpersoner.",
                       "En debattartikel skriven av en känd miljöaktivist i en stor tidning."
                   ],
                   correct: 0,
                   explanation: "En sammanställning av många studier, en så kallad <strong>meta-analys</strong> eller expertrapport (som IPCC), väger tyngre än enskilda studier. Den visar vad den samlade vetenskapen säger, snarare än vad en enskild forskare eller åsikt har kommit fram till."
               }
           ]
       }
   ];


   // --- STATE MANAGEMENT ---
   let currentSectionIndex = 0;
   let currentQuestionIndex = 0; // Relative to current section
   let score = 0;
   let userAnswers = [];
   let state = 'intro'; // 'intro', 'question', 'summary'


   // --- DOM ELEMENTS ---
   const app = document.getElementById('app');
   const headerTitle = document.getElementById('header-title');
   const progressBar = document.getElementById('progress-bar');


   // --- MAIN RENDER FUNCTION ---
   function render() {
       if (state === 'summary') {
           renderSummary();
           return;
       }


       const section = quizData[currentSectionIndex];


       // Update Header with smooth fade
       headerTitle.style.opacity = '0';
       setTimeout(() => {
           headerTitle.innerText = section.title;
           headerTitle.style.transition = 'opacity 0.2s';
           headerTitle.style.opacity = '1';
       }, 150);


       // Calculate total progress
       let totalQuestions = 0;
       let answeredQuestions = 0;
      
       quizData.forEach((sec, idx) => {
           totalQuestions += sec.questions.length;
           if (idx < currentSectionIndex) {
               answeredQuestions += sec.questions.length;
           } else if (idx === currentSectionIndex && state === 'question') {
               answeredQuestions += currentQuestionIndex;
           }
       });
       const pct = (answeredQuestions / totalQuestions) * 100;
       progressBar.style.width = `${pct}%`;


       if (state === 'intro') {
           renderSectionIntro(section);
       } else if (state === 'question') {
           renderQuestion(section.questions[currentQuestionIndex]);
       }
   }


   // --- RENDER SECTION TEXT ---
   function renderSectionIntro(section) {
       // Simple animation class reset
       app.classList.remove('fade-in');
       void app.offsetWidth; // trigger reflow
       app.classList.add('fade-in');


       app.innerHTML = `
           <div class="fact-box">
               <span class="fact-icon">${section.icon}</span>
               <div class="fact-content">
                   <h2>Fakta</h2>
                   <p style="line-height: 1.6; font-size: 1rem; margin-top:0;">${section.text}</p>
               </div>
           </div>
           <button class="btn" onclick="startQuestions()">Starta frågor för denna del</button>
       `;
   }


   // --- RENDER QUESTION ---
   function renderQuestion(q) {
       const totalInCurrent = quizData[currentSectionIndex].questions.length;
      
       // Render with reset styles for feedback box
       app.innerHTML = `
           <div class="question-meta">Del ${currentSectionIndex + 1} • Fråga ${currentQuestionIndex + 1}/${totalInCurrent}</div>
           <h2 style="color: #2c3e50; font-weight: 600; margin-bottom:15px;">${q.q}</h2>
           <div class="options-grid">
               ${q.options.map((opt, idx) => `
                   <button class="option-btn" onclick="handleAnswer(${idx})" id="opt-${idx}">${opt}</button>
               `).join('')}
           </div>
           <div id="feedback" class="feedback-box">
               <h3 id="feedback-title"></h3>
               <p id="feedback-text" style="margin: 5px 0 15px 0; font-size: 0.95rem; line-height: 1.6;"></p>
               <button class="btn" id="next-btn" onclick="nextStep()" style="margin-top:0; width: auto; min-width: 150px;">Nästa fråga ➔</button>
           </div>
       `;
   }


   // --- RENDER SUMMARY ---
   function renderSummary() {
       headerTitle.innerText = "Sammanfattning";
       progressBar.style.width = '100%';
      
       let totalQ = 0;
       quizData.forEach(s => totalQ += s.questions.length);
      
       // Calculate score
       let correctCount = userAnswers.filter(a => a.isCorrect).length;
       let pct = Math.round((correctCount / totalQ) * 100);
      
       let gradeTitle = "";
      
       if(pct > 90) { gradeTitle = "Fantastiskt bra! 🏆"; }
       else if(pct > 70) { gradeTitle = "Mycket bra jobbat! 🌟"; }
       else if(pct > 50) { gradeTitle = "Godkänt! 👍"; }
       else { gradeTitle = "Fortsätt kämpa! 💪"; }


       let html = `
           <div class="summary-stats">
               <h2 style="color:var(--brand-color); margin:0 0 10px 0;">${gradeTitle}</h2>
               <span class="summary-score">${correctCount}/${totalQ}</span>
               <span style="color:#666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Rätt svar</span>
               <button class="btn" onclick="location.reload()" style="background: transparent; border: 2px solid var(--accent-color); color: var(--accent-color); margin-top: 20px; box-shadow:none; width: auto; padding: 10px 30px;">Gör om testet</button>
           </div>
           <h3 style="margin: 0 0 10px 0; font-size: 1.1rem; color: var(--text-muted);">Dina svar:</h3>
           <div class="summary-list">
       `;


       userAnswers.forEach((ans, idx) => {
           const isCorrect = ans.isCorrect;
          
           html += `
               <div class="summary-item">
                   <span class="summary-question">${idx + 1}. ${ans.question}</span>
                   <div class="summary-answer-row">
                       ${isCorrect
                           ? `<span class="summary-correct-text">✔ ${ans.userAnswer}</span>`
                           : `<span class="summary-wrong-text">✖ ${ans.userAnswer}</span> <span style="margin: 0 5px; color:#999;">➔</span> <span class="real-answer">${ans.correctAnswer}</span>`
                       }
                   </div>
               </div>
           `;
       });


       html += `</div>`;
       app.innerHTML = html;
   }


   // --- LOGIC FUNCTIONS ---
   window.startQuestions = function() {
       state = 'question';
       currentQuestionIndex = 0;
       render();
   };


   window.handleAnswer = function(selectedIndex) {
       // Disable all buttons
       const buttons = document.querySelectorAll('.option-btn');
       buttons.forEach(b => b.disabled = true);


       const section = quizData[currentSectionIndex];
       const currentQ = section.questions[currentQuestionIndex];
       const isCorrect = selectedIndex === currentQ.correct;


       // Visual feedback on buttons
       const selectedBtn = document.getElementById(`opt-${selectedIndex}`);
       const correctBtn = document.getElementById(`opt-${currentQ.correct}`);


       if (isCorrect) {
           selectedBtn.classList.add('correct');
       } else {
           selectedBtn.classList.add('incorrect');
           correctBtn.classList.add('correct'); // Show which one was right
       }


       // Show feedback box
       const feedbackBox = document.getElementById('feedback');
       const feedbackTitle = document.getElementById('feedback-title');
       const feedbackText = document.getElementById('feedback-text');
       const nextBtn = document.getElementById('next-btn');


       feedbackBox.style.display = 'block';
      
       // Add class for success/error styling
       if (isCorrect) {
           feedbackBox.className = "feedback-box success";
           feedbackTitle.innerHTML = "Rätt svar!";
       } else {
           feedbackBox.className = "feedback-box error";
           feedbackTitle.innerHTML = "Inte riktigt...";
       }
      
       feedbackText.innerHTML = currentQ.explanation; // Use innerHTML to render <strong> tags


       // Check if last question of entire quiz
       const isLastQuestionOverall = (currentSectionIndex === quizData.length - 1) && (currentQuestionIndex === section.questions.length - 1);
      
       if(isLastQuestionOverall) {
           nextBtn.innerText = "Se resultat 🏁";
       } else if (currentQuestionIndex === section.questions.length - 1) {
           nextBtn.innerText = "Nästa del ➔";
       }


       // Scroll to feedback if needed on mobile, but gently
       const rect = feedbackBox.getBoundingClientRect();
       const isVisible = (rect.top >= 0) && (rect.bottom <= window.innerHeight);
       if (!isVisible) {
           setTimeout(() => {
               feedbackBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
           }, 100);
       }


       // Save data
       userAnswers.push({
           question: currentQ.q,
           userAnswer: currentQ.options[selectedIndex],
           correctAnswer: currentQ.options[currentQ.correct],
           isCorrect: isCorrect
       });
   };


   window.nextStep = function() {
       const section = quizData[currentSectionIndex];
      
       // Reset feedback styles for next render
       const feedbackBox = document.getElementById('feedback');
       if(feedbackBox) {
           feedbackBox.style.display = 'none';
       }


       // Check if there are more questions in this section
       if (currentQuestionIndex < section.questions.length - 1) {
           currentQuestionIndex++;
           render();
       } else {
           // End of section, move to next section
           if (currentSectionIndex < quizData.length - 1) {
               currentSectionIndex++;
               state = 'intro';
               render();
           } else {
               // End of quiz
               state = 'summary';
               render();
           }
       }
   };


   // --- INIT ---
   render();


</script>


</body>
</html>