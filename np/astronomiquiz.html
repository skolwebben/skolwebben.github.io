<!DOCTYPE html>
<html lang="sv">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Fysikquiz: Astronomi (Åk 9)</title>
   <!-- Importerar moderna fonter från Google Fonts -->
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  
   <style>
       :root {
           /* Färgpalett - Professionell & Ren */
           --card-bg: #ffffff;
          
           --brand-color: #2c3e50;
           --brand-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
          
           --accent-color: #3498db;
          
           --success-color: #10ac84;
           --success-bg: #e3f9f1;
          
           --error-color: #ee5253;
           --error-bg: #ffeded;
          
           --text-main: #2d3436;
           --text-muted: #636e72;
          
           --shadow-card: 0 10px 25px rgba(0,0,0,0.15);
           --shadow-hover: 0 6px 16px rgba(0,0,0,0.12);
           --radius-main: 16px;
       }


       body {
           font-family: 'Open Sans', sans-serif;
           /* Gråaktig fade (Silver/Metallic style) */
           background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
           color: var(--text-main);
           margin: 0;
           padding: 15px;
           display: flex;
           justify-content: center;
           align-items: flex-start;
           min-height: 100vh;
       }


       .container {
           background-color: var(--card-bg);
           width: 100%;
           max-width: 680px;
           border-radius: var(--radius-main);
           box-shadow: var(--shadow-card);
           overflow: hidden;
           display: flex;
           flex-direction: column;
           position: relative;
           margin-top: 3vh;
           margin-bottom: 3vh;
       }


       header {
           background: var(--brand-gradient);
           color: white;
           padding: 20px;
           text-align: center;
           position: relative;
           overflow: hidden;
       }


       h1 {
           font-family: 'Poppins', sans-serif;
           margin: 0;
           font-size: 1.5rem;
           font-weight: 700;
           letter-spacing: -0.3px;
       }


       .content-area {
           padding: 25px 30px;
           flex-grow: 1;
       }


       h2 {
           font-family: 'Poppins', sans-serif;
           color: var(--brand-color);
           margin-top: 0;
           font-size: 1.3rem;
           margin-bottom: 0.8rem;
           line-height: 1.3;
       }


       /* Fact Section Styles */
       .fact-box {
           background: #f8f9fa;
           border-radius: 12px;
           padding: 20px;
           margin-bottom: 20px;
           /* Ingen border-left */
           display: flex;
           gap: 15px;
           align-items: flex-start;
       }
      
       .fact-icon {
           font-size: 2rem;
           display: block;
           margin-top: -5px;
       }
      
       .fact-content {
           flex: 1;
       }


       .btn {
           background: var(--brand-gradient);
           color: white;
           border: none;
           padding: 12px 24px;
           font-family: 'Poppins', sans-serif;
           font-size: 1rem;
           font-weight: 600;
           border-radius: 8px;
           cursor: pointer;
           transition: all 0.2s ease;
           display: block;
           width: 100%;
           margin-top: 20px;
           box-shadow: 0 4px 10px rgba(52, 152, 219, 0.2);
       }


       .btn:hover {
           transform: translateY(-2px);
           box-shadow: 0 6px 14px rgba(52, 152, 219, 0.3);
           opacity: 0.95;
       }


       /* Question Styles */
       .question-meta {
           display: inline-block;
           color: var(--text-muted);
           font-size: 0.85rem;
           margin-bottom: 10px;
           font-weight: 600;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }


       .options-grid {
           display: grid;
           gap: 12px;
           margin-top: 20px;
       }


       .option-btn {
           background-color: #fff;
           border: 2px solid #f1f2f6;
           padding: 15px 20px;
           text-align: left;
           border-radius: 10px;
           cursor: pointer;
           font-family: 'Open Sans', sans-serif;
           font-size: 0.95rem;
           font-weight: 500;
           transition: all 0.15s ease;
           color: var(--text-main);
           position: relative;
       }


       .option-btn:hover:not(:disabled) {
           border-color: var(--accent-color);
           background-color: #f8fcff;
           transform: translateX(3px);
           box-shadow: 0 2px 5px rgba(0,0,0,0.05);
       }
      
       /* Status states for options */
       .option-btn.correct {
           background-color: var(--success-bg);
           border-color: var(--success-color);
           color: #0b6e4f;
           font-weight: 600;
       }
      
       .option-btn.correct::after {
           content: "✓";
           position: absolute;
           right: 15px;
           font-weight: bold;
       }


       .option-btn.incorrect {
           background-color: var(--error-bg);
           border-color: var(--error-color);
           color: #c0392b;
           opacity: 0.8;
       }


       .option-btn:disabled {
           cursor: default;
       }


       /* Feedback Box */
       .feedback-box {
           margin-top: 20px;
           padding: 20px 25px;
           border-radius: 12px;
           background-color: #f8f9fa;
           color: var(--text-main);
           border: 1px solid #e9ecef;
           display: none;
           animation: fadeIn 0.3s ease;
       }
      
       .feedback-box h3 {
           margin-top: 0;
           font-family: 'Poppins', sans-serif;
           font-size: 1.2rem;
           display: flex;
           align-items: center;
           gap: 8px;
           margin-bottom: 8px;
       }


       .feedback-box.success h3 {
           color: var(--success-color);
       }
      
       .feedback-box.error h3 {
           color: var(--error-color);
       }


       .feedback-box strong {
           color: var(--brand-color);
       }


       @keyframes fadeIn {
           from { opacity: 0; transform: translateY(5px); }
           to { opacity: 1; transform: translateY(0); }
       }


       /* Progress Bar Styles */
       .progress-bar-container {
           height: 6px;
           background-color: #f1f3f5;
           width: 100%;
           position: relative;
           z-index: 10;
       }


       .progress-bar {
           height: 100%;
           background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
           width: 0%;
           transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
           border-radius: 0 4px 4px 0;
           box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
       }


       /* Summary Styles */
       .summary-stats {
           text-align: center;
           background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
           border: 1px solid #dee2e6;
           padding: 30px 20px;
           border-radius: 12px;
           margin-bottom: 20px;
       }


       .summary-score {
           font-size: 3.5rem;
           font-family: 'Poppins', sans-serif;
           font-weight: 700;
           display: block;
           margin: 5px 0;
           line-height: 1;
           background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
           -webkit-background-clip: text;
           -webkit-text-fill-color: transparent;
       }
      
       .summary-list {
           max-height: 400px;
           overflow-y: auto;
           padding-right: 10px;
       }
      
       .summary-item {
           background: white;
           border-bottom: 1px solid #f1f1f1;
           padding: 12px 0;
       }
      
       .summary-item:last-child {
           border-bottom: none;
       }


       .summary-question {
           font-weight: 600;
           margin-bottom: 4px;
           display: block;
           font-size: 0.95rem;
       }
      
       .summary-answer-row {
           font-size: 0.9rem;
       }


       .summary-correct-text { color: var(--success-color); font-weight: 600; }
       .summary-wrong-text { color: var(--error-color); text-decoration: line-through; opacity: 0.8;}
       .real-answer { color: var(--success-color); font-weight: 600; margin-left: 5px; }


       /* Helpers */
       strong {
           color: var(--brand-color);
           font-weight: 700;
       }


   </style>
</head>
<body>


<div class="container">
   <header>
       <h1 id="header-title">Fysikquiz: Astronomi</h1>
   </header>
   <div class="progress-bar-container">
       <div class="progress-bar" id="progress-bar"></div>
   </div>


   <div class="content-area" id="app">
       <!-- Content will be injected here by JavaScript -->
   </div>
</div>


<script>
   // --- DATA ---
   const quizData = [
       {
           title: "Del 1: Historia och världsbilder",
           icon: "🔭",
           text: "Människan har i alla tider studerat himlakropparna. Den <strong>geocentriska världsbilden</strong>, utarbetad av bland annat Aristoteles, innebar att allt kretsade runt <strong>jorden</strong>. På 1500-talet etablerades den <strong>heliocentriska världsbilden</strong>, där solen är i centrum och planeterna rör sig runt den. Johannes Kepler upptäckte senare att planeterna rör sig i <strong>ellipser</strong>, inte i perfekta cirklar.",
           questions: [
               {
                   q: "Vilken världsbild innebär att jorden är universums centrum?",
                   options: [
                       "Heliocentrisk världsbild",
                       "Geocentrisk världsbild",
                       "Acentrisk världsbild",
                       "Elliptisk världsbild"
                   ],
                   correct: 1,
                   explanation: "Den <strong>geocentriska världsbilden</strong> placerade jorden i centrum, en idé som dominerade fram till 1500-talet."
               },
               {
                   q: "Vad upptäckte Johannes Kepler om planeternas rörelse runt solen?",
                   options: [
                       "De rör sig i perfekta cirklar.",
                       "De rör sig i spiraler.",
                       "De rör sig i ellipser.",
                       "De rör sig fram och tillbaka."
                   ],
                   correct: 2,
                   explanation: "Kepler använde mätdata för att bevisa att planeternas banor är <strong>elliptiska</strong>, vilket stämde bättre med observationer."
               }
           ]
       },
       {
           title: "Del 2: Big Bang och universums utveckling",
           icon: "🌌",
           text: "Universum bildades för ungefär <strong>13,8 miljarder år sedan</strong> genom en händelse som kallas <strong>Big Bang</strong>. All materia var då samlad i en punkt, en singularitet. Idag vet vi att universum inte är statiskt utan <strong>expanderar</strong>, vilket innebär att galaxerna rör sig ifrån varandra med allt högre hastighet. Som ett 'eko' från Big Bang finns <strong>bakgrundsstrålning</strong> kvar i hela universum.",
           questions: [
               {
                   q: "Vad kallas händelsen då universum bildades för ca 13,8 miljarder år sedan?",
                   options: [
                       "Supernovan",
                       "Inflationsteorin",
                       "Big Bang",
                       "Singulariteten"
                   ],
                   correct: 2,
                   explanation: "<strong>Big Bang</strong> är namnet på teorin om universums födelse och den efterföljande expansionen."
               },
               {
                   q: "Vad händer med universum idag enligt moderna observationer?",
                   options: [
                       "Det blir mindre och drar ihop sig.",
                       "Det är helt oförändrat i storlek.",
                       "Det expanderar och galaxer rör sig bort från varandra.",
                       "Det står stilla men blir varmare."
                   ],
                   correct: 2,
                   explanation: "Observationer visar att galaxerna accelererar bort från varandra och att universum därmed <strong>expanderar</strong>."
               },
               {
                   q: "Vilka var de två första lätta grundämnena som bildades efter Big Bang?",
                   options: [
                       "Guld och silver",
                       "Väte och helium",
                       "Kol och syre",
                       "Järn och kväve"
                   ],
                   correct: 1,
                   explanation: "<strong>Väte</strong> och <strong>helium</strong> utgör än idag ca 99 % av den synliga materian i universum och bildades tidigt i universums historia."
               }
           ]
       },
       {
           title: "Del 3: Stjärnornas liv och död",
           icon: "⭐",
           text: "En stjärna föds ur en <strong>nebulosa</strong>, vilket är ett enormt moln av damm och gas. Gravitationen drar ihop gasen så att trycket och temperaturen blir så höga att <strong>fusion</strong> startar. Vid fusion slås väteatomer samman till helium, och enorma mängder energi frigörs. När bränslet tar slut dör stjärnan; vår sol kommer att bli en <strong>röd jätte</strong> och till slut en <strong>vit dvärg</strong>. Mycket tunga stjärnor kan sluta som <strong>supernovor</strong> eller <strong>svarta hål</strong>.",
           questions: [
               {
                   q: "Ur vilket av följande alternativ bildas en stjärna?",
                   options: [
                       "En komet",
                       "Ett gasmoln (nebulosa)",
                       "En asteroid",
                       "En planet"
                   ],
                   correct: 1,
                   explanation: "Stjärnor föds när gravitationen får materia i stora <strong>gasmoln</strong> (nebulosor) att packas tätare och tätare."
               },
               {
                   q: "Vilken process skapar energi inuti en aktiv stjärna?",
                   options: [
                       "Förbränning av syre",
                       "Kärnklyvning (fission)",
                       "Fusion (atomkärnor slås samman)",
                       "Kemisk energi från kol"
                   ],
                   correct: 2,
                   explanation: "I stjärnor sker <strong>fusion</strong> där främst väte blir till helium, vilket frigör den energi som får stjärnan att lysa."
               },
               {
                   q: "Vad krävs rent fysiskt för att fusion ska kunna starta i en stjärna?",
                   options: [
                       "Att det finns flytande vatten.",
                       "Vakuum och nollgradig temperatur.",
                       "Extremt högt tryck och hög temperatur.",
                       "Att stjärnan befinner sig i en galax."
                   ],
                   correct: 2,
                   explanation: "För att atomkärnor ska kunna slås samman krävs enormt hög energi, alltså <strong>högt tryck och hög temperatur</strong>."
               },
               {
                   q: "Vad händer med en stjärna som är extremt stor när den dör?",
                   options: [
                       "Den blir en planet som jorden.",
                       "Den slocknar och blir en vit dvärg direkt.",
                       "Den kan kollapsa till ett svart hål efter en supernovaexplosion.",
                       "Den förvandlas till en ny nebulosa på en sekund."
                   ],
                   correct: 2,
                   explanation: "Riktigt stora stjärnor dör våldsamt i en supernova och kan lämna efter sig ett <strong>svart hål</strong> med extrem gravitation."
               }
           ]
       },
       {
           title: "Del 4: Solsystemet och avstånd",
           icon: "🪐",
           text: "Vårt solsystem ligger i galaxen <strong>Vintergatan</strong>. Det består av solen samt åtta planeter. De inre planeterna (Merkurius, Venus, Jorden, Mars) är <strong>stenplaneter</strong>, medan de yttre (Jupiter, Saturnus, Uranus, Neptunus) är <strong>gasjättar</strong>. Eftersom avstånden i rymden är enorma används enheten <strong>ljusår</strong>, vilket är den sträcka ljuset färdas på ett år. Avståndet till solen är bara cirka <strong>8 ljusminuter</strong>.",
           questions: [
               {
                   q: "Hur lång tid tar det för solens ljus att färdas till jorden?",
                   options: [
                       "8 sekunder",
                       "8 minuter",
                       "8 timmar",
                       "8 år"
                   ],
                   correct: 1,
                   explanation: "Solen ligger på ett avstånd av ca <strong>8 ljusminuter</strong>, vilket betyder att vi ser solen som den var för åtta minuter sedan."
               },
               {
                   q: "Vilken av följande planeter är en gigantisk gasplanet?",
                   options: [
                       "Mars",
                       "Venus",
                       "Jorden",
                       "Jupiter"
                   ],
                   correct: 3,
                   explanation: "<strong>Jupiter</strong> är solsystemets största planet och är en så kallad gasjätte."
               },
               {
                   q: "Vad är ett ljusår ett mått på?",
                   options: [
                       "Tid",
                       "Ljusstyrka",
                       "Avstånd",
                       "Temperatur"
                   ],
                   correct: 2,
                   explanation: "Ett <strong>ljusår</strong> är en <strong>avståndsenhet</strong> som motsvarar den sträcka ljuset hinner på ett år."
               },
               {
                   q: "Vilket av följande objekt är störst?",
                   options: [
                       "Solen",
                       "En galax",
                       "Jorden",
                       "En nebulosa"
                   ],
                   correct: 1,
                   explanation: "En <strong>galax</strong> är en samling av miljarder stjärnor och är betydligt större än enskilda stjärnor eller nebulosor."
               },
               {
                   q: "Rangordna följande objekt från minsta till största.",
                   options: [
                       "Jorden – Solen – Meteoroid – Galax",
                       "Meteoroid – Jorden – Solen – Galax",
                       "Galax – Solen – Jorden – Meteoroid",
                       "Solen – Jorden – Galax – Meteoroid"
                   ],
                   correct: 1,
                   explanation: "En meteoroid är smågrus, jorden är en planet, solen en stjärna och galaxen innehåller miljarder solar."
               }
           ]
       },
       {
           title: "Del 5: Himlakroppar och framtiden",
           icon: "☄️",
           text: "I solsystemet finns även mindre kroppar som <strong>asteroider</strong> och <strong>kometer</strong>. En komet liknas ofta vid en 'smutsig snöboll' av is och grus. Mellan Mars och Jupiter finns ett stort <strong>asteroidbälte</strong>. När det gäller universums framtid finns teorier som <strong>'The Big Freeze'</strong>, där universum fortsätter expandera tills det blir mörkt och kallt, eller <strong>'The Big Crunch'</strong>, där gravitationen får allt att dras ihop igen.",
           questions: [
               {
                   q: "Var i solsystemet finns det största asteroidbältet?",
                   options: [
                       "Mellan solen och Merkurius",
                       "Mellan jorden och månen",
                       "Mellan Mars och Jupiter",
                       "Utanför Neptunus"
                   ],
                   correct: 2,
                   explanation: "Det stora <strong>asteroidbältet</strong> ligger mellan stenplaneterna (Mars) och gasjättarna (Jupiter)."
               },
               {
                   q: "Vad händer enligt teorin 'The Big Crunch'?",
                   options: [
                       "Universum slits sönder av mörk energi.",
                       "Universum slutar växa och dras ihop till en enda punkt igen.",
                       "Alla stjärnor exploderar samtidigt.",
                       "Universum fryser fast i sin nuvarande storlek."
                   ],
                   correct: 1,
                   explanation: "Teorin innebär att gravitationen till slut vinner över expansionen och <strong>drar tillbaka all materia</strong>."
               },
               {
                   q: "Vilken himlakropp liknas vid en 'smutsig snöboll' och får en svans nära solen?",
                   options: [
                       "Asteroid",
                       "Meteorit",
                       "Komet",
                       "Svart hål"
                   ],
                   correct: 2,
                   explanation: "<strong>Kometer</strong> består av is och grus; när de närmar sig solen förångas isen och bildar en svans."
               },
               {
                   q: "Vad kallas de områden på solen som är kallare och ser ut som mörka fläckar?",
                   options: [
                       "Protuberanser",
                       "Solstormar",
                       "Solfläckar",
                       "Norrsken"
                   ],
                   correct: 2,
                   explanation: "<strong>Solfläckar</strong> är ca 2000 grader kallare än resten av solytan och orsakas av solens magnetfält."
               },
               {
                   q: "Vilken stjärna pekar alltid mot norr för att den ligger i linje med jordaxeln?",
                   options: [
                       "Proxima Centauri",
                       "Polstjärnan",
                       "Sirius",
                       "Betelgeuse"
                   ],
                   correct: 1,
                   explanation: "<strong>Polstjärnan</strong> är viktig för navigering eftersom dess position på himlen alltid är rakt i norr."
               }
           ]
       }
   ];


   // --- STATE MANAGEMENT ---
   let currentSectionIndex = 0;
   let currentQuestionIndex = 0; // Relative to current section
   let score = 0;
   let userAnswers = [];
   let state = 'intro'; // 'intro', 'question', 'summary'


   // --- DOM ELEMENTS ---
   const app = document.getElementById('app');
   const headerTitle = document.getElementById('header-title');
   const progressBar = document.getElementById('progress-bar');


   // --- MAIN RENDER FUNCTION ---
   function render() {
       if (state === 'summary') {
           renderSummary();
           return;
       }


       const section = quizData[currentSectionIndex];


       // Update Header with smooth fade
       headerTitle.style.opacity = '0';
       setTimeout(() => {
           headerTitle.innerText = section.title;
           headerTitle.style.transition = 'opacity 0.2s';
           headerTitle.style.opacity = '1';
       }, 150);


       // Calculate total progress
       let totalQuestions = 0;
       let answeredQuestions = 0;
      
       quizData.forEach((sec, idx) => {
           totalQuestions += sec.questions.length;
           if (idx < currentSectionIndex) {
               answeredQuestions += sec.questions.length;
           } else if (idx === currentSectionIndex && state === 'question') {
               answeredQuestions += currentQuestionIndex;
           }
       });
       const pct = (answeredQuestions / totalQuestions) * 100;
       progressBar.style.width = `${pct}%`;


       if (state === 'intro') {
           renderSectionIntro(section);
       } else if (state === 'question') {
           renderQuestion(section.questions[currentQuestionIndex]);
       }
   }


   // --- RENDER SECTION TEXT ---
   function renderSectionIntro(section) {
       // Simple animation class reset
       app.classList.remove('fade-in');
       void app.offsetWidth; // trigger reflow
       app.classList.add('fade-in');


       app.innerHTML = `
           <div class="fact-box">
               <span class="fact-icon">${section.icon}</span>
               <div class="fact-content">
                   <h2>Fakta</h2>
                   <p style="line-height: 1.6; font-size: 1rem; margin-top:0;">${section.text}</p>
               </div>
           </div>
           <button class="btn" onclick="startQuestions()">Starta frågor för denna del</button>
       `;
   }


   // --- RENDER QUESTION ---
   function renderQuestion(q) {
       const totalInCurrent = quizData[currentSectionIndex].questions.length;
      
       // Render with reset styles for feedback box
       app.innerHTML = `
           <div class="question-meta">Del ${currentSectionIndex + 1} • Fråga ${currentQuestionIndex + 1}/${totalInCurrent}</div>
           <h2 style="color: #2c3e50; font-weight: 600; margin-bottom:15px;">${q.q}</h2>
           <div class="options-grid">
               ${q.options.map((opt, idx) => `
                   <button class="option-btn" onclick="handleAnswer(${idx})" id="opt-${idx}">${opt}</button>
               `).join('')}
           </div>
           <div id="feedback" class="feedback-box">
               <h3 id="feedback-title"></h3>
               <p id="feedback-text" style="margin: 5px 0 15px 0; font-size: 0.95rem; line-height: 1.6;"></p>
               <button class="btn" id="next-btn" onclick="nextStep()" style="margin-top:0; width: auto; min-width: 150px;">Nästa fråga ➔</button>
           </div>
       `;
   }


   // --- RENDER SUMMARY ---
   function renderSummary() {
       headerTitle.innerText = "Sammanfattning";
       progressBar.style.width = '100%';
      
       let totalQ = 0;
       quizData.forEach(s => totalQ += s.questions.length);
      
       // Calculate score
       let correctCount = userAnswers.filter(a => a.isCorrect).length;
       let pct = Math.round((correctCount / totalQ) * 100);
      
       let gradeTitle = "";
      
       if(pct > 90) { gradeTitle = "Fantastiskt bra! 🏆"; }
       else if(pct > 70) { gradeTitle = "Mycket bra jobbat! 🌟"; }
       else if(pct > 50) { gradeTitle = "Godkänt! 👍"; }
       else { gradeTitle = "Fortsätt kämpa! 💪"; }


       let html = `
           <div class="summary-stats">
               <h2 style="color:var(--brand-color); margin:0 0 10px 0;">${gradeTitle}</h2>
               <span class="summary-score">${correctCount}/${totalQ}</span>
               <span style="color:#666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Rätt svar</span>
               <button class="btn" onclick="location.reload()" style="background: transparent; border: 2px solid var(--accent-color); color: var(--accent-color); margin-top: 20px; box-shadow:none; width: auto; padding: 10px 30px;">Gör om testet</button>
           </div>
           <h3 style="margin: 0 0 10px 0; font-size: 1.1rem; color: var(--text-muted);">Dina svar:</h3>
           <div class="summary-list">
       `;


       userAnswers.forEach((ans, idx) => {
           const isCorrect = ans.isCorrect;
          
           html += `
               <div class="summary-item">
                   <span class="summary-question">${idx + 1}. ${ans.question}</span>
                   <div class="summary-answer-row">
                       ${isCorrect
                           ? `<span class="summary-correct-text">✔ ${ans.userAnswer}</span>`
                           : `<span class="summary-wrong-text">✖ ${ans.userAnswer}</span> <span style="margin: 0 5px; color:#999;">➔</span> <span class="real-answer">${ans.correctAnswer}</span>`
                       }
                   </div>
               </div>
           `;
       });


       html += `</div>`;
       app.innerHTML = html;
   }


   // --- LOGIC FUNCTIONS ---
   window.startQuestions = function() {
       state = 'question';
       currentQuestionIndex = 0;
       render();
   };


   window.handleAnswer = function(selectedIndex) {
       // Disable all buttons
       const buttons = document.querySelectorAll('.option-btn');
       buttons.forEach(b => b.disabled = true);


       const section = quizData[currentSectionIndex];
       const currentQ = section.questions[currentQuestionIndex];
       const isCorrect = selectedIndex === currentQ.correct;


       // Visual feedback on buttons
       const selectedBtn = document.getElementById(`opt-${selectedIndex}`);
       const correctBtn = document.getElementById(`opt-${currentQ.correct}`);


       if (isCorrect) {
           selectedBtn.classList.add('correct');
       } else {
           selectedBtn.classList.add('incorrect');
           correctBtn.classList.add('correct'); // Show which one was right
       }


       // Show feedback box
       const feedbackBox = document.getElementById('feedback');
       const feedbackTitle = document.getElementById('feedback-title');
       const feedbackText = document.getElementById('feedback-text');
       const nextBtn = document.getElementById('next-btn');


       feedbackBox.style.display = 'block';
      
       // Add class for success/error styling
       if (isCorrect) {
           feedbackBox.className = "feedback-box success";
           feedbackTitle.innerHTML = "Rätt svar!";
       } else {
           feedbackBox.className = "feedback-box error";
           feedbackTitle.innerHTML = "Inte riktigt...";
       }
      
       feedbackText.innerHTML = currentQ.explanation; // Use innerHTML to render <strong> tags


       // Check if last question of entire quiz
       const isLastQuestionOverall = (currentSectionIndex === quizData.length - 1) && (currentQuestionIndex === section.questions.length - 1);
      
       if(isLastQuestionOverall) {
           nextBtn.innerText = "Se resultat 🏁";
       } else if (currentQuestionIndex === section.questions.length - 1) {
           nextBtn.innerText = "Nästa del ➔";
       }


       // Scroll to feedback if needed on mobile, but gently
       const rect = feedbackBox.getBoundingClientRect();
       const isVisible = (rect.top >= 0) && (rect.bottom <= window.innerHeight);
       if (!isVisible) {
            setTimeout(() => {
               feedbackBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
           }, 100);
       }


       // Save data
       userAnswers.push({
           question: currentQ.q,
           userAnswer: currentQ.options[selectedIndex],
           correctAnswer: currentQ.options[currentQ.correct],
           isCorrect: isCorrect
       });
   };


   window.nextStep = function() {
       const section = quizData[currentSectionIndex];
      
       // Reset feedback styles for next render
       const feedbackBox = document.getElementById('feedback');
       if(feedbackBox) {
           feedbackBox.style.display = 'none';
       }


       // Check if there are more questions in this section
       if (currentQuestionIndex < section.questions.length - 1) {
           currentQuestionIndex++;
           render();
       } else {
           // End of section, move to next section
           if (currentSectionIndex < quizData.length - 1) {
               currentSectionIndex++;
               state = 'intro';
               render();
           } else {
               // End of quiz
               state = 'summary';
               render();
           }
       }
   };


   // --- INIT ---
   render();


</script>


</body>
</html>