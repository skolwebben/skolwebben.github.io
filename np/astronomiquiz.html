<!DOCTYPE html>
<html lang="sv">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Fysikquiz: Astronomi (Åk 9)</title>
   <!-- Importerar moderna fonter från Google Fonts -->
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  
   <style>
       :root {
           /* Färgpalett - Professionell & Ren */
           --card-bg: #ffffff;
          
           --brand-color: #2c3e50;
           --brand-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
          
           --accent-color: #3498db;
          
           --success-color: #10ac84;
           --success-bg: #e3f9f1;
          
           --error-color: #ee5253;
           --error-bg: #ffeded;
          
           --text-main: #2d3436;
           --text-muted: #636e72;
          
           --shadow-card: 0 10px 25px rgba(0,0,0,0.15);
           --shadow-hover: 0 6px 16px rgba(0,0,0,0.12);
           --radius-main: 16px;
       }


       body {
           font-family: 'Open Sans', sans-serif;
           /* Gråaktig fade (Silver/Metallic style) */
           background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
           color: var(--text-main);
           margin: 0;
           padding: 15px;
           display: flex;
           justify-content: center;
           align-items: flex-start;
           min-height: 100vh;
       }


       .container {
           background-color: var(--card-bg);
           width: 100%;
           max-width: 680px;
           border-radius: var(--radius-main);
           box-shadow: var(--shadow-card);
           overflow: hidden;
           display: flex;
           flex-direction: column;
           position: relative;
           margin-top: 3vh;
           margin-bottom: 3vh;
       }


       header {
           background: var(--brand-gradient);
           color: white;
           padding: 20px;
           text-align: center;
           position: relative;
           overflow: hidden;
       }


       h1 {
           font-family: 'Poppins', sans-serif;
           margin: 0;
           font-size: 1.5rem;
           font-weight: 700;
           letter-spacing: -0.3px;
       }


       .content-area {
           padding: 25px 30px;
           flex-grow: 1;
       }


       h2 {
           font-family: 'Poppins', sans-serif;
           color: var(--brand-color);
           margin-top: 0;
           font-size: 1.3rem;
           margin-bottom: 0.8rem;
           line-height: 1.3;
       }


       /* Fact Section Styles */
       .fact-box {
           background: #f8f9fa;
           border-radius: 12px;
           padding: 20px;
           margin-bottom: 20px;
           /* Ingen border-left */
           display: flex;
           gap: 15px;
           align-items: flex-start;
       }
      
       .fact-icon {
           font-size: 2rem;
           display: block;
           margin-top: -5px;
       }
      
       .fact-content {
           flex: 1;
       }


       .btn {
           background: var(--brand-gradient);
           color: white;
           border: none;
           padding: 12px 24px;
           font-family: 'Poppins', sans-serif;
           font-size: 1rem;
           font-weight: 600;
           border-radius: 8px;
           cursor: pointer;
           transition: all 0.2s ease;
           display: block;
           width: 100%;
           margin-top: 20px;
           box-shadow: 0 4px 10px rgba(52, 152, 219, 0.2);
       }


       .btn:hover {
           transform: translateY(-2px);
           box-shadow: 0 6px 14px rgba(52, 152, 219, 0.3);
           opacity: 0.95;
       }


       /* Question Styles */
       .question-meta {
           display: inline-block;
           color: var(--text-muted);
           font-size: 0.85rem;
           margin-bottom: 10px;
           font-weight: 600;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }


       .options-grid {
           display: grid;
           gap: 12px;
           margin-top: 20px;
       }


       .option-btn {
           background-color: #fff;
           border: 2px solid #f1f2f6;
           padding: 15px 20px;
           text-align: left;
           border-radius: 10px;
           cursor: pointer;
           font-family: 'Open Sans', sans-serif;
           font-size: 0.95rem;
           font-weight: 500;
           transition: all 0.15s ease;
           color: var(--text-main);
           position: relative;
       }


       .option-btn:hover:not(:disabled) {
           border-color: var(--accent-color);
           background-color: #f8fcff;
           transform: translateX(3px);
           box-shadow: 0 2px 5px rgba(0,0,0,0.05);
       }
      
       /* Status states for options */
       .option-btn.correct {
           background-color: var(--success-bg);
           border-color: var(--success-color);
           color: #0b6e4f;
           font-weight: 600;
       }
      
       .option-btn.correct::after {
           content: "✓";
           position: absolute;
           right: 15px;
           font-weight: bold;
       }


       .option-btn.incorrect {
           background-color: var(--error-bg);
           border-color: var(--error-color);
           color: #c0392b;
           opacity: 0.8;
       }


       .option-btn:disabled {
           cursor: default;
       }


       /* Feedback Box */
       .feedback-box {
           margin-top: 20px;
           padding: 20px 25px;
           border-radius: 12px;
           background-color: #f8f9fa;
           color: var(--text-main);
           border: 1px solid #e9ecef;
           display: none;
           animation: fadeIn 0.3s ease;
       }
      
       .feedback-box h3 {
           margin-top: 0;
           font-family: 'Poppins', sans-serif;
           font-size: 1.2rem;
           display: flex;
           align-items: center;
           gap: 8px;
           margin-bottom: 8px;
       }


       .feedback-box.success h3 {
           color: var(--success-color);
       }
      
       .feedback-box.error h3 {
           color: var(--error-color);
       }


       .feedback-box strong {
           color: var(--brand-color);
       }


       @keyframes fadeIn {
           from { opacity: 0; transform: translateY(5px); }
           to { opacity: 1; transform: translateY(0); }
       }


       /* Progress Bar Styles */
       .progress-bar-container {
           height: 6px;
           background-color: #f1f3f5;
           width: 100%;
           position: relative;
           z-index: 10;
       }


       .progress-bar {
           height: 100%;
           background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
           width: 0%;
           transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
           border-radius: 0 4px 4px 0;
           box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
       }


       /* Summary Styles */
       .summary-stats {
           text-align: center;
           background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
           border: 1px solid #dee2e6;
           padding: 30px 20px;
           border-radius: 12px;
           margin-bottom: 20px;
       }


       .summary-score {
           font-size: 3.5rem;
           font-family: 'Poppins', sans-serif;
           font-weight: 700;
           display: block;
           margin: 5px 0;
           line-height: 1;
           background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
           -webkit-background-clip: text;
           -webkit-text-fill-color: transparent;
       }
      
       .summary-list {
           max-height: 400px;
           overflow-y: auto;
           padding-right: 10px;
       }
      
       .summary-item {
           background: white;
           border-bottom: 1px solid #f1f1f1;
           padding: 12px 0;
       }
      
       .summary-item:last-child {
           border-bottom: none;
       }


       .summary-question {
           font-weight: 600;
           margin-bottom: 4px;
           display: block;
           font-size: 0.95rem;
       }
      
       .summary-answer-row {
           font-size: 0.9rem;
       }


       .summary-correct-text { color: var(--success-color); font-weight: 600; }
       .summary-wrong-text { color: var(--error-color); text-decoration: line-through; opacity: 0.8;}
       .real-answer { color: var(--success-color); font-weight: 600; margin-left: 5px; }


       /* Helpers */
       strong {
           color: var(--brand-color);
           font-weight: 700;
       }


   </style>
</head>
<body>


<div class="container">
   <header>
       <h1 id="header-title">Fysikquiz: Astronomi</h1>
   </header>
   <div class="progress-bar-container">
       <div class="progress-bar" id="progress-bar"></div>
   </div>


   <div class="content-area" id="app">
       <!-- Content will be injected here by JavaScript -->
   </div>
</div>


<script>
   // --- DATA ---
   const quizData = [
       {
           title: "Del 1: Historia och världsbilder",
           icon: "🔭",
           text: "Människan har i alla tider studerat himlakropparna. Den <strong>geocentriska världsbilden</strong>, utarbetad av bland annat Aristoteles, innebar att allt kretsade runt <strong>jorden</strong>. På 1500-talet etablerades den <strong>heliocentriska världsbilden</strong>, där solen är i centrum och planeterna rör sig runt den. Johannes Kepler upptäckte senare att planeterna rör sig i <strong>ellipser</strong>, inte i perfekta cirklar.",
           questions: [
               {
                   q: "Vilken världsbild placerar jorden i universums absoluta centrum?",
                   options: [
                       "Den heliocentriska världsbilden.",
                       "Den geocentriska världsbilden.", // Rätt (Index 1)
                       "Den ptolemaiska epicykel-modellen.",
                       "Den galaktocentriska världsbilden."
                   ],
                   correct: 1,
                   explanation: "I den <strong>geocentriska världsbilden</strong> (geo = jord) ansåg man att jorden var stillastående i universums mitt. Detta var den dominerande synen fram till 1500-talet då Copernicus och andra bevisade att vi kretsar runt solen."
               },
               {
                   q: "Vad kunde Johannes Kepler bevisa angående planeternas banor runt solen?",
                   options: [
                       "Att de rör sig i perfekta cirklar med konstant hastighet.",
                       "Att de rör sig i spiralformade banor som långsamt närmar sig solen.",
                       "Att de rör sig i elliptiska (avlånga) banor med solen i ena brännpunkten.", // Rätt (Index 2)
                       "Att banorna är helt oregelbundna beroende på planeternas massa."
                   ],
                   correct: 2,
                   explanation: "Kepler bröt mot den gamla uppfattningen om perfekta cirklar. Han visade matematiskt att planeterna rör sig i <strong>ellipser</strong>, och att de dessutom rör sig snabbare när de är nära solen och långsammare när de är långt borta."
               }
           ]
       },
       {
           title: "Del 2: Big Bang och universums utveckling",
           icon: "🌌",
           text: "Universum bildades för ungefär <strong>13,8 miljarder år sedan</strong> genom en händelse som kallas <strong>Big Bang</strong>. All materia var då samlad i en punkt, en singularitet. Idag vet vi att universum inte är statiskt utan <strong>expanderar</strong>, vilket innebär att galaxerna rör sig ifrån varandra med allt högre hastighet. Som ett 'eko' från Big Bang finns <strong>bakgrundsstrålning</strong> kvar i hela universum.",
           questions: [
               {
                   q: "Vilken teori beskriver hur universum uppstod ur en extremt het och tät punkt?",
                   options: [
                       "Big Bang-teorin.", // Rätt (Index 0)
                       "Singularitetsprincipen.",
                       "Steady State-teorin.",
                       "Nebulosahypotesen."
                   ],
                   correct: 0,
                   explanation: "<strong>Big Bang</strong> är den vetenskapliga modell som beskriver hur universum expanderade från ett extremt tätt tillstånd för ca 13,8 miljarder år sedan. Bevisen inkluderar universums expansion och den kosmiska bakgrundsstrålningen."
               },
               {
                   q: "Vad visar astronomiska observationer att det händer med universum idag?",
                   options: [
                       "Det är statiskt och förändras inte i storlek.",
                       "Det drar långsamt ihop sig på grund av gravitationen.",
                       "Det expanderar, men takten saktar ner.",
                       "Det expanderar, och takten accelererar (ökar)." // Rätt (Index 3)
                   ],
                   correct: 3,
                   explanation: "Genom att mäta ljuset från avlägsna supernovor har astronomer upptäckt att universum inte bara <strong>expanderar</strong>, utan att expansionen går <strong>snabbare och snabbare</strong>, troligen på grund av mörk energi."
               },
               {
                   q: "Vilka två grundämnen bildades först och utgör majoriteten av all materia i universum?",
                   options: [
                       "Syre och Kväve (som i luften).",
                       "Väte och Helium.", // Rätt (Index 1)
                       "Kol och Väte (som i organiskt liv).",
                       "Järn och Nickel (som i planeter)."
                   ],
                   correct: 1,
                   explanation: "Kort efter Big Bang var universum tillräckligt svalt för att protoner och neutroner skulle bilda <strong>Väte</strong> och <strong>Helium</strong>. Tyngre ämnen som kol och syre bildades långt senare inuti stjärnor."
               }
           ]
       },
       {
           title: "Del 3: Stjärnornas liv och död",
           icon: "⭐",
           text: "En stjärna föds ur en <strong>nebulosa</strong>, vilket är ett enormt moln av damm och gas. Gravitationen drar ihop gasen så att trycket och temperaturen blir så höga att <strong>fusion</strong> startar. Vid fusion slås väteatomer samman till helium, och enorma mängder energi frigörs. När bränslet tar slut dör stjärnan; vår sol kommer att bli en <strong>röd jätte</strong> och till slut en <strong>vit dvärg</strong>. Mycket tunga stjärnor kan sluta som <strong>supernovor</strong> eller <strong>svarta hål</strong>.",
           questions: [
               {
                   q: "Vad är startpunkten för en stjärnas livscykel?",
                   options: [
                       "En röd jätte som kollapsar.",
                       "Ett svart hål som drar till sig ljus.",
                       "En nebulosa (ett moln av gas och stoft).", // Rätt (Index 2)
                       "En supernova-explosion."
                   ],
                   correct: 2,
                   explanation: "Alla stjärnor föds i enorma moln av gas och rymdstoft som kallas <strong>nebulosor</strong>. När gravitationen får delar av molnet att dra ihop sig ökar trycket tills en stjärna tänds."
               },
               {
                   q: "Vilken process är det som får en stjärna att lysa och avge värme?",
                   options: [
                       "Fusion (sammanslagning av atomkärnor).", // Rätt (Index 0)
                       "Fission (klyvning av tunga atomer).",
                       "Kemisk förbränning av vätgas.",
                       "Friktionsvärme från gasens rörelse."
                   ],
                   correct: 0,
                   explanation: "I stjärnans inre pressas lätta atomkärnor (främst väte) samman till tyngre kärnor (helium) i en process som kallas <strong>fusion</strong>. En liten del av massan omvandlas då till enorma mängder energi."
               },
               {
                   q: "Vad krävs fysikaliskt för att fusion ska kunna starta i en stjärna?",
                   options: [
                       "Extrem kyla för att atomerna ska kondensera.",
                       "Starka magnetfält som accelererar partiklar.",
                       "Närvaro av syre för att underhålla elden.",
                       "Extremt högt tryck och hög temperatur." // Rätt (Index 3)
                   ],
                   correct: 3,
                   explanation: "För att tvinga samman positivt laddade atomkärnor (som normalt stöter bort varandra) krävs ett enormt tryck och temperaturer på miljontals grader. Det är därför fusion bara sker i stjärnors kärnor."
               },
               {
                   q: "Vad händer i slutet av en mycket tung stjärnas liv?",
                   options: [
                       "Den svalnar långsamt och blir en brun dvärg.",
                       "Den exploderar i en supernova och kan bli ett svart hål.", // Rätt (Index 1)
                       "Den löses upp och blir till ren energi.",
                       "Den krymper ihop till en planet liknande Jorden."
                   ],
                   correct: 1,
                   explanation: "När bränslet i en massiv stjärna tar slut kan kärnan inte stå emot gravitationen. Stjärnan kollapsar och exploderar i en <strong>supernova</strong>. Kvarlämningen kan bli en neutronstjärna eller ett <strong>svart hål</strong>."
               }
           ]
       },
       {
           title: "Del 4: Solsystemet och avstånd",
           icon: "🪐",
           text: "Vårt solsystem ligger i galaxen <strong>Vintergatan</strong>. Det består av solen samt åtta planeter. De inre planeterna (Merkurius, Venus, Jorden, Mars) är <strong>stenplaneter</strong>, medan de yttre (Jupiter, Saturnus, Uranus, Neptunus) är <strong>gasjättar</strong>. Eftersom avstånden i rymden är enorma används enheten <strong>ljusår</strong>, vilket är den sträcka ljuset färdas på ett år. Avståndet till solen är bara cirka <strong>8 ljusminuter</strong>.",
           questions: [
               {
                   q: "Ungefär hur lång tid tar det för ljuset att färdas från solen till jorden?",
                   options: [
                       "Ca 1 sekund (samma tid som till månen).",
                       "Ca 24 timmar (ett dygn).",
                       "Ca 8 minuter.", // Rätt (Index 2)
                       "Ca 4 år (samma tid som till närmaste stjärna)."
                   ],
                   correct: 2,
                   explanation: "Avståndet till solen är ca 150 miljoner kilometer. Eftersom ljuset färdas med 300 000 km/s tar det drygt <strong>8 minuter</strong> för ljuset att nå hit. Vi ser alltså alltid solen som den var för 8 minuter sedan."
               },
               {
                   q: "Vilken av följande planeter klassas som en gasjätte?",
                   options: [
                       "Venus (som har en mycket tjock atmosfär).",
                       "Mars (även känd som den röda planeten).",
                       "Merkurius (som ligger närmast solen).",
                       "Jupiter (solsystemets största planet)." // Rätt (Index 3)
                   ],
                   correct: 3,
                   explanation: "<strong>Jupiter</strong>, Saturnus, Uranus och Neptunus är gasjättar. De består mestadels av väte och helium och saknar en fast yta att landa på, till skillnad från stenplaneterna."
               },
               {
                   q: "Vad mäter man egentligen med enheten 'ljusår'?",
                   options: [
                       "Sträckan som ljuset hinner färdas på ett år.", // Rätt (Index 0)
                       "Tiden det tar för ljuset att korsa en galax.",
                       "Ljusstyrkan hos en stjärna på ett års avstånd.",
                       "Universums ålder sedan Big Bang."
                   ],
                   correct: 0,
                   explanation: "Trots namnet är <strong>ljusår</strong> ett mått på <strong>avstånd</strong>, inte tid. Ett ljusår motsvarar ungefär 9 500 miljarder kilometer, vilket är en praktisk enhet för de enorma avstånden i rymden."
               },
               {
                   q: "Vilket av följande objekt är störst i storlek?",
                   options: [
                       "En röd jättestjärna (t.ex. Betelgeuse).",
                       "En galax (t.ex. Vintergatan).", // Rätt (Index 1)
                       "Vårt solsystem (inklusive Oorts moln).",
                       "En stjärnhop (samling av stjärnor)."
                   ],
                   correct: 1,
                   explanation: "En <strong>galax</strong> är en enorm samling som kan innehålla hundratals miljarder stjärnor, planetsystem och nebulosor. Den är alltså ofantligt mycket större än en enskild stjärna eller ett solsystem."
               },
               {
                   q: "Vilken ordning är korrekt om vi sorterar från minst till störst?",
                   options: [
                       "Solen – Jorden – Galax – Universum",
                       "Meteoroid – Jorden – Solen – Galax", // Rätt (Index 1)
                       "Jorden – Meteoroid – Galax – Solen",
                       "Galax – Solen – Jorden – Meteoroid"
                   ],
                   correct: 1,
                   explanation: "En meteoroid är en liten sten, Jorden är en planet, Solen är en stjärna (ca 109 gånger bredare än jorden), och en galax består av miljarder stjärnor."
               }
           ]
       },
       {
           title: "Del 5: Himlakroppar och framtiden",
           icon: "☄️",
           text: "I solsystemet finns även mindre kroppar som <strong>asteroider</strong> och <strong>kometer</strong>. En komet liknas ofta vid en 'smutsig snöboll' av is och grus. Mellan Mars och Jupiter finns ett stort <strong>asteroidbälte</strong>. När det gäller universums framtid finns teorier som <strong>'The Big Freeze'</strong>, där universum fortsätter expandera tills det blir mörkt och kallt, eller <strong>'The Big Crunch'</strong>, där gravitationen får allt att dras ihop igen.",
           questions: [
               {
                   q: "Var i solsystemet hittar man det stora asteroidbältet?",
                   options: [
                       "I en bana precis utanför Neptunus (Kuiperbältet).",
                       "Mellan Jorden och Mars.",
                       "Runt Saturnus som bildar dess ringar.",
                       "I banan mellan Mars och Jupiter." // Rätt (Index 3)
                   ],
                   correct: 3,
                   explanation: "Det största <strong>asteroidbältet</strong> ligger mellan stenplaneten Mars och gasjätten Jupiter. Det består av miljontals stenblock som aldrig lyckades klumpa ihop sig till en planet på grund av Jupiters gravitation."
               },
               {
                   q: "Vad innebär teorin 'The Big Crunch' (den stora krossen)?",
                   options: [
                       "Att gravitationen till slut får universums expansion att vända och allt dras ihop.", // Rätt (Index 0)
                       "Att universum expanderar så snabbt att atomer slits sönder.",
                       "Att alla stjärnor slocknar och universum blir kallt och mörkt.",
                       "Att universum krockar med ett annat parallellt universum."
                   ],
                   correct: 0,
                   explanation: "Big Crunch är en teori om att universums densitet är tillräckligt hög för att <strong>gravitationen</strong> ska bromsa expansionen och till slut dra ihop all materia till en enda punkt igen – en omvänd Big Bang."
               },
               {
                   q: "Vilken himlakropp beskrivs ofta som en 'smutsig snöboll' och får en svans nära solen?",
                   options: [
                       "En asteroid (stenblock i rymden).",
                       "En komet (består av is och grus).", // Rätt (Index 1)
                       "En meteorit (som fallit ner på jorden).",
                       "En dvärgplanet (som Pluto)."
                   ],
                   correct: 1,
                   explanation: "<strong>Kometer</strong> kommer från solsystemets yttre delar. När de närmar sig solen förångas isen (sublimerar) av värmen, vilket skapar ett moln av gas och stoft som bildar den karaktäristiska svansen."
               },
               {
                   q: "Vad är solfläckar för något?",
                   options: [
                       "Enorma vulkanutbrott på solens yta.",
                       "Moln av rök som bildas vid fusionen.",
                       "Områden på solen som är svalare än omgivningen.", // Rätt (Index 2)
                       "Hål i solens atmosfär där man ser in till kärnan."
                   ],
                   correct: 2,
                   explanation: "<strong>Solfläckar</strong> ser mörka ut för att de är 'kallare' (ca 4000°C) än den omgivande ytan (ca 6000°C). De orsakas av starka magnetfält som hindrar värmen från att stiga upp underifrån."
               },
               {
                   q: "Varför har Polstjärnan varit så viktig för navigation genom historien?",
                   options: [
                       "Den är himlens absolut starkast lysande stjärna.",
                       "Den är den enda stjärnan som aldrig går ner under horisonten.",
                       "Den ändrar färg beroende på väderlek.",
                       "Den ligger nästan exakt i linje med jordens rotationsaxel (norr)." // Rätt (Index 3)
                   ],
                   correct: 3,
                   explanation: "Eftersom <strong>Polstjärnan</strong> ligger rakt ovanför Nordpolen ser den ut att ligga stilla på himlen medan andra stjärnor roterar runt den. Den visar därför alltid väderstrecket <strong>norr</strong>."
               }
           ]
       }
   ];


   // --- STATE MANAGEMENT ---
   let currentSectionIndex = 0;
   let currentQuestionIndex = 0; // Relative to current section
   let score = 0;
   let userAnswers = [];
   let state = 'intro'; // 'intro', 'question', 'summary'


   // --- DOM ELEMENTS ---
   const app = document.getElementById('app');
   const headerTitle = document.getElementById('header-title');
   const progressBar = document.getElementById('progress-bar');


   // --- MAIN RENDER FUNCTION ---
   function render() {
       if (state === 'summary') {
           renderSummary();
           return;
       }


       const section = quizData[currentSectionIndex];


       // Update Header with smooth fade
       headerTitle.style.opacity = '0';
       setTimeout(() => {
           headerTitle.innerText = section.title;
           headerTitle.style.transition = 'opacity 0.2s';
           headerTitle.style.opacity = '1';
       }, 150);


       // Calculate total progress
       let totalQuestions = 0;
       let answeredQuestions = 0;
      
       quizData.forEach((sec, idx) => {
           totalQuestions += sec.questions.length;
           if (idx < currentSectionIndex) {
               answeredQuestions += sec.questions.length;
           } else if (idx === currentSectionIndex && state === 'question') {
               answeredQuestions += currentQuestionIndex;
           }
       });
       const pct = (answeredQuestions / totalQuestions) * 100;
       progressBar.style.width = `${pct}%`;


       if (state === 'intro') {
           renderSectionIntro(section);
       } else if (state === 'question') {
           renderQuestion(section.questions[currentQuestionIndex]);
       }
   }


   // --- RENDER SECTION TEXT ---
   function renderSectionIntro(section) {
       // Simple animation class reset
       app.classList.remove('fade-in');
       void app.offsetWidth; // trigger reflow
       app.classList.add('fade-in');


       app.innerHTML = `
           <div class="fact-box">
               <span class="fact-icon">${section.icon}</span>
               <div class="fact-content">
                   <h2>Fakta</h2>
                   <p style="line-height: 1.6; font-size: 1rem; margin-top:0;">${section.text}</p>
               </div>
           </div>
           <button class="btn" onclick="startQuestions()">Starta frågor för denna del</button>
       `;
   }


   // --- RENDER QUESTION ---
   function renderQuestion(q) {
       const totalInCurrent = quizData[currentSectionIndex].questions.length;
      
       // Render with reset styles for feedback box
       app.innerHTML = `
           <div class="question-meta">Del ${currentSectionIndex + 1} • Fråga ${currentQuestionIndex + 1}/${totalInCurrent}</div>
           <h2 style="color: #2c3e50; font-weight: 600; margin-bottom:15px;">${q.q}</h2>
           <div class="options-grid">
               ${q.options.map((opt, idx) => `
                   <button class="option-btn" onclick="handleAnswer(${idx})" id="opt-${idx}">${opt}</button>
               `).join('')}
           </div>
           <div id="feedback" class="feedback-box">
               <h3 id="feedback-title"></h3>
               <p id="feedback-text" style="margin: 5px 0 15px 0; font-size: 0.95rem; line-height: 1.6;"></p>
               <button class="btn" id="next-btn" onclick="nextStep()" style="margin-top:0; width: auto; min-width: 150px;">Nästa fråga ➔</button>
           </div>
       `;
   }


   // --- RENDER SUMMARY ---
   function renderSummary() {
       headerTitle.innerText = "Sammanfattning";
       progressBar.style.width = '100%';
      
       let totalQ = 0;
       quizData.forEach(s => totalQ += s.questions.length);
      
       // Calculate score
       let correctCount = userAnswers.filter(a => a.isCorrect).length;
       let pct = Math.round((correctCount / totalQ) * 100);
      
       let gradeTitle = "";
      
       if(pct > 90) { gradeTitle = "Fantastiskt bra! 🏆"; }
       else if(pct > 70) { gradeTitle = "Mycket bra jobbat! 🌟"; }
       else if(pct > 50) { gradeTitle = "Godkänt! 👍"; }
       else { gradeTitle = "Fortsätt kämpa! 💪"; }


       let html = `
           <div class="summary-stats">
               <h2 style="color:var(--brand-color); margin:0 0 10px 0;">${gradeTitle}</h2>
               <span class="summary-score">${correctCount}/${totalQ}</span>
               <span style="color:#666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Rätt svar</span>
               <button class="btn" onclick="location.reload()" style="background: transparent; border: 2px solid var(--accent-color); color: var(--accent-color); margin-top: 20px; box-shadow:none; width: auto; padding: 10px 30px;">Gör om testet</button>
           </div>
           <h3 style="margin: 0 0 10px 0; font-size: 1.1rem; color: var(--text-muted);">Dina svar:</h3>
           <div class="summary-list">
       `;


       userAnswers.forEach((ans, idx) => {
           const isCorrect = ans.isCorrect;
          
           html += `
               <div class="summary-item">
                   <span class="summary-question">${idx + 1}. ${ans.question}</span>
                   <div class="summary-answer-row">
                       ${isCorrect
                           ? `<span class="summary-correct-text">✔ ${ans.userAnswer}</span>`
                           : `<span class="summary-wrong-text">✖ ${ans.userAnswer}</span> <span style="margin: 0 5px; color:#999;">➔</span> <span class="real-answer">${ans.correctAnswer}</span>`
                       }
                   </div>
               </div>
           `;
       });


       html += `</div>`;
       app.innerHTML = html;
   }


   // --- LOGIC FUNCTIONS ---
   window.startQuestions = function() {
       state = 'question';
       currentQuestionIndex = 0;
       render();
   };


   window.handleAnswer = function(selectedIndex) {
       // Disable all buttons
       const buttons = document.querySelectorAll('.option-btn');
       buttons.forEach(b => b.disabled = true);


       const section = quizData[currentSectionIndex];
       const currentQ = section.questions[currentQuestionIndex];
       const isCorrect = selectedIndex === currentQ.correct;


       // Visual feedback on buttons
       const selectedBtn = document.getElementById(`opt-${selectedIndex}`);
       const correctBtn = document.getElementById(`opt-${currentQ.correct}`);


       if (isCorrect) {
           selectedBtn.classList.add('correct');
       } else {
           selectedBtn.classList.add('incorrect');
           correctBtn.classList.add('correct'); // Show which one was right
       }


       // Show feedback box
       const feedbackBox = document.getElementById('feedback');
       const feedbackTitle = document.getElementById('feedback-title');
       const feedbackText = document.getElementById('feedback-text');
       const nextBtn = document.getElementById('next-btn');


       feedbackBox.style.display = 'block';
      
       // Add class for success/error styling
       if (isCorrect) {
           feedbackBox.className = "feedback-box success";
           feedbackTitle.innerHTML = "Rätt svar!";
       } else {
           feedbackBox.className = "feedback-box error";
           feedbackTitle.innerHTML = "Inte riktigt...";
       }
      
       feedbackText.innerHTML = currentQ.explanation; // Use innerHTML to render <strong> tags


       // Check if last question of entire quiz
       const isLastQuestionOverall = (currentSectionIndex === quizData.length - 1) && (currentQuestionIndex === section.questions.length - 1);
      
       if(isLastQuestionOverall) {
           nextBtn.innerText = "Se resultat 🏁";
       } else if (currentQuestionIndex === section.questions.length - 1) {
           nextBtn.innerText = "Nästa del ➔";
       }


       // Scroll to feedback if needed on mobile, but gently
       const rect = feedbackBox.getBoundingClientRect();
       const isVisible = (rect.top >= 0) && (rect.bottom <= window.innerHeight);
       if (!isVisible) {
           setTimeout(() => {
               feedbackBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
           }, 100);
       }


       // Save data
       userAnswers.push({
           question: currentQ.q,
           userAnswer: currentQ.options[selectedIndex],
           correctAnswer: currentQ.options[currentQ.correct],
           isCorrect: isCorrect
       });
   };


   window.nextStep = function() {
       const section = quizData[currentSectionIndex];
      
       // Reset feedback styles for next render
       const feedbackBox = document.getElementById('feedback');
       if(feedbackBox) {
           feedbackBox.style.display = 'none';
       }


       // Check if there are more questions in this section
       if (currentQuestionIndex < section.questions.length - 1) {
           currentQuestionIndex++;
           render();
       } else {
           // End of section, move to next section
           if (currentSectionIndex < quizData.length - 1) {
               currentSectionIndex++;
               state = 'intro';
               render();
           } else {
               // End of quiz
               state = 'summary';
               render();
           }
       }
   };


   // --- INIT ---
   render();


</script>


</body>
</html>