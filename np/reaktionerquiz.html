<!DOCTYPE html>
<html lang="sv">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Kemiquiz: Reaktioner & Gaser (Åk 9)</title>
   <!-- Importerar moderna fonter från Google Fonts -->
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  
   <style>
       :root {
           /* Färgpalett - Orange Tema med Blå Accent */
           --card-bg: #ffffff;
          
           --brand-color: #ef6c00; /* Mörk orange */
           --brand-gradient: linear-gradient(135deg, #ef6c00 0%, #ff9800 100%);
          
           --accent-color: #ffb74d; /* Ljusare orange */
          
           /* Komplementfärg: Blå för kontrast */
           --complement-color: #1565c0;


           --success-color: #2e7d32;
           --success-bg: #e8f5e9;
          
           --error-color: #c62828;
           --error-bg: #ffebee;
          
           --text-main: #212121; /* Mörkare grå/svart för text */
           --text-muted: #616161;
          
           --shadow-card: 0 10px 25px rgba(0,0,0,0.1);
           --shadow-hover: 0 6px 16px rgba(0,0,0,0.12);
           --radius-main: 16px;
       }


       body {
           font-family: 'Open Sans', sans-serif;
           /* Gråaktig fade (Silver/Metallic style) */
           background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
           color: var(--text-main);
           margin: 0;
           padding: 15px;
           display: flex;
           justify-content: center;
           align-items: flex-start;
           min-height: 100vh;
       }


       .container {
           background-color: var(--card-bg);
           width: 100%;
           max-width: 680px;
           border-radius: var(--radius-main);
           box-shadow: var(--shadow-card);
           overflow: hidden;
           display: flex;
           flex-direction: column;
           position: relative;
           margin-top: 3vh;
           margin-bottom: 3vh;
       }


       header {
           background: var(--brand-gradient);
           color: white;
           padding: 20px;
           text-align: center;
           position: relative;
           overflow: hidden;
       }


       h1 {
           font-family: 'Poppins', sans-serif;
           margin: 0;
           font-size: 1.5rem;
           font-weight: 700;
           letter-spacing: -0.3px;
       }


       .content-area {
           padding: 25px 30px;
           flex-grow: 1;
       }


       h2 {
           font-family: 'Poppins', sans-serif;
           color: var(--text-main);
           margin-top: 0;
           font-size: 1.3rem;
           margin-bottom: 0.8rem;
           line-height: 1.3;
       }


       /* Fact Section Styles */
       .fact-box {
           background: #ffffff;
           border: 1px solid #eeeeee; /* Neutral border */
           border-radius: 12px;
           padding: 20px;
           margin-bottom: 20px;
           display: flex;
           gap: 15px;
           align-items: flex-start;
           box-shadow: 0 2px 8px rgba(0,0,0,0.03);
       }
      
       .fact-icon {
           font-size: 2rem;
           display: block;
           margin-top: -5px;
           color: var(--complement-color); /* Blå färg på ikonen */
       }
      
       .fact-content {
           flex: 1;
       }


       .btn {
           background: var(--brand-gradient);
           color: white;
           border: none;
           padding: 12px 24px;
           font-family: 'Poppins', sans-serif;
           font-size: 1rem;
           font-weight: 600;
           border-radius: 8px;
           cursor: pointer;
           transition: all 0.2s ease;
           display: block;
           width: 100%;
           margin-top: 20px;
           box-shadow: 0 4px 10px rgba(239, 108, 0, 0.2);
       }


       .btn:hover {
           transform: translateY(-2px);
           box-shadow: 0 6px 14px rgba(239, 108, 0, 0.3);
           opacity: 0.95;
       }


       /* Question Styles */
       .question-meta {
           display: inline-block;
           color: var(--complement-color); /* Blå färg */
           font-size: 0.85rem;
           margin-bottom: 10px;
           font-weight: 700;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }


       .options-grid {
           display: grid;
           gap: 12px;
           margin-top: 20px;
       }


       .option-btn {
           background-color: #fff;
           border: 2px solid #f5f5f5;
           padding: 15px 20px;
           text-align: left;
           border-radius: 10px;
           cursor: pointer;
           font-family: 'Open Sans', sans-serif;
           font-size: 0.95rem;
           font-weight: 500;
           transition: all 0.15s ease;
           color: var(--text-main);
           position: relative;
       }


       .option-btn:hover:not(:disabled) {
           border-color: var(--accent-color);
           background-color: #fff3e0;
           transform: translateX(3px);
           box-shadow: 0 2px 5px rgba(0,0,0,0.05);
       }
      
       /* Status states for options */
       .option-btn.correct {
           background-color: var(--success-bg);
           border-color: var(--success-color);
           color: #1b5e20;
           font-weight: 600;
       }
      
       .option-btn.correct::after {
           content: "✓";
           position: absolute;
           right: 15px;
           font-weight: bold;
       }


       .option-btn.incorrect {
           background-color: var(--error-bg);
           border-color: var(--error-color);
           color: #b71c1c;
           opacity: 0.8;
       }


       .option-btn:disabled {
           cursor: default;
       }


       /* Feedback Box */
       .feedback-box {
           margin-top: 20px;
           padding: 20px 25px;
           border-radius: 12px;
           background-color: #f9f9f9;
           color: var(--text-main);
           border: 1px solid #e0e0e0;
           display: none;
           animation: fadeIn 0.3s ease;
       }
      
       .feedback-box h3 {
           margin-top: 0;
           font-family: 'Poppins', sans-serif;
           font-size: 1.2rem;
           display: flex;
           align-items: center;
           gap: 8px;
           margin-bottom: 8px;
       }


       .feedback-box.success h3 {
           color: var(--success-color);
       }
      
       .feedback-box.error h3 {
           color: var(--error-color);
       }


       .feedback-box strong {
           color: #000; /* Svarta fetstilade ord */
       }


       @keyframes fadeIn {
           from { opacity: 0; transform: translateY(5px); }
           to { opacity: 1; transform: translateY(0); }
       }


       /* Progress Bar Styles */
       .progress-bar-container {
           height: 6px;
           background-color: #eeeeee;
           width: 100%;
           position: relative;
           z-index: 10;
       }


       .progress-bar {
           height: 100%;
           /* Orange Gradient för att matcha temat */
           background: linear-gradient(90deg, #ffcc80 0%, #ef6c00 100%);
           width: 0%;
           transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
           border-radius: 0 4px 4px 0;
           box-shadow: 0 0 10px rgba(239, 108, 0, 0.5);
       }


       /* Summary Styles */
       .summary-stats {
           text-align: center;
           background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
           border: 1px solid #ffcc80;
           padding: 30px 20px;
           border-radius: 12px;
           margin-bottom: 20px;
       }


       .summary-score {
           font-size: 3.5rem;
           font-family: 'Poppins', sans-serif;
           font-weight: 700;
           display: block;
           margin: 5px 0;
           line-height: 1;
           background: linear-gradient(135deg, #e65100 0%, #fb8c00 100%);
           -webkit-background-clip: text;
           -webkit-text-fill-color: transparent;
       }
      
       .summary-list {
           max-height: 400px;
           overflow-y: auto;
           padding-right: 10px;
       }
      
       .summary-item {
           background: white;
           border-bottom: 1px solid #eeeeee;
           padding: 12px 0;
       }
      
       .summary-item:last-child {
           border-bottom: none;
       }


       .summary-question {
           font-weight: 600;
           margin-bottom: 4px;
           display: block;
           font-size: 0.95rem;
       }
      
       .summary-answer-row {
           font-size: 0.9rem;
       }


       .summary-correct-text { color: var(--success-color); font-weight: 600; }
       .summary-wrong-text { color: var(--error-color); text-decoration: line-through; opacity: 0.8;}
       .real-answer { color: var(--success-color); font-weight: 600; margin-left: 5px; }


       /* Helpers */
       strong {
           color: #000; /* Svarta fetstilade ord */
           font-weight: 700;
       }


   </style>
</head>
<body>


<div class="container">
   <header>
       <h1 id="header-title">Kemiquiz: Reaktioner & Gaser</h1>
   </header>
   <div class="progress-bar-container">
       <div class="progress-bar" id="progress-bar"></div>
   </div>


   <div class="content-area" id="app">
       <!-- Content will be injected here by JavaScript -->
   </div>
</div>


<script>
   // --- DATA ---
   const quizData = [
       {
           title: "Del 1: Atomens partiklar",
           icon: "⚛️",
           text: "En atom består av en kärna med <strong>protoner (+)</strong> och <strong>neutroner (0)</strong>. Runt kärnan rör sig <strong>elektroner (-)</strong>. Det är antalet protoner som bestämmer vilket grundämne det är. De elektroner som finns i det yttersta skalet kallas <strong>valenselektroner</strong>, och det är dessa som påverkas vid kemiska reaktioner. Atomer strävar efter att få ett fullt yttersta skal, vilket kallas <strong>ädelgasstruktur</strong>.",
           questions: [
               {
                   q: "Vilken av atomens partiklar avgör vilket specifikt grundämne det är?",
                   options: [
                       "Neutronerna i atomkärnan.",
                       "Protonerna i atomkärnan.",
                       "Elektronerna i de yttre skalen.",
                       "Valenselektronerna i det yttersta skalet."
                   ],
                   correct: 1,
                   explanation: "Varje grundämne har ett unikt antal <strong>protoner</strong>, vilket kallas atomnummer. Antalet protoner är alltid konstant för ett ämne."
               },
               {
                   q: "Vad består ett grundämne av enligt kemins definition?",
                   options: [
                       "Endast en sorts atomer.",
                       "En blandning av olika molekyler.",
                       "Atomer som reagerat till joner.",
                       "Flera olika sorters atomer som sitter ihop."
                   ],
                   correct: 0,
                   explanation: "Ett <strong>grundämne</strong> definieras av att det enbart innehåller en unik atomsort (samma antal protoner)."
               },
               {
                   q: "Varför är ädelgaser, som till exempel helium och argon, oftast ovilliga att reagera med andra ämnen?",
                   options: [
                       "De har en för liten atomkärna för att kunna binda till andra ämnen.",
                       "De saknar helt elektroner i sina yttersta skal och kan därför inte bilda bindningar.",
                       "Deras yttersta elektronskal är redan helt fyllda med elektroner.",
                       "De har en positiv laddning som stöter bort andra atomer i deras närhet."
                   ],
                   correct: 2,
                   explanation: "Ädelgaser har redan uppnått <strong>ädelgasstruktur</strong> (fullt skal), vilket gör dem stabila och 'nöjda'."
               }
           ]
       },
       {
           title: "Del 2: Joner och jonbindning",
           icon: "🔋",
           text: "En <strong>jon</strong> bildas när en atom förlorar eller tar upp elektroner. Om en atom förlorar elektroner blir den en <strong>positiv jon</strong>. Om den tar upp elektroner blir den en <strong>negativ jon</strong>. <strong>Jonbindning</strong> uppstår när en positiv och en negativ jon dras till varandra och bildar kristaller, vilket vi kallar för ett <strong>salt</strong>.",
           questions: [
               {
                   q: "Vilket av följande alternativ beskriver bäst vad en jon är?",
                   options: [
                       "En atom med fler neutroner än protoner.",
                       "En atom som har delat sina elektroner med en annan atom.",
                       "En atom där antalet elektroner och protoner är exakt lika många.",
                       "En atom som har olika många elektroner och protoner."
                   ],
                   correct: 3,
                   explanation: "En jon är en <strong>laddad atom</strong>. Laddningen uppstår för att antalet negativa elektroner inte är lika stort som antalet positiva protoner."
               },
               {
                   q: "Vilken typ av kemisk förening bildas genom jonbindning?",
                   options: [
                       "Salter.",
                       "Metaller.",
                       "Molekyler.",
                       "Ädelgaser."
                   ],
                   correct: 0,
                   explanation: "Jonbindning sker mellan positiva och negativa joner som dras till varandra. Resultatet kallas för ett <strong>salt</strong>."
               },
               {
                   q: "Vilken laddning får en atom från grupp 1 (alkalimetallerna) när den blir en jon?",
                   options: [
                       "Den blir neutral (0).",
                       "Den blir positiv (1+).",
                       "Den blir negativ (1-).",
                       "Den blir starkt negativ (7-)."
                   ],
                   correct: 1,
                   explanation: "Alkalimetaller har en valenselektron som de ger bort. När en negativ laddning försvinner får atomen ett överskott på en proton och blir <strong>positiv</strong>."
               }
           ]
       },
       {
           title: "Del 3: Molekyl- & metallbindning",
           icon: "⛓️",
           text: "I en <strong>molekylbindning</strong> (kovalent bindning) delar atomer på elektronpar. Detta är vanligast hos ickemetaller. I <strong>metallbindning</strong> släpper metallatomerna sina valenselektroner till ett gemensamt <strong>'elektronmoln'</strong>. Dessa rörliga laddningar gör att metaller leder elektricitet och värme bra.",
           questions: [
               {
                   q: "Vad händer med elektronerna i en molekylbindning (elektronparbindning)?",
                   options: [
                       "Elektronerna flyttas helt från en metall till en ickemetall.",
                       "Elektronerna bildar ett moln som är gemensamt för alla atomer i ämnet.",
                       "Elektronerna försvinner som energi i form av ljus och värme.",
                       "Elektronerna delas mellan två atomer så att båda får fulla skal."
                   ],
                   correct: 3,
                   explanation: "Vid molekylbindning <strong>lånar/delar</strong> atomerna elektroner av varandra för att uppnå ädelgasstruktur."
               },
               {
                   q: "Vad är orsaken till att metaller har god förmåga att leda elektrisk ström?",
                   options: [
                       "Metallatomer har inga elektroner och ger därför plats för strömmen.",
                       "Metallatomer sitter så glest att elektronerna kan flyga fritt emellan dem.",
                       "De yttersta elektronerna är rörliga och gemensamma för alla atomer.",
                       "Metaller består av joner som rör sig snabbt mot den positiva polen."
                   ],
                   correct: 2,
                   explanation: "I metallbindningen finns ett gemensamt moln av <strong>rörliga elektroner</strong> som kan transportera elektrisk laddning."
               },
               {
                   q: "Vilka tre strategier kan atomer använda för att uppnå ädelgasstruktur?",
                   options: [
                       "Dela på elektroner, ge bort elektroner eller ta upp elektroner.",
                       "Öka antalet protoner, minska antalet neutroner eller byta elektronskal.",
                       "Smälta samman atomkärnor, bilda isotoper eller avge radioaktiv strålning.",
                       "Reagera med vatten, bilda oxider eller deponera elektroner i atomkärnan."
                   ],
                   correct: 0,
                   explanation: "Atomer strävar efter fulla skal genom att <strong>dela</strong> (molekylbindning) eller genom att <strong>ge/ta</strong> elektroner (jonbindning)."
               }
           ]
       },
       {
           title: "Del 4: Kemiska reaktioner",
           icon: "🧪",
           text: "En <strong>kemisk reaktion</strong> innebär att atomer byter plats och bildar nya ämnen. Enligt lagen om <strong>massans bevarande</strong> försvinner inga atomer. Vid formelskrivning visas antalet atomer med siffror (t.ex. O₂). <strong>Enzymer</strong> och katalysatorer kan påskynda reaktioner utan att själva förbrukas.",
           questions: [
               {
                   q: "Vad innebär fransmannen Lavoisiers upptäckt om 'massans bevarande'?",
                   options: [
                       "Att gaser inte väger någonting vid en kemisk reaktion.",
                       "Att vikten är densamma före och efter en reaktion i ett slutet rum.",
                       "Att tunga atomer alltid bildar mer energi än lätta atomer vid förbränning.",
                       "Att antalet molekyler alltid måste vara exakt lika många efter en reaktion."
                   ],
                   correct: 1,
                   explanation: "Inga atomer försvinner eller skapas; de byter bara plats. Därför väger de ingående ämnena lika mycket som de ämnen som bildas."
               },
               {
                   q: "Vad är skillnaden mellan beteckningarna O₂ och 2O i en kemisk formel?",
                   options: [
                       "O₂ betyder två olika grundämnen medan 2O betyder ett grundämne.",
                       "2O är en syremolekyl medan O₂ är två lösa syreatomer i ett skal.",
                       "Det finns ingen skillnad; båda beskriver exakt samma sak i en reaktion.",
                       "O₂ är en molekyl med två atomer medan 2O är två fristående atomer."
                   ],
                   correct: 3,
                   explanation: "Siffran nertill (O₂) visar att atomerna sitter ihop i en <strong>molekyl</strong>. Siffran framför (2O) visar två <strong>separata</strong> atomer."
               },
               {
                   q: "Hur balanseras reaktionsformeln för bildandet av vatten: H₂ + O₂ → H₂O?",
                   options: [
                       "H₂ + O₂ → H₂O₂",
                       "2H + 2O → 2H₂O",
                       "2H₂ + O₂ → 2H₂O",
                       "H₂ + O → H₂O"
                   ],
                   correct: 2,
                   explanation: "Det måste finnas lika många atomer av varje slag på båda sidor (4 väte, 2 syre)."
               },
               {
                   q: "Vilken är enzymernas huvudsakliga funktion i kroppens kemiska reaktioner?",
                   options: [
                       "De ökar hastigheten på reaktionerna utan att själva förbrukas.",
                       "De fungerar som bränsle och ger energi till alla celler i musklerna.",
                       "De ändrar atomnumret på de ämnen som vi får i oss via maten vi äter.",
                       "De ser till att pH-värdet i magen alltid ligger på en helt neutral nivå."
                   ],
                   correct: 0,
                   explanation: "Enzymer fungerar som biologiska katalysatorer som <strong>påskyndar</strong> processer."
               }
           ]
       },
       {
           title: "Del 5: Luftens gaser",
           icon: "☁️",
           text: "Atmosfären består främst av <strong>kvävgas</strong> (N₂, 78 %) och <strong>syrgas</strong> (O₂, 21 %). Kvävgas är reaktionströg, medan syre är mycket reaktivt. <strong>Koldioxid</strong> (CO₂) är en växthusgas. <strong>Ädelgaser</strong> finns i små mängder och används bland annat i glödlampor.",
           questions: [
               {
                   q: "Vilken gas är den vanligaste i jordens atmosfär?",
                   options: [
                       "Syrgas",
                       "Kvävgas",
                       "Koldioxid",
                       "Vattenånga"
                   ],
                   correct: 1,
                   explanation: "Hela 78 % av luften består av <strong>kvävgas</strong> (N₂)."
               },
               {
                   q: "Vad kallas de kemiska föreningar som bildas när ett ämne reagerar med syre?",
                   options: [
                       "Salter",
                       "Syror",
                       "Baser",
                       "Oxider"
                   ],
                   correct: 3,
                   explanation: "Syre är mycket reaktivt och bildar föreningar som kallas <strong>oxider</strong> (t.ex. koldioxid, järnoxid)."
               },
               {
                   q: "Varför fyller man ofta glödlampor med ädelgaser som argon istället för vanlig luft?",
                   options: [
                       "För att lampan ska väga mindre eftersom ädelgaser har lägst densitet.",
                       "För att lampan ska lysa med ett starkt blått ljus vid hög temperatur.",
                       "För att glödtråden inte ska reagera med syre och brinna upp direkt.",
                       "För att ädelgaser leder elektricitet mycket bättre än vad vanlig luft gör."
                   ],
                   correct: 2,
                   explanation: "Vanlig luft innehåller syre som skulle få glödtråden att brinna upp. Ädelgaser <strong>reagerar inte</strong>."
               },
               {
                   q: "Vilken egenskap hos koldioxid utnyttjas när man släcker bränder med en kolsyresläckare?",
                   options: [
                       "Koldioxid är tyngre än syre och kväver därmed elden effektivt.",
                       "Koldioxid reagerar med bränslet och förvandlar det till ofarligt vatten.",
                       "Koldioxid är en mycket kall gas som sänker temperaturen till noll grader.",
                       "Koldioxid innehåller mycket syre som drar åt sig värmen från lågorna."
                   ],
                   correct: 0,
                   explanation: "Koldioxid är <strong>tyngre än luft</strong> och lägger sig som ett lock över elden, vilket tränger undan syret."
               }
           ]
       },
       {
           title: "Del 6: Eld och förbränning",
           icon: "🔥",
           text: "För att det ska brinna krävs <strong>syre</strong>, <strong>värme</strong> och ett <strong>brännbart ämne</strong>. Vid förbränning av kolväten reagerar kolet och vätet med syre och bildar <strong>koldioxid</strong> och <strong>vatten</strong>.",
           questions: [
               {
                   q: "Vilka ämnen bildas nästan alltid när ett kolväte (som gasol eller stearin) brinner helt?",
                   options: [
                       "Kol, syre och värme.",
                       "Kvävgas och vattenånga.",
                       "Koldioxid och vätgas.",
                       "Koldioxid och vatten."
                   ],
                   correct: 3,
                   explanation: "Vid förbränning reagerar kolatomer till <strong>koldioxid</strong> och väteatomer till <strong>vatten</strong>."
               },
               {
                   q: "Amel bränner en bit stålull på en våg och ser att massan ökar. Varför ökar massan?",
                   options: [
                       "För att värmen får järnatomerna att svälla och bli större än tidigare.",
                       "För att järnatomerna i stålullen binder till sig syre från luften.",
                       "För att koldioxid från luften fastnar som ett lager av sot på järnet.",
                       "För att järnet omvandlas till guld som har en betydligt högre densitet."
                   ],
                   correct: 1,
                   explanation: "Kemisk reaktion sker där <strong>syreatomer</strong> från luften binds till metallen (järnoxid bildas), vilket ökar vikten."
               },
               {
                   q: "Vilken viktig process i naturen kan beskrivas som en 'omvänd' förbränning där energi lagras?",
                   options: [
                       "Cellandning",
                       "Försurning",
                       "Fotosyntes",
                       "Korrosion"
                   ],
                   correct: 2,
                   explanation: "Vid <strong>fotosyntesen</strong> tar växterna upp energi och bygger ihop koldioxid och vatten till socker (omvänd förbränning)."
               }
           ]
       }
   ];


   // --- STATE MANAGEMENT ---
   let currentSectionIndex = 0;
   let currentQuestionIndex = 0; // Relative to current section
   let score = 0;
   let userAnswers = [];
   let state = 'intro'; // 'intro', 'question', 'summary'


   // --- DOM ELEMENTS ---
   const app = document.getElementById('app');
   const headerTitle = document.getElementById('header-title');
   const progressBar = document.getElementById('progress-bar');


   // --- MAIN RENDER FUNCTION ---
   function render() {
       if (state === 'summary') {
           renderSummary();
           return;
       }


       const section = quizData[currentSectionIndex];


       // Update Header with smooth fade
       headerTitle.style.opacity = '0';
       setTimeout(() => {
           headerTitle.innerText = section.title;
           headerTitle.style.transition = 'opacity 0.2s';
           headerTitle.style.opacity = '1';
       }, 150);


       // Calculate total progress
       let totalQuestions = 0;
       let answeredQuestions = 0;
      
       quizData.forEach((sec, idx) => {
           totalQuestions += sec.questions.length;
           if (idx < currentSectionIndex) {
               answeredQuestions += sec.questions.length;
           } else if (idx === currentSectionIndex && state === 'question') {
               answeredQuestions += currentQuestionIndex;
           }
       });
       const pct = (answeredQuestions / totalQuestions) * 100;
       progressBar.style.width = `${pct}%`;


       if (state === 'intro') {
           renderSectionIntro(section);
       } else if (state === 'question') {
           renderQuestion(section.questions[currentQuestionIndex]);
       }
   }


   // --- RENDER SECTION TEXT ---
   function renderSectionIntro(section) {
       // Simple animation class reset
       app.classList.remove('fade-in');
       void app.offsetWidth; // trigger reflow
       app.classList.add('fade-in');


       app.innerHTML = `
           <div class="fact-box">
               <span class="fact-icon">${section.icon}</span>
               <div class="fact-content">
                   <h2>Fakta</h2>
                   <p style="line-height: 1.6; font-size: 1rem; margin-top:0;">${section.text}</p>
               </div>
           </div>
           <button class="btn" onclick="startQuestions()">Starta frågor för denna del</button>
       `;
   }


   // --- RENDER QUESTION ---
   function renderQuestion(q) {
       const totalInCurrent = quizData[currentSectionIndex].questions.length;
      
       // Render with reset styles for feedback box
       app.innerHTML = `
           <div class="question-meta">Del ${currentSectionIndex + 1} • Fråga ${currentQuestionIndex + 1}/${totalInCurrent}</div>
           <h2 style="color: var(--text-main); font-weight: 600; margin-bottom:15px;">${q.q}</h2>
           <div class="options-grid">
               ${q.options.map((opt, idx) => `
                   <button class="option-btn" onclick="handleAnswer(${idx})" id="opt-${idx}">${opt}</button>
               `).join('')}
           </div>
           <div id="feedback" class="feedback-box">
               <h3 id="feedback-title"></h3>
               <p id="feedback-text" style="margin: 5px 0 15px 0; font-size: 0.95rem; line-height: 1.6;"></p>
               <button class="btn" id="next-btn" onclick="nextStep()" style="margin-top:0; width: auto; min-width: 150px;">Nästa fråga ➔</button>
           </div>
       `;
   }


   // --- RENDER SUMMARY ---
   function renderSummary() {
       headerTitle.innerText = "Sammanfattning";
       progressBar.style.width = '100%';
      
       let totalQ = 0;
       quizData.forEach(s => totalQ += s.questions.length);
      
       // Calculate score
       let correctCount = userAnswers.filter(a => a.isCorrect).length;
       let pct = Math.round((correctCount / totalQ) * 100);
      
       let gradeTitle = "";
      
       if(pct > 90) { gradeTitle = "Fantastiskt bra! 🏆"; }
       else if(pct > 70) { gradeTitle = "Mycket bra jobbat! 🌟"; }
       else if(pct > 50) { gradeTitle = "Godkänt! 👍"; }
       else { gradeTitle = "Fortsätt kämpa! 💪"; }


       let html = `
           <div class="summary-stats">
               <h2 style="color:var(--brand-color); margin:0 0 10px 0;">${gradeTitle}</h2>
               <span class="summary-score">${correctCount}/${totalQ}</span>
               <span style="color:#666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Rätt svar</span>
               <button class="btn" onclick="location.reload()" style="background: transparent; border: 2px solid var(--accent-color); color: var(--accent-color); margin-top: 20px; box-shadow:none; width: auto; padding: 10px 30px;">Gör om testet</button>
           </div>
           <h3 style="margin: 0 0 10px 0; font-size: 1.1rem; color: var(--text-muted);">Dina svar:</h3>
           <div class="summary-list">
       `;


       userAnswers.forEach((ans, idx) => {
           const isCorrect = ans.isCorrect;
          
           html += `
               <div class="summary-item">
                   <span class="summary-question">${idx + 1}. ${ans.question}</span>
                   <div class="summary-answer-row">
                       ${isCorrect
                           ? `<span class="summary-correct-text">✔ ${ans.userAnswer}</span>`
                           : `<span class="summary-wrong-text">✖ ${ans.userAnswer}</span> <span style="margin: 0 5px; color:#999;">➔</span> <span class="real-answer">${ans.correctAnswer}</span>`
                       }
                   </div>
               </div>
           `;
       });


       html += `</div>`;
       app.innerHTML = html;
   }


   // --- LOGIC FUNCTIONS ---
   window.startQuestions = function() {
       state = 'question';
       currentQuestionIndex = 0;
       render();
   };


   window.handleAnswer = function(selectedIndex) {
       // Disable all buttons
       const buttons = document.querySelectorAll('.option-btn');
       buttons.forEach(b => b.disabled = true);


       const section = quizData[currentSectionIndex];
       const currentQ = section.questions[currentQuestionIndex];
       const isCorrect = selectedIndex === currentQ.correct;


       // Visual feedback on buttons
       const selectedBtn = document.getElementById(`opt-${selectedIndex}`);
       const correctBtn = document.getElementById(`opt-${currentQ.correct}`);


       if (isCorrect) {
           selectedBtn.classList.add('correct');
       } else {
           selectedBtn.classList.add('incorrect');
           correctBtn.classList.add('correct'); // Show which one was right
       }


       // Show feedback box
       const feedbackBox = document.getElementById('feedback');
       const feedbackTitle = document.getElementById('feedback-title');
       const feedbackText = document.getElementById('feedback-text');
       const nextBtn = document.getElementById('next-btn');


       feedbackBox.style.display = 'block';
      
       // Add class for success/error styling
       if (isCorrect) {
           feedbackBox.className = "feedback-box success";
           feedbackTitle.innerHTML = "Rätt svar!";
       } else {
           feedbackBox.className = "feedback-box error";
           feedbackTitle.innerHTML = "Inte riktigt...";
       }
      
       feedbackText.innerHTML = currentQ.explanation; // Use innerHTML to render <strong> tags


       // Check if last question of entire quiz
       const isLastQuestionOverall = (currentSectionIndex === quizData.length - 1) && (currentQuestionIndex === section.questions.length - 1);
      
       if(isLastQuestionOverall) {
           nextBtn.innerText = "Se resultat 🏁";
       } else if (currentQuestionIndex === section.questions.length - 1) {
           nextBtn.innerText = "Nästa del ➔";
       }


       // Scroll to feedback if needed on mobile, but gently
       const rect = feedbackBox.getBoundingClientRect();
       const isVisible = (rect.top >= 0) && (rect.bottom <= window.innerHeight);
       if (!isVisible) {
            setTimeout(() => {
               feedbackBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
           }, 100);
       }


       // Save data
       userAnswers.push({
           question: currentQ.q,
           userAnswer: currentQ.options[selectedIndex],
           correctAnswer: currentQ.options[currentQ.correct],
           isCorrect: isCorrect
       });
   };


   window.nextStep = function() {
       const section = quizData[currentSectionIndex];
      
       // Reset feedback styles for next render
       const feedbackBox = document.getElementById('feedback');
       if(feedbackBox) {
           feedbackBox.style.display = 'none';
       }


       // Check if there are more questions in this section
       if (currentQuestionIndex < section.questions.length - 1) {
           currentQuestionIndex++;
           render();
       } else {
           // End of section, move to next section
           if (currentSectionIndex < quizData.length - 1) {
               currentSectionIndex++;
               state = 'intro';
               render();
           } else {
               // End of quiz
               state = 'summary';
               render();
           }
       }
   };


   // --- INIT ---
   render();


</script>


</body>
</html>