<!DOCTYPE html>
<html lang="sv">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Biologiquiz: Ekologi & Hållbarhet (Åk 9)</title>
   <!-- Importerar moderna fonter från Google Fonts -->
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  
   <style>
       :root {
           /* Färgpalett - Grönt Tema med Komplement */
           --card-bg: #ffffff;
          
           --brand-color: #2e7d32; /* Basgrön */
           --brand-gradient: linear-gradient(135deg, #2e7d32 0%, #66bb6a 100%);
          
           --accent-color: #66bb6a;
          
           /* Komplementfärg: Terra Cotta / Bränd Orange */
           --complement-color: #d84315;


           --success-color: #2e7d32;
           --success-bg: #e8f5e9;
          
           --error-color: #c62828;
           --error-bg: #ffebee;
          
           --text-main: #212121; /* Mörkare grå/svart för text */
           --text-muted: #616161;
          
           --shadow-card: 0 10px 25px rgba(0,0,0,0.1);
           --shadow-hover: 0 6px 16px rgba(0,0,0,0.12);
           --radius-main: 16px;
       }


       body {
           font-family: 'Open Sans', sans-serif;
           /* Mer neutral bakgrund (ljusgrå/vit) med svag grön ton */
           background-image: linear-gradient(135deg, #f5f5f5 0%, #e8f5e9 100%);
           color: var(--text-main);
           margin: 0;
           padding: 15px;
           display: flex;
           justify-content: center;
           align-items: flex-start;
           min-height: 100vh;
       }


       .container {
           background-color: var(--card-bg);
           width: 100%;
           max-width: 680px;
           border-radius: var(--radius-main);
           box-shadow: var(--shadow-card);
           overflow: hidden;
           display: flex;
           flex-direction: column;
           position: relative;
           margin-top: 3vh;
           margin-bottom: 3vh;
       }


       header {
           background: var(--brand-gradient);
           color: white;
           padding: 20px;
           text-align: center;
           position: relative;
           overflow: hidden;
       }


       h1 {
           font-family: 'Poppins', sans-serif;
           margin: 0;
           font-size: 1.5rem;
           font-weight: 700;
           letter-spacing: -0.3px;
       }


       .content-area {
           padding: 25px 30px;
           flex-grow: 1;
       }


       h2 {
           font-family: 'Poppins', sans-serif;
           color: var(--text-main);
           margin-top: 0;
           font-size: 1.3rem;
           margin-bottom: 0.8rem;
           line-height: 1.3;
       }


       /* Fact Section Styles */
       .fact-box {
           background: #ffffff;
           border: 1px solid #eeeeee;
           border-radius: 12px;
           padding: 20px;
           margin-bottom: 20px;
           display: flex;
           gap: 15px;
           align-items: flex-start;
           box-shadow: 0 2px 8px rgba(0,0,0,0.03);
       }
      
       .fact-icon {
           font-size: 2rem;
           display: block;
           margin-top: -5px;
           color: var(--complement-color); /* Komplementfärg på ikonen */
       }
      
       .fact-content {
           flex: 1;
       }


       .btn {
           background: var(--brand-gradient);
           color: white;
           border: none;
           padding: 12px 24px;
           font-family: 'Poppins', sans-serif;
           font-size: 1rem;
           font-weight: 600;
           border-radius: 8px;
           cursor: pointer;
           transition: all 0.2s ease;
           display: block;
           width: 100%;
           margin-top: 20px;
           box-shadow: 0 4px 10px rgba(46, 125, 50, 0.2);
       }


       .btn:hover {
           transform: translateY(-2px);
           box-shadow: 0 6px 14px rgba(46, 125, 50, 0.3);
           opacity: 0.95;
       }


       /* Question Styles */
       .question-meta {
           display: inline-block;
           color: var(--complement-color); /* Subtil användning av komplementfärgen */
           font-size: 0.85rem;
           margin-bottom: 10px;
           font-weight: 700;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }


       .options-grid {
           display: grid;
           gap: 12px;
           margin-top: 20px;
       }


       .option-btn {
           background-color: #fff;
           border: 2px solid #f5f5f5;
           padding: 15px 20px;
           text-align: left;
           border-radius: 10px;
           cursor: pointer;
           font-family: 'Open Sans', sans-serif;
           font-size: 0.95rem;
           font-weight: 500;
           transition: all 0.15s ease;
           color: var(--text-main);
           position: relative;
       }


       .option-btn:hover:not(:disabled) {
           border-color: var(--accent-color);
           background-color: #f1f8e9;
           transform: translateX(3px);
           box-shadow: 0 2px 5px rgba(0,0,0,0.05);
       }
      
       /* Status states for options */
       .option-btn.correct {
           background-color: var(--success-bg);
           border-color: var(--success-color);
           color: #1b5e20;
           font-weight: 600;
       }
      
       .option-btn.correct::after {
           content: "✓";
           position: absolute;
           right: 15px;
           font-weight: bold;
       }


       .option-btn.incorrect {
           background-color: var(--error-bg);
           border-color: var(--error-color);
           color: #b71c1c;
           opacity: 0.8;
       }


       .option-btn:disabled {
           cursor: default;
       }


       /* Feedback Box */
       .feedback-box {
           margin-top: 20px;
           padding: 20px 25px;
           border-radius: 12px;
           background-color: #f9f9f9;
           color: var(--text-main);
           border: 1px solid #e0e0e0;
           display: none;
           animation: fadeIn 0.3s ease;
       }
      
       .feedback-box h3 {
           margin-top: 0;
           font-family: 'Poppins', sans-serif;
           font-size: 1.2rem;
           display: flex;
           align-items: center;
           gap: 8px;
           margin-bottom: 8px;
       }


       .feedback-box.success h3 {
           color: var(--success-color);
       }
      
       .feedback-box.error h3 {
           color: var(--error-color);
       }


       .feedback-box strong {
           color: #000; /* Svart för tydlighet i feedback */
       }


       @keyframes fadeIn {
           from { opacity: 0; transform: translateY(5px); }
           to { opacity: 1; transform: translateY(0); }
       }


       /* Progress Bar Styles */
       .progress-bar-container {
           height: 6px;
           background-color: #eeeeee;
           width: 100%;
           position: relative;
           z-index: 10;
       }


       .progress-bar {
           height: 100%;
           /* Grön gradient */
           background: linear-gradient(90deg, #66bb6a 0%, #2e7d32 100%);
           width: 0%;
           transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
           border-radius: 0 4px 4px 0;
           box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
       }


       /* Summary Styles */
       .summary-stats {
           text-align: center;
           background: linear-gradient(135deg, #f1f8e9 0%, #dcedc8 100%);
           border: 1px solid #c5e1a5;
           padding: 30px 20px;
           border-radius: 12px;
           margin-bottom: 20px;
       }


       .summary-score {
           font-size: 3.5rem;
           font-family: 'Poppins', sans-serif;
           font-weight: 700;
           display: block;
           margin: 5px 0;
           line-height: 1;
           background: linear-gradient(135deg, #1b5e20 0%, #43a047 100%);
           -webkit-background-clip: text;
           -webkit-text-fill-color: transparent;
       }
      
       .summary-list {
           max-height: 400px;
           overflow-y: auto;
           padding-right: 10px;
       }
      
       .summary-item {
           background: white;
           border-bottom: 1px solid #eeeeee;
           padding: 12px 0;
       }
      
       .summary-item:last-child {
           border-bottom: none;
       }


       .summary-question {
           font-weight: 600;
           margin-bottom: 4px;
           display: block;
           font-size: 0.95rem;
       }
      
       .summary-answer-row {
           font-size: 0.9rem;
       }


       .summary-correct-text { color: var(--success-color); font-weight: 600; }
       .summary-wrong-text { color: var(--error-color); text-decoration: line-through; opacity: 0.8;}
       .real-answer { color: var(--success-color); font-weight: 600; margin-left: 5px; }


       /* Helpers */
       strong {
           color: #000; /* Svarta fetstilade ord */
           font-weight: 700;
       }


   </style>
</head>
<body>


<div class="container">
   <header>
       <h1 id="header-title">Biologiquiz: Ekologi & Hållbarhet</h1>
   </header>
   <div class="progress-bar-container">
       <div class="progress-bar" id="progress-bar"></div>
   </div>


   <div class="content-area" id="app">
       <!-- Content will be injected here by JavaScript -->
   </div>
</div>


<script>
   // --- DATA ---
   const quizData = [
       {
           title: "Del 1: Ekosystemets grunder",
           icon: "🌲",
           text: "<strong>Ekologi</strong> beskriver samspelet mellan organismer och deras miljö. Ett <strong>ekosystem</strong> är ett avgränsat område där detta samspel sker. <strong>Abiotiska faktorer</strong> är icke-levande ting som påverkar, t.ex. temperatur och ljus. <strong>Biotiska faktorer</strong> är levande påverkan, som mat och konkurrens. Alla individer av samma art inom ekosystemet kallas för en <strong>population</strong>.",
           questions: [
               {
                   q: "Vad kallas de icke-levande delarna av ett ekosystem, såsom ljus och temperatur?",
                   options: [
                       "Abiotiska faktorer",
                       "Biotiska faktorer",
                       "Ekosystemtjänster",
                       "Populationer"
                   ],
                   correct: 0,
                   explanation: "<strong>Abiotiska faktorer</strong> är de fysikaliska och kemiska förutsättningarna i miljön som inte är levande."
               },
               {
                   q: "Vad är en population i ett ekosystem?",
                   options: [
                       "Alla djur som äter växter",
                       "Alla individer av samma art inom ett område",
                       "Den totala vikten av allt levande",
                       "Samspelet mellan djur och växter"
                   ],
                   correct: 1,
                   explanation: "En <strong>population</strong> definieras som alla individer av en och samma art i ett avgränsat område."
               },
               {
                   q: "Vilken tidsordning beskriver bäst livets tidiga utveckling på jorden?",
                   options: [
                       "Syrgas bildas → Liv på land → Fotosyntes utvecklas",
                       "Liv på land → Fotosyntes utvecklas → Syrgas bildas",
                       "Fotosyntes utvecklas → Syrgas bildas → Liv etableras på land",
                       "Syrgas bildas → Fotosyntes utvecklas → Liv etableras på land"
                   ],
                   correct: 2,
                   explanation: "<strong>Fotosyntesen</strong> behövde utvecklas först för att producera syre, vilket senare möjliggjorde liv på land."
               }
           ]
       },
       {
           title: "Del 2: Fotosyntes & Cellandning",
           icon: "🍃",
           text: "<strong>Fotosyntesen</strong> sker i växternas gröna blad där solljus, vatten och koldioxid omvandlas till <strong>druvsocker</strong> och <strong>syre</strong>. Detta är grunden för nästan allt liv. <strong>Cellandning</strong> (förbränning) är fotosyntesen baklänges: cellerna använder socker och syre för att utvinna energi, och bildar då koldioxid och vatten.",
           questions: [
               {
                   q: "Vilka ämnen bildas vid fotosyntesen?",
                   options: [
                       "Koldioxid och vatten",
                       "Druvsocker och koldioxid",
                       "Vatten och syre",
                       "Syre och druvsocker"
                   ],
                   correct: 3,
                   explanation: "Växter omvandlar solljus till kemisk energi i form av <strong>socker</strong> och släpper ut <strong>syre</strong> som restprodukt."
               },
               {
                   q: "Vad krävs för att cellandning (förbränning) ska ske i en cell?",
                   options: [
                       "Socker och syre",
                       "Solljus och vatten",
                       "Koldioxid och energi",
                       "Närsalter och klorofyll"
                   ],
                   correct: 0,
                   explanation: "<strong>Cellandningen</strong> behöver bränsle (socker) och syre för att kunna frigöra energi till organismen."
               },
               {
                   q: "Vilket ämne i luften ökar i mängd vid cellandning men minskar vid fotosyntes?",
                   options: [
                       "Syre",
                       "Koldioxid",
                       "Kväve",
                       "Vattenånga"
                   ],
                   correct: 1,
                   explanation: "Fotosyntesen tar upp <strong>koldioxid</strong> från luften, medan cellandningen släpper ut det som en restprodukt."
               }
           ]
       },
       {
           title: "Del 3: Energiflöden & Kretslopp",
           icon: "♻️",
           text: "Energi flödar genom ekosystemet och kommer ursprungligen från solen. I varje steg i en <strong>näringskedja</strong> försvinner ca 90 % av energin som värme; endast <strong>10 %</strong> går vidare. Materia, som kol, cirkulerar däremot i <strong>kretslopp</strong>. Kolet binds i växter genom fotosyntes och återgår till luften genom cellandning eller förbränning.",
           questions: [
               {
                   q: "Varför finns det oftast fler växtätare än rovdjur i ett stabilt ekosystem?",
                   options: [
                       "Rovdjur lever längre än växtätare",
                       "Växtätare förökar sig långsammare",
                       "Endast 10 % av energin går vidare till nästa steg i näringskedjan",
                       "Rovdjur äter bara växter i nödfall"
                   ],
                   correct: 2,
                   explanation: "Eftersom det mesta av energin går <strong>förlorad som värme</strong> i varje steg, räcker energin till färre individer högre upp."
               },
               {
                   q: "Vad händer med kolet i ett träd som dör och förmultnar i skogen?",
                   options: [
                       "Det försvinner helt från jorden",
                       "Det omvandlas till ren energi",
                       "Det stannar i träet för evigt",
                       "Det återgår till atmosfären som koldioxid"
                   ],
                   correct: 3,
                   explanation: "Nedbrytare förbränner det organiska materialet genom cellandning, vilket frigör <strong>kolet</strong> tillbaka till luften."
               },
               {
                   q: "En näringskedja börjar alltid med en...",
                   options: [
                       "Producent (växt)",
                       "Toppkonsument (rovdjur)",
                       "Nedbrytare (svamp)",
                       "Förstahandskonsument (växtätare)"
                   ],
                   correct: 0,
                   explanation: "<strong>Producenter</strong> är de enda som kan binda solenergi och skapa ny biomassa som resten av kedjan lever av."
               }
           ]
       },
       {
           title: "Del 4: Populationer och Balans",
           icon: "⚖️",
           text: "I ett stabilt ekosystem finns en balans. Om antalet bytesdjur ökar, ökar även antalet rovdjur. <strong>Begränsande faktorer</strong> för en population kan vara mat, boplatser och rovdjur. <strong>Konkurrens</strong> uppstår när resurserna inte räcker. En arts speciella 'yrke' eller behov kallas dess <strong>ekologiska nisch</strong>.",
           questions: [
               {
                   q: "Vad händer i en näringskedja (Växtplankton → Djurplankton → Skarpsill → Torsk) om torsken minskar kraftigt?",
                   options: [
                       "Mängden växtplankton minskar",
                       "Mängden skarpsill ökar",
                       "Mängden djurplankton ökar",
                       "Alla arter i kedjan minskar"
                   ],
                   correct: 1,
                   explanation: "Om rovdjuret (torsk) försvinner, ökar antalet bytesdjur (<strong>skarpsill</strong>) eftersom ingen äter upp dem."
               },
               {
                   q: "Vilken faktor kan begränsa hur stor en population av rådjur blir?",
                   options: [
                       "Ökad mängd solljus",
                       "Tillgång på närsalter i marken",
                       "Brist på mat och vinterklimat",
                       "Hur många träd som planteras"
                   ],
                   correct: 2,
                   explanation: "Matbrist, rovdjur och hårda vintrar är naturliga faktorer som <strong>reglerar populationens</strong> storlek."
               },
               {
                   q: "Vad menas med ekologisk nisch?",
                   options: [
                       "Det område där en art sover",
                       "När två arter samarbetar",
                       "Ett kretslopp av närsalter",
                       "Det speciella område och levnadssätt en art har specialiserat sig på"
                   ],
                   correct: 3,
                   explanation: "En <strong>nisch</strong> är artens 'yrke' eller behov, vilket gör att olika arter kan leva i samma område utan att konkurrera."
               }
           ]
       },
       {
           title: "Del 5: Människan & Hållbarhet",
           icon: "🌍",
           text: "Människans påverkan är global. <strong>Övergödning</strong> orsakas av utsläpp av närsalter, vilket leder till algblomning. <strong>Biologisk mångfald</strong> ger stabila ekosystem. <strong>Ekosystemtjänster</strong> är gratistjänster från naturen, t.ex. pollinering. Ett <strong>ekologiskt fotavtryck</strong> mäter hur mycket resurser vi använder.",
           questions: [
               {
                   q: "Vilket ämne bidrar mest till algblomning och övergödning i Östersjön?",
                   options: [
                       "Närsalter som kväve och fosfor",
                       "Koldioxid från bilar",
                       "Syre från vattenväxter",
                       "Saltvatten från Atlanten"
                   ],
                   correct: 0,
                   explanation: "<strong>Närsalter</strong> fungerar som gödning för alger, vilket vid för stora utsläpp leder till kraftig algblomning."
               },
               {
                   q: "Vad är ett exempel på en ekosystemtjänst?",
                   options: [
                       "Att vi bygger vindkraftverk",
                       "Att insekter pollinerar våra fruktträd",
                       "Att vi använder konstgödsel på åkrar",
                       "Att vi fiskar med stora trålare"
                   ],
                   correct: 1,
                   explanation: "<strong>Ekosystemtjänster</strong> är naturens egna processer som ger oss människor nytta, såsom pollinering eller vattenrening."
               },
               {
                   q: "Varför är biologisk mångfald viktig för ett ekosystem?",
                   options: [
                       "Det gör att vi kan jaga fler djur",
                       "Det minskar antalet mutationer",
                       "Det gör ekosystemet mer stabilt mot förändringar",
                       "Det gör att fotosyntesen går snabbare"
                   ],
                   correct: 2,
                   explanation: "Ett artrikt ekosystem är mer <strong>tåligt (stabilt)</strong> eftersom det finns fler arter som kan ta över roller om en art försvinner."
               },
               {
                   q: "Vilken mänsklig aktivitet har störst negativ påverkan på torskbeståndet?",
                   options: [
                       "Plantering av skog",
                       "Användning av solenergi",
                       "Utsläpp av koldioxid",
                       "Överfiske och syrebrist på bottnar"
                   ],
                   correct: 3,
                   explanation: "<strong>Överfiske</strong> tar bort för många vuxna fiskar, och syrebrist (pga övergödning) förstör deras lekområden."
               },
               {
                   q: "Vad innebär begreppet 'ekologiskt fotavtryck'?",
                   options: [
                       "Ett mått på hur mycket yta en människa behöver för sina resurser",
                       "Hur djur rör sig i ett ekosystem",
                       "Mängden koldioxid en växt tar upp",
                       "Hur djupt ner i jorden rötter växer"
                   ],
                   correct: 0,
                   explanation: "Det <strong>ekologiska fotavtrycket</strong> visar hur stor del av jordens yta som krävs för att producera allt vi förbrukar."
               },
               {
                   q: "Varför anses baljväxter ofta mer miljövänliga att odla än spannmål?",
                   options: [
                       "De behöver mer vatten",
                       "De kan binda kväve från luften och behöver mindre gödsel",
                       "De växer snabbare i mörker",
                       "De innehåller inget protein"
                   ],
                   correct: 1,
                   explanation: "Baljväxter har bakterier i rötterna som <strong>binder kväve</strong>, vilket minskar behovet av miljöbelastande konstgödsel."
               },
               {
                   q: "Vad är en invasiv art?",
                   options: [
                       "En art som håller på att dö ut",
                       "En art som alltid funnits i Sverige",
                       "En art som flyttats till en ny miljö och sprider sig okontrollerat",
                       "En art som endast äter kött"
                   ],
                   correct: 2,
                   explanation: "<strong>Invasiva arter</strong> saknar ofta naturliga fiender i den nya miljön och kan därför skada det lokala ekosystemet."
               },
               {
                   q: "Vilket drivmedel bidrar inte till ett ökat nettotillskott av koldioxid till atmosfären i samma utsträckning som bensin?",
                   options: [
                       "Diesel",
                       "Naturgas",
                       "Stenkol",
                       "Etanol från växter"
                   ],
                   correct: 3,
                   explanation: "<strong>Etanol</strong> kommer från växter som nyligen tagit upp koldioxid från luften, till skillnad från fossila bränslen."
               }
           ]
       }
   ];


   // --- STATE MANAGEMENT ---
   let currentSectionIndex = 0;
   let currentQuestionIndex = 0; // Relative to current section
   let score = 0;
   let userAnswers = [];
   let state = 'intro'; // 'intro', 'question', 'summary'


   // --- DOM ELEMENTS ---
   const app = document.getElementById('app');
   const headerTitle = document.getElementById('header-title');
   const progressBar = document.getElementById('progress-bar');


   // --- MAIN RENDER FUNCTION ---
   function render() {
       if (state === 'summary') {
           renderSummary();
           return;
       }


       const section = quizData[currentSectionIndex];


       // Update Header with smooth fade
       headerTitle.style.opacity = '0';
       setTimeout(() => {
           headerTitle.innerText = section.title;
           headerTitle.style.transition = 'opacity 0.2s';
           headerTitle.style.opacity = '1';
       }, 150);


       // Calculate total progress
       let totalQuestions = 0;
       let answeredQuestions = 0;
      
       quizData.forEach((sec, idx) => {
           totalQuestions += sec.questions.length;
           if (idx < currentSectionIndex) {
               answeredQuestions += sec.questions.length;
           } else if (idx === currentSectionIndex && state === 'question') {
               answeredQuestions += currentQuestionIndex;
           }
       });
       const pct = (answeredQuestions / totalQuestions) * 100;
       progressBar.style.width = `${pct}%`;


       if (state === 'intro') {
           renderSectionIntro(section);
       } else if (state === 'question') {
           renderQuestion(section.questions[currentQuestionIndex]);
       }
   }


   // --- RENDER SECTION TEXT ---
   function renderSectionIntro(section) {
       // Simple animation class reset
       app.classList.remove('fade-in');
       void app.offsetWidth; // trigger reflow
       app.classList.add('fade-in');


       app.innerHTML = `
           <div class="fact-box">
               <span class="fact-icon">${section.icon}</span>
               <div class="fact-content">
                   <h2>Fakta</h2>
                   <p style="line-height: 1.6; font-size: 1rem; margin-top:0;">${section.text}</p>
               </div>
           </div>
           <button class="btn" onclick="startQuestions()">Starta frågor för denna del</button>
       `;
   }


   // --- RENDER QUESTION ---
   function renderQuestion(q) {
       const totalInCurrent = quizData[currentSectionIndex].questions.length;
      
       // Render with reset styles for feedback box
       app.innerHTML = `
           <div class="question-meta">Del ${currentSectionIndex + 1} • Fråga ${currentQuestionIndex + 1}/${totalInCurrent}</div>
           <h2 style="color: var(--text-main); font-weight: 600; margin-bottom:15px;">${q.q}</h2>
           <div class="options-grid">
               ${q.options.map((opt, idx) => `
                   <button class="option-btn" onclick="handleAnswer(${idx})" id="opt-${idx}">${opt}</button>
               `).join('')}
           </div>
           <div id="feedback" class="feedback-box">
               <h3 id="feedback-title"></h3>
               <p id="feedback-text" style="margin: 5px 0 15px 0; font-size: 0.95rem; line-height: 1.6;"></p>
               <button class="btn" id="next-btn" onclick="nextStep()" style="margin-top:0; width: auto; min-width: 150px;">Nästa fråga ➔</button>
           </div>
       `;
   }


   // --- RENDER SUMMARY ---
   function renderSummary() {
       headerTitle.innerText = "Sammanfattning";
       progressBar.style.width = '100%';
      
       let totalQ = 0;
       quizData.forEach(s => totalQ += s.questions.length);
      
       // Calculate score
       let correctCount = userAnswers.filter(a => a.isCorrect).length;
       let pct = Math.round((correctCount / totalQ) * 100);
      
       let gradeTitle = "";
      
       if(pct > 90) { gradeTitle = "Fantastiskt bra! 🏆"; }
       else if(pct > 70) { gradeTitle = "Mycket bra jobbat! 🌟"; }
       else if(pct > 50) { gradeTitle = "Godkänt! 👍"; }
       else { gradeTitle = "Fortsätt kämpa! 💪"; }


       let html = `
           <div class="summary-stats">
               <h2 style="color:var(--brand-color); margin:0 0 10px 0;">${gradeTitle}</h2>
               <span class="summary-score">${correctCount}/${totalQ}</span>
               <span style="color:#666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Rätt svar</span>
               <button class="btn" onclick="location.reload()" style="background: transparent; border: 2px solid var(--accent-color); color: var(--accent-color); margin-top: 20px; box-shadow:none; width: auto; padding: 10px 30px;">Gör om testet</button>
           </div>
           <h3 style="margin: 0 0 10px 0; font-size: 1.1rem; color: var(--text-muted);">Dina svar:</h3>
           <div class="summary-list">
       `;


       userAnswers.forEach((ans, idx) => {
           const isCorrect = ans.isCorrect;
          
           html += `
               <div class="summary-item">
                   <span class="summary-question">${idx + 1}. ${ans.question}</span>
                   <div class="summary-answer-row">
                       ${isCorrect
                           ? `<span class="summary-correct-text">✔ ${ans.userAnswer}</span>`
                           : `<span class="summary-wrong-text">✖ ${ans.userAnswer}</span> <span style="margin: 0 5px; color:#999;">➔</span> <span class="real-answer">${ans.correctAnswer}</span>`
                       }
                   </div>
               </div>
           `;
       });


       html += `</div>`;
       app.innerHTML = html;
   }


   // --- LOGIC FUNCTIONS ---
   window.startQuestions = function() {
       state = 'question';
       currentQuestionIndex = 0;
       render();
   };


   window.handleAnswer = function(selectedIndex) {
       // Disable all buttons
       const buttons = document.querySelectorAll('.option-btn');
       buttons.forEach(b => b.disabled = true);


       const section = quizData[currentSectionIndex];
       const currentQ = section.questions[currentQuestionIndex];
       const isCorrect = selectedIndex === currentQ.correct;


       // Visual feedback on buttons
       const selectedBtn = document.getElementById(`opt-${selectedIndex}`);
       const correctBtn = document.getElementById(`opt-${currentQ.correct}`);


       if (isCorrect) {
           selectedBtn.classList.add('correct');
       } else {
           selectedBtn.classList.add('incorrect');
           correctBtn.classList.add('correct'); // Show which one was right
       }


       // Show feedback box
       const feedbackBox = document.getElementById('feedback');
       const feedbackTitle = document.getElementById('feedback-title');
       const feedbackText = document.getElementById('feedback-text');
       const nextBtn = document.getElementById('next-btn');


       feedbackBox.style.display = 'block';
      
       // Add class for success/error styling
       if (isCorrect) {
           feedbackBox.className = "feedback-box success";
           feedbackTitle.innerHTML = "Rätt svar!";
       } else {
           feedbackBox.className = "feedback-box error";
           feedbackTitle.innerHTML = "Inte riktigt...";
       }
      
       feedbackText.innerHTML = currentQ.explanation; // Use innerHTML to render <strong> tags


       // Check if last question of entire quiz
       const isLastQuestionOverall = (currentSectionIndex === quizData.length - 1) && (currentQuestionIndex === section.questions.length - 1);
      
       if(isLastQuestionOverall) {
           nextBtn.innerText = "Se resultat 🏁";
       } else if (currentQuestionIndex === section.questions.length - 1) {
           nextBtn.innerText = "Nästa del ➔";
       }


       // Scroll to feedback if needed on mobile, but gently
       const rect = feedbackBox.getBoundingClientRect();
       const isVisible = (rect.top >= 0) && (rect.bottom <= window.innerHeight);
       if (!isVisible) {
            setTimeout(() => {
               feedbackBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
           }, 100);
       }


       // Save data
       userAnswers.push({
           question: currentQ.q,
           userAnswer: currentQ.options[selectedIndex],
           correctAnswer: currentQ.options[currentQ.correct],
           isCorrect: isCorrect
       });
   };


   window.nextStep = function() {
       const section = quizData[currentSectionIndex];
      
       // Reset feedback styles for next render
       const feedbackBox = document.getElementById('feedback');
       if(feedbackBox) {
           feedbackBox.style.display = 'none';
       }


       // Check if there are more questions in this section
       if (currentQuestionIndex < section.questions.length - 1) {
           currentQuestionIndex++;
           render();
       } else {
           // End of section, move to next section
           if (currentSectionIndex < quizData.length - 1) {
               currentSectionIndex++;
               state = 'intro';
               render();
           } else {
               // End of quiz
               state = 'summary';
               render();
           }
       }
   };


   // --- INIT ---
   render();


</script>


</body>
</html>