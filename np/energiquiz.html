<!DOCTYPE html>
<html lang="sv">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Fysikquiz: Energi & Teknik (Åk 9)</title>
   <!-- Importerar moderna fonter från Google Fonts -->
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  
   <style>
       :root {
           /* Färgpalett - Professionell & Ren */
           --card-bg: #ffffff;
          
           --brand-color: #2c3e50;
           --brand-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
          
           --accent-color: #3498db;
          
           --success-color: #10ac84;
           --success-bg: #e3f9f1;
          
           --error-color: #ee5253;
           --error-bg: #ffeded;
          
           --text-main: #2d3436;
           --text-muted: #636e72;
          
           --shadow-card: 0 10px 25px rgba(0,0,0,0.15); /* Lite starkare skugga för kontrast mot mörk bakgrund */
           --shadow-hover: 0 6px 16px rgba(0,0,0,0.12);
           --radius-main: 16px;
       }


       body {
           font-family: 'Open Sans', sans-serif;
           /* Ny bakgrund: En gråaktig fade (Silver/Metallic style) */
           background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
           color: var(--text-main);
           margin: 0;
           padding: 15px;
           display: flex;
           justify-content: center;
           align-items: flex-start;
           min-height: 100vh;
       }


       .container {
           background-color: var(--card-bg);
           width: 100%;
           max-width: 680px;
           border-radius: var(--radius-main);
           box-shadow: var(--shadow-card);
           overflow: hidden;
           display: flex;
           flex-direction: column;
           position: relative;
           margin-top: 3vh;
           margin-bottom: 3vh;
       }


       header {
           background: var(--brand-gradient);
           color: white;
           padding: 20px;
           text-align: center;
           position: relative;
           overflow: hidden;
       }


       h1 {
           font-family: 'Poppins', sans-serif;
           margin: 0;
           font-size: 1.5rem;
           font-weight: 700;
           letter-spacing: -0.3px;
       }


       .content-area {
           padding: 25px 30px;
           flex-grow: 1;
       }


       h2 {
           font-family: 'Poppins', sans-serif;
           color: var(--brand-color);
           margin-top: 0;
           font-size: 1.3rem;
           margin-bottom: 0.8rem;
           line-height: 1.3;
       }


       /* Fact Section Styles */
       .fact-box {
           background: #f8f9fa;
           border-radius: 12px;
           padding: 20px;
           margin-bottom: 20px;
           border-left: 4px solid var(--accent-color);
           display: flex;
           gap: 15px;
           align-items: flex-start;
       }
      
       .fact-icon {
           font-size: 2rem;
           display: block;
           margin-top: -5px;
       }
      
       .fact-content {
           flex: 1;
       }


       .btn {
           background: var(--brand-gradient);
           color: white;
           border: none;
           padding: 12px 24px;
           font-family: 'Poppins', sans-serif;
           font-size: 1rem;
           font-weight: 600;
           border-radius: 8px;
           cursor: pointer;
           transition: all 0.2s ease;
           display: block;
           width: 100%;
           margin-top: 20px;
           box-shadow: 0 4px 10px rgba(52, 152, 219, 0.2);
       }


       .btn:hover {
           transform: translateY(-2px);
           box-shadow: 0 6px 14px rgba(52, 152, 219, 0.3);
           opacity: 0.95;
       }


       /* Question Styles */
       .question-meta {
           display: inline-block;
           color: var(--text-muted);
           font-size: 0.85rem;
           margin-bottom: 10px;
           font-weight: 600;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }


       .options-grid {
           display: grid;
           gap: 12px;
           margin-top: 20px;
       }


       .option-btn {
           background-color: #fff;
           border: 2px solid #f1f2f6;
           padding: 15px 20px;
           text-align: left;
           border-radius: 10px;
           cursor: pointer;
           font-family: 'Open Sans', sans-serif;
           font-size: 0.95rem;
           font-weight: 500;
           transition: all 0.15s ease;
           color: var(--text-main);
           position: relative;
       }


       .option-btn:hover:not(:disabled) {
           border-color: var(--accent-color);
           background-color: #f8fcff;
           transform: translateX(3px);
           box-shadow: 0 2px 5px rgba(0,0,0,0.05);
       }
      
       /* Status states for options */
       .option-btn.correct {
           background-color: var(--success-bg);
           border-color: var(--success-color);
           color: #0b6e4f;
           font-weight: 600;
       }
      
       .option-btn.correct::after {
           content: "✓";
           position: absolute;
           right: 15px;
           font-weight: bold;
       }


       .option-btn.incorrect {
           background-color: var(--error-bg);
           border-color: var(--error-color);
           color: #c0392b;
           opacity: 0.8;
       }


       .option-btn:disabled {
           cursor: default;
       }


       /* Feedback Box - Återställd till ljus bakgrund utan kanter */
       .feedback-box {
           margin-top: 20px;
           padding: 20px 25px;
           border-radius: 12px;
           background-color: #f8f9fa; /* Ljus bakgrund igen */
           color: var(--text-main); /* Mörk text */
           border: 1px solid #e9ecef; /* Subtil ram istället för färgad kant */
           display: none;
           animation: fadeIn 0.3s ease;
       }
      
       /* Anpassa rubriken i feedback boxen */
       .feedback-box h3 {
           margin-top: 0;
           font-family: 'Poppins', sans-serif;
           font-size: 1.2rem;
           display: flex;
           align-items: center;
           gap: 8px;
           margin-bottom: 8px;
       }


       /* Specifika färger för rubriken beroende på rätt/fel */
       .feedback-box.success h3 {
           color: var(--success-color);
       }
      
       .feedback-box.error h3 {
           color: var(--error-color);
       }


       /* Strong taggar i ljus box */
       .feedback-box strong {
           color: var(--brand-color);
       }


       @keyframes fadeIn {
           from { opacity: 0; transform: translateY(5px); }
           to { opacity: 1; transform: translateY(0); }
       }


       /* Ny Progress Bar Styles */
       .progress-bar-container {
           height: 6px;
           background-color: #f1f3f5;
           width: 100%;
           position: relative;
           z-index: 10;
       }


       .progress-bar {
           height: 100%;
           /* Fadeblåaktig cyan gradient */
           background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
           width: 0%;
           transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
           border-radius: 0 4px 4px 0;
           box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
       }


       /* Summary Styles */
       .summary-stats {
           text-align: center;
           background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
           border: 1px solid #dee2e6;
           padding: 30px 20px;
           border-radius: 12px;
           margin-bottom: 20px;
       }


       .summary-score {
           font-size: 3.5rem;
           font-family: 'Poppins', sans-serif;
           font-weight: 700;
           display: block;
           margin: 5px 0;
           line-height: 1;
           background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
           -webkit-background-clip: text;
           -webkit-text-fill-color: transparent;
       }
      
       .summary-list {
           max-height: 400px;
           overflow-y: auto;
           padding-right: 10px;
       }
      
       .summary-item {
           background: white;
           border-bottom: 1px solid #f1f1f1;
           padding: 12px 0;
       }
      
       .summary-item:last-child {
           border-bottom: none;
       }


       .summary-question {
           font-weight: 600;
           margin-bottom: 4px;
           display: block;
           font-size: 0.95rem;
       }
      
       .summary-answer-row {
           font-size: 0.9rem;
       }


       .summary-correct-text { color: var(--success-color); font-weight: 600; }
       .summary-wrong-text { color: var(--error-color); text-decoration: line-through; opacity: 0.8;}
       .real-answer { color: var(--success-color); font-weight: 600; margin-left: 5px; }


       /* Helpers */
       strong {
           color: var(--brand-color);
           font-weight: 700;
       }


   </style>
</head>
<body>


<div class="container">
   <header>
       <h1 id="header-title">Fysikquiz Åk 9</h1>
   </header>
   <div class="progress-bar-container">
       <div class="progress-bar" id="progress-bar"></div>
   </div>


   <div class="content-area" id="app">
       <!-- Content will be injected here by JavaScript -->
   </div>
</div>


<script>
   // --- DATA ---
   const quizData = [
       {
           title: "Del 1: Vad är energi?",
           icon: "⚡",
           text: "Energi är det som får saker att hända och finns i allt som rör sig, lever, lyser eller är varmt. En av fysikens viktigaste regler är <strong>energiprincipen</strong>, som säger att energi aldrig kan förstöras eller skapas, utan bara <strong>omvandlas</strong> från en form till en annan. Vetenskapen delar in energi i olika energiformer beroende på hur den visar sig, till exempel <strong>rörelseenergi</strong>, <strong>värmeenergi</strong> och <strong>kemisk energi</strong>.",
           questions: [
               {
                   q: "Vad innebär energiprincipen?",
                   options: [
                       "Energi kan aldrig skapas eller förstöras, bara omvandlas.",
                       "Energi förbrukas och försvinner när vi använder den.",
                       "Energi skapas i kraftverk och förstörs i våra apparater hemma.",
                       "Energi är konstant men minskar lite varje gång den används."
                   ],
                   correct: 0,
                   explanation: "Enligt <strong>energiprincipen</strong> är den totala mängden energi alltid densamma, men den byter form."
               },
               {
                   q: "I vilken av dessa finns lagrad kemisk energi?",
                   options: [
                       "Ljusstrålar från en lampa.",
                       "En sten som ligger högt uppe på ett berg.",
                       "Mat, bensin och batterier.",
                       "Värmen från en brasa."
                   ],
                   correct: 2,
                   explanation: "<strong>Kemisk energi</strong> är energi som finns lagrad i ämnens kemiska sammansättning, som i mat eller bränsle."
               },
               {
                   q: "Vad kallas rörelseenergi och lägesenergi med ett gemensamt namn?",
                   options: [
                       "Mekanisk energi.",
                       "Elektrisk energi.",
                       "Strålningsenergi.",
                       "Termisk energi."
                   ],
                   correct: 0,
                   explanation: "<strong>Mekanisk energi</strong> är samlingsnamnet för både föremåls rörelse och deras position (läge)."
               }
           ]
       },
       {
           title: "Del 2: Energiövergångar",
           icon: "🔄",
           text: "När energi byter form kallas det för en <strong>energiövergång</strong>. I en bilmotor omvandlas bränslets <strong>kemiska energi</strong> till rörelse, men en stor del blir också till <strong>värme</strong>. I en gunga sker en ständig växling: när du är högst upp har du som mest <strong>lägesenergi</strong>, och när du är längst ner i mitten har du som mest <strong>rörelseenergi</strong>.",
           questions: [
               {
                   q: "Vad händer med huvuddelen av den kemiska energin i bränslet i en bilmotor?",
                   options: [
                       "Den blir till rörelseenergi så att bilen kan åka.",
                       "Den försvinner spårlöst.",
                       "Den skapas på nytt inuti motorn.",
                       "Den blir till värmeenergi."
                   ],
                   correct: 3,
                   explanation: "En stor del av energin i bränslet går förlorad som <strong>värme</strong> istället för att bli rörelse (detta handlar om motorns <strong>verkningsgrad</strong>)."
               },
               {
                   q: "När är rörelseenergin som störst för en person som gungar?",
                   options: [
                       "I vändläget högst upp.",
                       "Precis i mitten av rörelsen där farten är högst.",
                       "När man sitter helt stilla i gungan."
                   ],
                   correct: 1,
                   explanation: "Vid den lägsta punkten har all <strong>lägesenergi</strong> omvandlats till maximal <strong>rörelseenergi</strong>."
               }
           ]
       },
       {
           title: "Del 3: Elproduktion",
           icon: "🏭",
           text: "För att producera elektricitet i stor skala används en <strong>generator</strong>. Den fungerar genom <strong>induktion</strong>, vilket innebär att en magnet snurrar inuti eller nära en spole av koppartråd. När magnetfältet förändras inuti spolen skapas en elektrisk ström. Denna upptäckt har haft enorm betydelse för våra levnadsvillkor.",
           questions: [
               {
                   q: "Vilka två delar måste finnas i en enkel generator för att skapa ström?",
                   options: [
                       "En solcell och en motor.",
                       "En säkring och ett batteri.",
                       "En magnet och en spole.",
                       "En turbin och en fläkt."
                   ],
                   correct: 2,
                   explanation: "Genom att röra en <strong>magnet</strong> i förhållande till en <strong>spole</strong> skapas ström genom <strong>induktion</strong>."
               },
               {
                   q: "Hur har upptäckten av generatorn påverkat våra levnadsvillkor mest?",
                   options: [
                       "Vi kan ha elektriskt ljus och driva maskiner, vilket ändrat våra arbetsvanor.",
                       "Vi har slutat använda kemisk energi.",
                       "Det har blivit svårare att producera värme."
                   ],
                   correct: 0,
                   explanation: "<strong>Generatorn</strong> möjliggjorde el i stor skala, vilket lät oss arbeta i skift och ha ljus på natten."
               }
           ]
       },
       {
           title: "Del 4: Energikällor & Miljö",
           icon: "🌍",
           text: "Energikällor delas in i <strong>förnybara</strong> (som vind och vatten) och <strong>icke-förnybara</strong> (som kol och olja). Förbränning av fossila bränslen ökar halten av <strong>koldioxid</strong> i atmosfären, vilket förstärker <strong>växthuseffekten</strong> och leder till global uppvärmning. <strong>Kärnkraft</strong> är en icke-förnybar källa som inte släpper ut koldioxid, men den skapar radioaktivt avfall.",
           questions: [
               {
                   q: "Vilken av dessa energikällor är förnybar?",
                   options: [
                       "Naturgas.",
                       "Kolkraft.",
                       "Vindkraft.",
                       "Olja."
                   ],
                   correct: 2,
                   explanation: "<strong>Vindkraft</strong> är en flödande energikälla som inte tar slut."
               },
               {
                   q: "Vad är en känd nackdel med vattenkraft, trots att den är förnybar?",
                   options: [
                       "Den fungerar bara när solen skiner.",
                       "Den förändrar livsmiljön för djur och växter i och kring älven.",
                       "Den släpper ut mycket koldioxid.",
                       "Den är mycket dyrare än kärnkraft."
                   ],
                   correct: 1,
                   explanation: "Byggandet av <strong>dammar</strong> påverkar den biologiska mångfalden, till exempel fiskars vandring."
               },
               {
                   q: "Vilket är ett av de stora miljöproblemen med att använda kol och olja?",
                   options: [
                       "De tar aldrig slut, vilket skapar överskott.",
                       "De förstärker växthuseffekten genom koldioxidutsläpp.",
                       "De minskar jordens temperatur för mycket."
                   ],
                   correct: 1,
                   explanation: "Förbränning av fossila bränslen frigör lagrad <strong>koldioxid</strong> som bidrar till global uppvärmning."
               }
           ]
       },
       {
           title: "Del 5: Klimatet",
           icon: "🌡️",
           text: "<strong>Växthuseffekten</strong> är naturlig och nödvändig för livet på jorden, men människan har förstärkt den. Atmosfären fungerar som ett skyddande lager som släpper in solens strålning men hindrar en del av <strong>värmestrålningen</strong> från att lämna jorden. När vi ökar mängden <strong>växthusgaser</strong> hålls mer värme kvar.",
           questions: [
               {
                   q: "Vad gör växthusgaserna i atmosfären?",
                   options: [
                       "De tar upp värmestrålning och håller kvar värme vid jorden.",
                       "De filtrerar bort allt solljus så att det blir mörkt.",
                       "De gör att jorden kyls ner snabbare på natten.",
                       "De förstör ozonlagret."
                   ],
                   correct: 0,
                   explanation: "Gaserna fungerar som glaset i ett växthus och håller kvar <strong>värmeenergin</strong> i atmosfären."
               },
               {
                   q: "Vilken typ av strålning kan skada celler och öka risken för cancer om ozonlagret är tunt?",
                   options: [
                       "Synligt ljus.",
                       "Radiovågor.",
                       "Ultraviolett strålning (UV-strålning).",
                       "Infraröd strålning."
                   ],
                   correct: 2,
                   explanation: "Ett tunt ozonskikt släpper igenom mer <strong>UV-ljus</strong>, vilket är skadligt för levande organismer."
               }
           ]
       },
       {
           title: "Del 6: Elnätet",
           icon: "🔌",
           text: "Elektricitet produceras i kraftverk och transporteras till hemmen via ett elnät. I stamnätet används <strong>högspänning</strong> för att undvika att elenergin omvandlas till <strong>värme</strong> i ledningarna (energiförluster). Innan strömmen når ditt vägguttag måste spänningen sänkas i en <strong>transformator</strong>.",
           questions: [
               {
                   q: "Varför använder man hög spänning i de långa ledningarna från kraftverken?",
                   options: [
                       "För att minska energiförluster i form av värme.",
                       "För att elen ska färdas med ljusets hastighet.",
                       "För att det krävs för att driva små apparater.",
                       "För att göra ledningarna billigare."
                   ],
                   correct: 0,
                   explanation: "<strong>Hög spänning</strong> gör transporten effektivare genom att mindre energi 'läcker ut' som värme."
               },
               {
                   q: "Vad händer i en transformatorstation?",
                   options: [
                       "Elen lagras i stora batterier för vintern.",
                       "Elen görs om till kemisk energi.",
                       "Spänningen höjs eller sänks för att passa elnätet eller hemmen."
                   ],
                   correct: 2,
                   explanation: "<strong>Transformatorer</strong> ändrar spänningen så att den är säker och praktisk att använda."
               }
           ]
       },
       {
           title: "Del 7: Teknik i vardagen",
           icon: "📱",
           text: "Fysik används i många tekniska lösningar. <strong>Solceller</strong> tillverkas ofta av kisel och skapar ström direkt när de belyses av solen. Inom sjukvården används <strong>ultraljud</strong> (ljud med mycket hög frekvens) för att undersöka organ eller foster utan att skada dem.",
           questions: [
               {
                   q: "Vilken energiform omvandlas till elektrisk energi i en solcell?",
                   options: [
                       "Rörelseenergi.",
                       "Kärnenergi.",
                       "Strålningsenergi (ljus).",
                       "Värmeenergi."
                   ],
                   correct: 2,
                   explanation: "Solceller fångar upp energin i <strong>ljusstrålarna</strong> och skapar en elektrisk spänning."
               },
               {
                   q: "Vad är ultraljud?",
                   options: [
                       "Ljud som färdas snabbare än ljuset.",
                       "Ljud som är så starkt att det gör ont i öronen.",
                       "Ljud med en frekvens över 20 000 Hz som människor inte kan höra."
                   ],
                   correct: 2,
                   explanation: "<strong>Ultraljud</strong> har för hög frekvens för att det mänskliga örat ska kunna uppfatta det."
               }
           ]
       }
   ];


   // --- STATE MANAGEMENT ---
   let currentSectionIndex = 0;
   let currentQuestionIndex = 0; // Relative to current section
   let score = 0;
   let userAnswers = [];
   let state = 'intro'; // 'intro', 'question', 'summary'


   // --- DOM ELEMENTS ---
   const app = document.getElementById('app');
   const headerTitle = document.getElementById('header-title');
   const progressBar = document.getElementById('progress-bar');


   // --- MAIN RENDER FUNCTION ---
   function render() {
       if (state === 'summary') {
           renderSummary();
           return;
       }


       const section = quizData[currentSectionIndex];


       // Update Header with smooth fade
       headerTitle.style.opacity = '0';
       setTimeout(() => {
           headerTitle.innerText = section.title;
           headerTitle.style.transition = 'opacity 0.2s';
           headerTitle.style.opacity = '1';
       }, 150);


       // Calculate total progress
       let totalQuestions = 0;
       let answeredQuestions = 0;
      
       quizData.forEach((sec, idx) => {
           totalQuestions += sec.questions.length;
           if (idx < currentSectionIndex) {
               answeredQuestions += sec.questions.length;
           } else if (idx === currentSectionIndex && state === 'question') {
               answeredQuestions += currentQuestionIndex;
           }
       });
       const pct = (answeredQuestions / totalQuestions) * 100;
       progressBar.style.width = `${pct}%`;


       if (state === 'intro') {
           renderSectionIntro(section);
       } else if (state === 'question') {
           renderQuestion(section.questions[currentQuestionIndex]);
       }
   }


   // --- RENDER SECTION TEXT ---
   function renderSectionIntro(section) {
       // Simple animation class reset
       app.classList.remove('fade-in');
       void app.offsetWidth; // trigger reflow
       app.classList.add('fade-in');


       app.innerHTML = `
           <div class="fact-box">
               <span class="fact-icon">${section.icon}</span>
               <div class="fact-content">
                   <h2>Fakta</h2>
                   <p style="line-height: 1.6; font-size: 1rem; margin-top:0;">${section.text}</p>
               </div>
           </div>
           <button class="btn" onclick="startQuestions()">Starta frågor för denna del</button>
       `;
   }


   // --- RENDER QUESTION ---
   function renderQuestion(q) {
       const totalInCurrent = quizData[currentSectionIndex].questions.length;
      
       // Render with reset styles for feedback box
       app.innerHTML = `
           <div class="question-meta">Del ${currentSectionIndex + 1} • Fråga ${currentQuestionIndex + 1}/${totalInCurrent}</div>
           <h2 style="color: #2c3e50; font-weight: 600; margin-bottom:15px;">${q.q}</h2>
           <div class="options-grid">
               ${q.options.map((opt, idx) => `
                   <button class="option-btn" onclick="handleAnswer(${idx})" id="opt-${idx}">${opt}</button>
               `).join('')}
           </div>
           <div id="feedback" class="feedback-box">
               <h3 id="feedback-title"></h3>
               <p id="feedback-text" style="margin: 5px 0 15px 0; font-size: 0.95rem; line-height: 1.6;"></p>
               <button class="btn" id="next-btn" onclick="nextStep()" style="margin-top:0; width: auto; min-width: 150px;">Nästa fråga ➔</button>
           </div>
       `;
   }


   // --- RENDER SUMMARY ---
   function renderSummary() {
       headerTitle.innerText = "Sammanfattning";
       progressBar.style.width = '100%';
      
       let totalQ = 0;
       quizData.forEach(s => totalQ += s.questions.length);
      
       // Calculate score
       let correctCount = userAnswers.filter(a => a.isCorrect).length;
       let pct = Math.round((correctCount / totalQ) * 100);
      
       let gradeTitle = "";
      
       if(pct > 90) { gradeTitle = "Fantastiskt bra! 🏆"; }
       else if(pct > 70) { gradeTitle = "Mycket bra jobbat! 🌟"; }
       else if(pct > 50) { gradeTitle = "Godkänt! 👍"; }
       else { gradeTitle = "Fortsätt kämpa! 💪"; }


       let html = `
           <div class="summary-stats">
               <h2 style="color:var(--brand-color); margin:0 0 10px 0;">${gradeTitle}</h2>
               <span class="summary-score">${correctCount}/${totalQ}</span>
               <span style="color:#666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Rätt svar</span>
               <button class="btn" onclick="location.reload()" style="background: transparent; border: 2px solid var(--accent-color); color: var(--accent-color); margin-top: 20px; box-shadow:none; width: auto; padding: 10px 30px;">Gör om testet</button>
           </div>
           <h3 style="margin: 0 0 10px 0; font-size: 1.1rem; color: var(--text-muted);">Dina svar:</h3>
           <div class="summary-list">
       `;


       userAnswers.forEach((ans, idx) => {
           const isCorrect = ans.isCorrect;
          
           html += `
               <div class="summary-item">
                   <span class="summary-question">${idx + 1}. ${ans.question}</span>
                   <div class="summary-answer-row">
                       ${isCorrect
                           ? `<span class="summary-correct-text">✔ ${ans.userAnswer}</span>`
                           : `<span class="summary-wrong-text">✖ ${ans.userAnswer}</span> <span style="margin: 0 5px; color:#999;">➔</span> <span class="real-answer">${ans.correctAnswer}</span>`
                       }
                   </div>
               </div>
           `;
       });


       html += `</div>`;
       app.innerHTML = html;
   }


   // --- LOGIC FUNCTIONS ---
   window.startQuestions = function() {
       state = 'question';
       currentQuestionIndex = 0;
       render();
   };


   window.handleAnswer = function(selectedIndex) {
       // Disable all buttons
       const buttons = document.querySelectorAll('.option-btn');
       buttons.forEach(b => b.disabled = true);


       const section = quizData[currentSectionIndex];
       const currentQ = section.questions[currentQuestionIndex];
       const isCorrect = selectedIndex === currentQ.correct;


       // Visual feedback on buttons
       const selectedBtn = document.getElementById(`opt-${selectedIndex}`);
       const correctBtn = document.getElementById(`opt-${currentQ.correct}`);


       if (isCorrect) {
           selectedBtn.classList.add('correct');
       } else {
           selectedBtn.classList.add('incorrect');
           correctBtn.classList.add('correct'); // Show which one was right
       }


       // Show feedback box
       const feedbackBox = document.getElementById('feedback');
       const feedbackTitle = document.getElementById('feedback-title');
       const feedbackText = document.getElementById('feedback-text');
       const nextBtn = document.getElementById('next-btn');


       feedbackBox.style.display = 'block';
      
       // Add class for success/error styling
       if (isCorrect) {
           feedbackBox.className = "feedback-box success";
           feedbackTitle.innerHTML = "Rätt svar!"; // Removed 🎉
       } else {
           feedbackBox.className = "feedback-box error";
           feedbackTitle.innerHTML = "Inte riktigt..."; // Removed 😕
       }
      
       feedbackText.innerHTML = currentQ.explanation; // Use innerHTML to render <strong> tags


       // Check if last question of entire quiz
       const isLastQuestionOverall = (currentSectionIndex === quizData.length - 1) && (currentQuestionIndex === section.questions.length - 1);
      
       if(isLastQuestionOverall) {
           nextBtn.innerText = "Se resultat 🏁";
       } else if (currentQuestionIndex === section.questions.length - 1) {
           nextBtn.innerText = "Nästa del ➔";
       }


       // Scroll to feedback if needed on mobile, but gently
       const rect = feedbackBox.getBoundingClientRect();
       const isVisible = (rect.top >= 0) && (rect.bottom <= window.innerHeight);
       if (!isVisible) {
            setTimeout(() => {
               feedbackBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
           }, 100);
       }


       // Save data
       userAnswers.push({
           question: currentQ.q,
           userAnswer: currentQ.options[selectedIndex],
           correctAnswer: currentQ.options[currentQ.correct],
           isCorrect: isCorrect
       });
   };


   window.nextStep = function() {
       const section = quizData[currentSectionIndex];
      
       // Reset feedback styles for next render
       const feedbackBox = document.getElementById('feedback');
       if(feedbackBox) {
           feedbackBox.style.display = 'none';
       }


       // Check if there are more questions in this section
       if (currentQuestionIndex < section.questions.length - 1) {
           currentQuestionIndex++;
           render();
       } else {
           // End of section, move to next section
           if (currentSectionIndex < quizData.length - 1) {
               currentSectionIndex++;
               state = 'intro';
               render();
           } else {
               // End of quiz
               state = 'summary';
               render();
           }
       }
   };


   // --- INIT ---
   render();


</script>


</body>
</html>