<!DOCTYPE html>
<html lang="sv">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Biologiquiz: Systematiska Undersökningar (Åk 9)</title>
   <!-- Importerar moderna fonter från Google Fonts -->
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  
   <style>
       :root {
           /* Färgpalett - Grönt Tema (Natur/Vetenskap) */
           --card-bg: #ffffff;
          
           --brand-color: #2e7d32; /* Mörkgrön */
           --brand-gradient: linear-gradient(135deg, #2e7d32 0%, #66bb6a 100%);
          
           --accent-color: #66bb6a; /* Ljusare grön */
          
           /* Komplementfärg: Terra Cotta / Bränd Orange */
           --complement-color: #d84315;


           --success-color: #2e7d32;
           --success-bg: #e8f5e9;
          
           --error-color: #c62828;
           --error-bg: #ffebee;
          
           --text-main: #212121; /* Mörkare grå/svart för text */
           --text-muted: #616161;
          
           --shadow-card: 0 10px 25px rgba(0,0,0,0.1);
           --shadow-hover: 0 6px 16px rgba(0,0,0,0.12);
           --radius-main: 16px;
       }


       body {
           font-family: 'Open Sans', sans-serif;
           /* Gråaktig fade (Silver/Metallic style) */
           background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
           color: var(--text-main);
           margin: 0;
           padding: 15px;
           display: flex;
           justify-content: center;
           align-items: flex-start;
           min-height: 100vh;
       }


       .container {
           background-color: var(--card-bg);
           width: 100%;
           max-width: 680px;
           border-radius: var(--radius-main);
           box-shadow: var(--shadow-card);
           overflow: hidden;
           display: flex;
           flex-direction: column;
           position: relative;
           margin-top: 3vh;
           margin-bottom: 3vh;
       }


       header {
           background: var(--brand-gradient);
           color: white;
           padding: 20px;
           text-align: center;
           position: relative;
           overflow: hidden;
       }


       h1 {
           font-family: 'Poppins', sans-serif;
           margin: 0;
           font-size: 1.5rem;
           font-weight: 700;
           letter-spacing: -0.3px;
       }


       .content-area {
           padding: 25px 30px;
           flex-grow: 1;
       }


       h2 {
           font-family: 'Poppins', sans-serif;
           color: var(--text-main);
           margin-top: 0;
           font-size: 1.3rem;
           margin-bottom: 0.8rem;
           line-height: 1.3;
       }


       /* Fact Section Styles */
       .fact-box {
           background: #ffffff;
           border: 1px solid #eeeeee; /* Neutral border */
           border-radius: 12px;
           padding: 20px;
           margin-bottom: 20px;
           display: flex;
           gap: 15px;
           align-items: flex-start;
           box-shadow: 0 2px 8px rgba(0,0,0,0.03);
       }
      
       .fact-icon {
           font-size: 2rem;
           display: block;
           margin-top: -5px;
           color: var(--complement-color); /* Komplementfärg på ikonen */
       }
      
       .fact-content {
           flex: 1;
       }


       .btn {
           background: var(--brand-gradient);
           color: white;
           border: none;
           padding: 12px 24px;
           font-family: 'Poppins', sans-serif;
           font-size: 1rem;
           font-weight: 600;
           border-radius: 8px;
           cursor: pointer;
           transition: all 0.2s ease;
           display: block;
           width: 100%;
           margin-top: 20px;
           box-shadow: 0 4px 10px rgba(46, 125, 50, 0.2);
       }


       .btn:hover {
           transform: translateY(-2px);
           box-shadow: 0 6px 14px rgba(46, 125, 50, 0.3);
           opacity: 0.95;
       }


       /* Question Styles */
       .question-meta {
           display: inline-block;
           color: var(--complement-color); /* Komplementfärg */
           font-size: 0.85rem;
           margin-bottom: 10px;
           font-weight: 700;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }


       .options-grid {
           display: grid;
           gap: 12px;
           margin-top: 20px;
       }


       .option-btn {
           background-color: #fff;
           border: 2px solid #f5f5f5;
           padding: 15px 20px;
           text-align: left;
           border-radius: 10px;
           cursor: pointer;
           font-family: 'Open Sans', sans-serif;
           font-size: 0.95rem;
           font-weight: 500;
           transition: all 0.15s ease;
           color: var(--text-main);
           position: relative;
       }


       .option-btn:hover:not(:disabled) {
           border-color: var(--accent-color);
           background-color: #e8f5e9;
           transform: translateX(3px);
           box-shadow: 0 2px 5px rgba(0,0,0,0.05);
       }
      
       /* Status states for options */
       .option-btn.correct {
           background-color: var(--success-bg);
           border-color: var(--success-color);
           color: #1b5e20;
           font-weight: 600;
       }
      
       .option-btn.correct::after {
           content: "✓";
           position: absolute;
           right: 15px;
           font-weight: bold;
       }


       .option-btn.incorrect {
           background-color: var(--error-bg);
           border-color: var(--error-color);
           color: #b71c1c;
           opacity: 0.8;
       }


       .option-btn:disabled {
           cursor: default;
       }


       /* Feedback Box */
       .feedback-box {
           margin-top: 20px;
           padding: 20px 25px;
           border-radius: 12px;
           background-color: #f9f9f9;
           color: var(--text-main);
           border: 1px solid #e0e0e0;
           display: none;
           animation: fadeIn 0.3s ease;
       }
      
       .feedback-box h3 {
           margin-top: 0;
           font-family: 'Poppins', sans-serif;
           font-size: 1.2rem;
           display: flex;
           align-items: center;
           gap: 8px;
           margin-bottom: 8px;
       }


       .feedback-box.success h3 {
           color: var(--success-color);
       }
      
       .feedback-box.error h3 {
           color: var(--error-color);
       }


       .feedback-box strong {
           color: #000; /* Svarta fetstilade ord */
       }


       @keyframes fadeIn {
           from { opacity: 0; transform: translateY(5px); }
           to { opacity: 1; transform: translateY(0); }
       }


       /* Progress Bar Styles */
       .progress-bar-container {
           height: 6px;
           background-color: #eeeeee;
           width: 100%;
           position: relative;
           z-index: 10;
       }


       .progress-bar {
           height: 100%;
           /* Cyan Gradient */
           background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
           width: 0%;
           transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
           border-radius: 0 4px 4px 0;
           box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
       }


       /* Summary Styles */
       .summary-stats {
           text-align: center;
           background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
           border: 1px solid #a5d6a7;
           padding: 30px 20px;
           border-radius: 12px;
           margin-bottom: 20px;
       }


       .summary-score {
           font-size: 3.5rem;
           font-family: 'Poppins', sans-serif;
           font-weight: 700;
           display: block;
           margin: 5px 0;
           line-height: 1;
           background: linear-gradient(135deg, #1b5e20 0%, #43a047 100%);
           -webkit-background-clip: text;
           -webkit-text-fill-color: transparent;
       }
      
       .summary-list {
           max-height: 400px;
           overflow-y: auto;
           padding-right: 10px;
       }
      
       .summary-item {
           background: white;
           border-bottom: 1px solid #eeeeee;
           padding: 12px 0;
       }
      
       .summary-item:last-child {
           border-bottom: none;
       }


       .summary-question {
           font-weight: 600;
           margin-bottom: 4px;
           display: block;
           font-size: 0.95rem;
       }
      
       .summary-answer-row {
           font-size: 0.9rem;
       }


       .summary-correct-text { color: var(--success-color); font-weight: 600; }
       .summary-wrong-text { color: var(--error-color); text-decoration: line-through; opacity: 0.8;}
       .real-answer { color: var(--success-color); font-weight: 600; margin-left: 5px; }


       /* Helpers */
       strong {
           color: #000; /* Svarta fetstilade ord */
           font-weight: 700;
       }


   </style>
</head>
<body>


<div class="container">
   <header>
       <h1 id="header-title">Biologiquiz: Systematiska Undersökningar</h1>
   </header>
   <div class="progress-bar-container">
       <div class="progress-bar" id="progress-bar"></div>
   </div>


   <div class="content-area" id="app">
       <!-- Content will be injected here by JavaScript -->
   </div>
</div>


<script>
   // --- DATA ---
   const quizData = [
       {
           title: "Del 1: Frågeställningar och hypoteser",
           icon: "❓",
           text: "En bra naturvetenskaplig fråga ska vara <strong>undersökningsbar</strong>, vilket innebär att den kan besvaras genom att mäta eller observera förändringar. Frågor som börjar med 'varför' är ofta svårare att undersöka direkt och kräver mer teori än praktiska experiment. En <strong>hypotes</strong> är ett antagande om resultatet som motiveras med biologiska kunskaper.",
           questions: [
               {
                   q: "Vilken av dessa frågor lämpar sig bäst för en systematisk undersökning?",
                   options: [
                       "Hur påverkas mängden koldioxid i utandningsluften av fysisk träning?",
                       "Varför föredrar vissa människor att träna på morgonen istället för kvällen?",
                       "Är det mer miljövänligt att cykla till skolan än att åka buss i staden?",
                       "Vilket trädslag tycker svenska fåglar mest om att bygga sina bon i?"
                   ],
                   correct: 0,
                   explanation: "Frågan är <strong>mätbar</strong> och kan besvaras genom ett konkret experiment (mäta koldioxidhalt)."
               },
               {
                   q: "Varför bör man undvika 'varför-frågor' i en planering av en undersökning?",
                   options: [
                       "Det är helt omöjligt att svara på varför saker händer i naturen.",
                       "De kräver ofta mer teoretisk förklaring snarare än mätbara resultat.",
                       "Lärare ger alltid lägre poäng om man använder ordet varför i rubriken.",
                       "Det finns ingen utrustning i skolan som kan mäta en varför-fråga."
                   ],
                   correct: 1,
                   explanation: "Undersökningar fokuserar på vad som händer och hur det förändras genom <strong>mätningar</strong>."
               },
               {
                   q: "Vad krävs för att en hypotes ska anses vara naturvetenskapligt underbyggd?",
                   options: [
                       "Att den gissar på det mest ovanliga resultatet för att vara spännande.",
                       "Att den är skriven med minst tre meningar och innehåller en bild.",
                       "Att antagandet motiveras med hjälp av tidigare biologiska kunskaper.",
                       "Att man har frågat en expert på området innan man skriver ner den."
                   ],
                   correct: 2,
                   explanation: "En hypotes ska bygga på <strong>modeller och teorier</strong> inom ämnet."
               }
           ]
       },
       {
           title: "Del 2: Variabler och variabelkontroll",
           icon: "⚖️",
           text: "I en systematisk undersökning är det avgörande att bara förändra <strong>en variabel</strong> i taget, medan alla andra faktorer hålls konstanta. Vanliga variabler att mäta eller förändra är mängd, temperatur, tid eller tryck. Detta görs för att man ska veta exakt vad det är som orsakar resultatet.",
           questions: [
               {
                   q: "Du ska undersöka hur ljus påverkar lövsprickning. Vad bör du göra med vatten och temperatur?",
                   options: [
                       "Ändra både mängden vatten och temperatur för att få ett snabbare svar.",
                       "Låta temperaturen variera men se till att alla träd får exakt lika mycket vatten.",
                       "Vattna olika mycket beroende på hur mycket ljus varje träd faktiskt får.",
                       "Se till att både vattenmängd och temperatur är exakt lika för alla träd."
                   ],
                   correct: 3,
                   explanation: "Alla faktorer utom den som undersöks (ljuset) måste hållas <strong>konstanta</strong> för ett pålitligt resultat."
               },
               {
                   q: "Vad kallas den faktor som man väljer att förändra i ett experiment?",
                   options: [
                       "Variabel",
                       "Konstant",
                       "Felkälla",
                       "Hypotes"
                   ],
                   correct: 0,
                   explanation: "<strong>Variabeln</strong> är den del av undersökningen som man medvetet varierar för att se effekt."
               },
               {
                   q: "Varför är det viktigt att använda en kontrollgrupp, t.ex. sockerpiller i ett medicintest?",
                   options: [
                       "För att deltagarna ska få energi så att de orkar genomföra hela testet.",
                       "För att se om resultatet beror på medicinen eller på förväntningar.",
                       "För att sockerpiller är billigare att tillverka än den riktiga medicinen.",
                       "För att man alltid ska dela ut något till alla som deltar i en studie."
                   ],
                   correct: 1,
                   explanation: "Kontrollgruppen visar om förändringen beror på variabeln eller på <strong>slumpen/placeboeffekten</strong>."
               }
           ]
       },
       {
           title: "Del 3: Utförande och dokumentation",
           icon: "📝",
           text: "Instruktionen i en planering ska vara så utförlig att någon annan kan följa den steg för steg. Resultat dokumenteras ofta i <strong>tabeller</strong> och <strong>diagram</strong> för att göra mätvärdena tydliga. Att använda rätt utrustning, som mätglas istället för vanliga muggar, ökar <strong>precisionen</strong> i undersökningen.",
           questions: [
               {
                   q: "Vilket av följande är mest viktigt för att en instruktion ska vara av hög kvalitet?",
                   options: [
                       "Att den innehåller färgglada bilder på allt material som används.",
                       "Att den är skriven på ett sätt så att bara experter kan förstå den.",
                       "Att den beskriver steg för steg så att någon annan kan upprepa den.",
                       "Att den är mycket kortfattad för att spara tid under själva provet."
                   ],
                   correct: 2,
                   explanation: "En bra planering ska kunna följas av andra för att <strong>pröva resultatet</strong> (reproducerbarhet)."
               },
               {
                   q: "Vilket är det bästa sättet att dokumentera mätvärden under ett pågående experiment?",
                   options: [
                       "Skriva ner tankar och känslor i en dagbok efter att testet är helt klart.",
                       "Göra en kort sammanfattning av vad man tror att man har sett hända.",
                       "Rita en bild av hur utrustningen såg ut när experimentet startade.",
                       "Anteckna exakta värden i en tabell med jämna och bestämda tidsintervall."
                   ],
                   correct: 3,
                   explanation: "Systematisk dokumentation med <strong>tabeller</strong> ger en tydlig bild av förändringar."
               },
               {
                   q: "Varför bör man använda ett graderat mätglas istället för en vanlig bägare när man mäter vätska?",
                   options: [
                       "Det gör att mätningen blir mer exakt och därmed mer tillförlitlig.",
                       "Mätglas är gjorda av ett material som inte påverkar vätskans temperatur.",
                       "Det är lättare att hälla ur ett mätglas utan att spilla på bordet.",
                       "Skolans regler säger att man bara får använda mätglas i kemisalen."
                   ],
                   correct: 0,
                   explanation: "<strong>Precision</strong> i mätutrustning minskar risken för mätfel."
               }
           ]
       },
       {
           title: "Del 4: Värdering av resultat",
           icon: "🔍",
           text: "Värdering av resultat handlar om att bedöma hur rimliga de är i relation till <strong>felkällor</strong>. En felkälla kan vara att mätningen gjordes slarvigt eller att en variabel man inte tänkt på påverkade resultatet. För att öka tillförlitligheten bör undersökningen <strong>upprepas</strong> flera gånger.",
           questions: [
               {
                   q: "Vad innebär det att upprepa en undersökning (göra fler försök)?",
                   options: [
                       "Att man byter variabel för att se om man får ett helt annat resultat.",
                       "Att man säkerställer att resultatet inte bara var en engångsföreteelse.",
                       "Att man tränar på att använda utrustningen så att man blir snabbare.",
                       "Att man får mer mätdata så att man kan skriva en längre rapport."
                   ],
                   correct: 1,
                   explanation: "Repetition visar om resultatet är stabilt och minskar <strong>slumpens inverkan</strong>."
               },
               {
                   q: "Vilken av följande är en vanlig metodfelkälla i en biologisk undersökning?",
                   options: [
                       "Att hypotesen man skrev i början visade sig vara helt felaktig.",
                       "Att man använde en tabell istället för ett diagram för resultatet.",
                       "Att man inte lyckades hålla alla faktorer utom en helt konstanta.",
                       "Att man valde att arbeta ensam istället för att samarbeta i par."
                   ],
                   correct: 2,
                   explanation: "Bristande <strong>variabelkontroll</strong> är en av de vanligaste orsakerna till osäkra resultat."
               },
               {
                   q: "Hur kan man förbättra en undersökning om hur salthalt påverkar potatisceller?",
                   options: [
                       "Genom att använda olika sorters potatisar i varje salthalt.",
                       "Genom att låta potatisarna ligga i olika lång tid i bägarna.",
                       "Genom att gissa vikten istället för att använda en digital våg.",
                       "Genom att torka av överflödigt vatten före varje vägning."
                   ],
                   correct: 3,
                   explanation: "Att ta bort faktorer (som vatten på ytan) som påverkar massan men inte har med cellernas förändring att göra ökar <strong>noggrannheten</strong>."
               }
           ]
       },
       {
           title: "Del 5: Resonemang och slutsatser",
           icon: "🧠",
           text: "Att dra en <strong>slutsats</strong> innebär att koppla mätvärdena till biologiska förklaringsmodeller, till exempel cellandning eller fotosyntes. Ett <strong>utvecklat resonemang</strong> visar samband i flera led, till exempel hur en förändring i en faktor leder till en specifik effekt.",
           questions: [
               {
                   q: "Vad är en korrekt slutsats om pulsen ökar efter löpning?",
                   options: [
                       "Musklerna behöver mer syre till förbränningen, så hjärtat pumpar snabbare.",
                       "Pulsen ökar för att man rör på benen och då blir blodet varmare.",
                       "Man blir trött i lungorna och därför måste hjärtat vila efteråt.",
                       "Blodet rinner fortare i ådrorna för att man har druckit för lite vatten."
                   ],
                   correct: 0,
                   explanation: "Slutsatsen kopplar resultatet (ökad puls) till biologisk teori (<strong>cellandning</strong>)."
               },
               {
                   q: "Vilket av dessa exempel visar ett resonemang i flera led?",
                   options: [
                       "Det är bra för miljön att återvinna plast eftersom det är hållbart.",
                       "Fler vargar äter hjortar, vilket ger mer växter som småfåglar kan bo i.",
                       "Om man tränar mycket så får man bättre kondition och blir stark.",
                       "Bakterier dör om man tvättar händerna med varmt vatten och tvål."
                   ],
                   correct: 1,
                   explanation: "Detta visar en kedja av händelser där ett led påverkar nästa i ett <strong>biologiskt sammanhang</strong>."
               },
               {
                   q: "Vad bör man göra om resultatet i en undersökning inte stämmer med ens hypotes?",
                   options: [
                       "Ändra i hypotesen i efterhand så att den matchar det man fick fram.",
                       "Slänga resultatet och göra om undersökningen tills man får rätt svar.",
                       "Diskutera varför det blev så och leta efter möjliga felkällor i metoden.",
                       "Be läraren att skriva in de korrekta mätvärdena i tabellen istället."
                   ],
                   correct: 2,
                   explanation: "Inom vetenskap är <strong>oväntade resultat</strong> viktiga för att lära sig mer och hitta fel i metoder."
               }
           ]
       }
   ];


   // --- STATE MANAGEMENT ---
   let currentSectionIndex = 0;
   let currentQuestionIndex = 0; // Relative to current section
   let score = 0;
   let userAnswers = [];
   let state = 'intro'; // 'intro', 'question', 'summary'


   // --- DOM ELEMENTS ---
   const app = document.getElementById('app');
   const headerTitle = document.getElementById('header-title');
   const progressBar = document.getElementById('progress-bar');


   // --- MAIN RENDER FUNCTION ---
   function render() {
       if (state === 'summary') {
           renderSummary();
           return;
       }


       const section = quizData[currentSectionIndex];


       // Update Header with smooth fade
       headerTitle.style.opacity = '0';
       setTimeout(() => {
           headerTitle.innerText = section.title;
           headerTitle.style.transition = 'opacity 0.2s';
           headerTitle.style.opacity = '1';
       }, 150);


       // Calculate total progress
       let totalQuestions = 0;
       let answeredQuestions = 0;
      
       quizData.forEach((sec, idx) => {
           totalQuestions += sec.questions.length;
           if (idx < currentSectionIndex) {
               answeredQuestions += sec.questions.length;
           } else if (idx === currentSectionIndex && state === 'question') {
               answeredQuestions += currentQuestionIndex;
           }
       });
       const pct = (answeredQuestions / totalQuestions) * 100;
       progressBar.style.width = `${pct}%`;


       if (state === 'intro') {
           renderSectionIntro(section);
       } else if (state === 'question') {
           renderQuestion(section.questions[currentQuestionIndex]);
       }
   }


   // --- RENDER SECTION TEXT ---
   function renderSectionIntro(section) {
       // Simple animation class reset
       app.classList.remove('fade-in');
       void app.offsetWidth; // trigger reflow
       app.classList.add('fade-in');


       app.innerHTML = `
           <div class="fact-box">
               <span class="fact-icon">${section.icon}</span>
               <div class="fact-content">
                   <h2>Fakta</h2>
                   <p style="line-height: 1.6; font-size: 1rem; margin-top:0;">${section.text}</p>
               </div>
           </div>
           <button class="btn" onclick="startQuestions()">Starta frågor för denna del</button>
       `;
   }


   // --- RENDER QUESTION ---
   function renderQuestion(q) {
       const totalInCurrent = quizData[currentSectionIndex].questions.length;
      
       // Render with reset styles for feedback box
       app.innerHTML = `
           <div class="question-meta">Del ${currentSectionIndex + 1} • Fråga ${currentQuestionIndex + 1}/${totalInCurrent}</div>
           <h2 style="color: var(--text-main); font-weight: 600; margin-bottom:15px;">${q.q}</h2>
           <div class="options-grid">
               ${q.options.map((opt, idx) => `
                   <button class="option-btn" onclick="handleAnswer(${idx})" id="opt-${idx}">${opt}</button>
               `).join('')}
           </div>
           <div id="feedback" class="feedback-box">
               <h3 id="feedback-title"></h3>
               <p id="feedback-text" style="margin: 5px 0 15px 0; font-size: 0.95rem; line-height: 1.6;"></p>
               <button class="btn" id="next-btn" onclick="nextStep()" style="margin-top:0; width: auto; min-width: 150px;">Nästa fråga ➔</button>
           </div>
       `;
   }


   // --- RENDER SUMMARY ---
   function renderSummary() {
       headerTitle.innerText = "Sammanfattning";
       progressBar.style.width = '100%';
      
       let totalQ = 0;
       quizData.forEach(s => totalQ += s.questions.length);
      
       // Calculate score
       let correctCount = userAnswers.filter(a => a.isCorrect).length;
       let pct = Math.round((correctCount / totalQ) * 100);
      
       let gradeTitle = "";
      
       if(pct > 90) { gradeTitle = "Fantastiskt bra! 🏆"; }
       else if(pct > 70) { gradeTitle = "Mycket bra jobbat! 🌟"; }
       else if(pct > 50) { gradeTitle = "Godkänt! 👍"; }
       else { gradeTitle = "Fortsätt kämpa! 💪"; }


       let html = `
           <div class="summary-stats">
               <h2 style="color:var(--brand-color); margin:0 0 10px 0;">${gradeTitle}</h2>
               <span class="summary-score">${correctCount}/${totalQ}</span>
               <span style="color:#666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Rätt svar</span>
               <button class="btn" onclick="location.reload()" style="background: transparent; border: 2px solid var(--accent-color); color: var(--accent-color); margin-top: 20px; box-shadow:none; width: auto; padding: 10px 30px;">Gör om testet</button>
           </div>
           <h3 style="margin: 0 0 10px 0; font-size: 1.1rem; color: var(--text-muted);">Dina svar:</h3>
           <div class="summary-list">
       `;


       userAnswers.forEach((ans, idx) => {
           const isCorrect = ans.isCorrect;
          
           html += `
               <div class="summary-item">
                   <span class="summary-question">${idx + 1}. ${ans.question}</span>
                   <div class="summary-answer-row">
                       ${isCorrect
                           ? `<span class="summary-correct-text">✔ ${ans.userAnswer}</span>`
                           : `<span class="summary-wrong-text">✖ ${ans.userAnswer}</span> <span style="margin: 0 5px; color:#999;">➔</span> <span class="real-answer">${ans.correctAnswer}</span>`
                       }
                   </div>
               </div>
           `;
       });


       html += `</div>`;
       app.innerHTML = html;
   }


   // --- LOGIC FUNCTIONS ---
   window.startQuestions = function() {
       state = 'question';
       currentQuestionIndex = 0;
       render();
   };


   window.handleAnswer = function(selectedIndex) {
       // Disable all buttons
       const buttons = document.querySelectorAll('.option-btn');
       buttons.forEach(b => b.disabled = true);


       const section = quizData[currentSectionIndex];
       const currentQ = section.questions[currentQuestionIndex];
       const isCorrect = selectedIndex === currentQ.correct;


       // Visual feedback on buttons
       const selectedBtn = document.getElementById(`opt-${selectedIndex}`);
       const correctBtn = document.getElementById(`opt-${currentQ.correct}`);


       if (isCorrect) {
           selectedBtn.classList.add('correct');
       } else {
           selectedBtn.classList.add('incorrect');
           correctBtn.classList.add('correct'); // Show which one was right
       }


       // Show feedback box
       const feedbackBox = document.getElementById('feedback');
       const feedbackTitle = document.getElementById('feedback-title');
       const feedbackText = document.getElementById('feedback-text');
       const nextBtn = document.getElementById('next-btn');


       feedbackBox.style.display = 'block';
      
       // Add class for success/error styling
       if (isCorrect) {
           feedbackBox.className = "feedback-box success";
           feedbackTitle.innerHTML = "Rätt svar!";
       } else {
           feedbackBox.className = "feedback-box error";
           feedbackTitle.innerHTML = "Inte riktigt...";
       }
      
       feedbackText.innerHTML = currentQ.explanation; // Use innerHTML to render <strong> tags


       // Check if last question of entire quiz
       const isLastQuestionOverall = (currentSectionIndex === quizData.length - 1) && (currentQuestionIndex === section.questions.length - 1);
      
       if(isLastQuestionOverall) {
           nextBtn.innerText = "Se resultat 🏁";
       } else if (currentQuestionIndex === section.questions.length - 1) {
           nextBtn.innerText = "Nästa del ➔";
       }


       // Scroll to feedback if needed on mobile, but gently
       const rect = feedbackBox.getBoundingClientRect();
       const isVisible = (rect.top >= 0) && (rect.bottom <= window.innerHeight);
       if (!isVisible) {
            setTimeout(() => {
               feedbackBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
           }, 100);
       }


       // Save data
       userAnswers.push({
           question: currentQ.q,
           userAnswer: currentQ.options[selectedIndex],
           correctAnswer: currentQ.options[currentQ.correct],
           isCorrect: isCorrect
       });
   };


   window.nextStep = function() {
       const section = quizData[currentSectionIndex];
      
       // Reset feedback styles for next render
       const feedbackBox = document.getElementById('feedback');
       if(feedbackBox) {
           feedbackBox.style.display = 'none';
       }


       // Check if there are more questions in this section
       if (currentQuestionIndex < section.questions.length - 1) {
           currentQuestionIndex++;
           render();
       } else {
           // End of section, move to next section
           if (currentSectionIndex < quizData.length - 1) {
               currentSectionIndex++;
               state = 'intro';
               render();
           } else {
               // End of quiz
               state = 'summary';
               render();
           }
       }
   };


   // --- INIT ---
   render();


</script>


</body>
</html>