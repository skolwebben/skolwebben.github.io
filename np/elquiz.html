<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fysikquiz: El & Magnetism (√Ök 9)</title>
    <!-- Importerar moderna fonter fr√•n Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* F√§rgpalett - Professionell & Ren */
            --card-bg: #ffffff;
            
            --brand-color: #2c3e50;
            --brand-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            
            --accent-color: #3498db;
            
            --success-color: #10ac84;
            --success-bg: #e3f9f1;
            
            --error-color: #ee5253;
            --error-bg: #ffeded;
            
            --text-main: #2d3436;
            --text-muted: #636e72;
            
            --shadow-card: 0 10px 25px rgba(0,0,0,0.15);
            --shadow-hover: 0 6px 16px rgba(0,0,0,0.12);
            --radius-main: 16px;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            /* Gr√•aktig fade (Silver/Metallic style) */
            background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-main);
            margin: 0;
            padding: 15px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            background-color: var(--card-bg);
            width: 100%;
            max-width: 680px; 
            border-radius: var(--radius-main);
            box-shadow: var(--shadow-card);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            margin-top: 3vh;
            margin-bottom: 3vh;
        }

        header {
            background: var(--brand-gradient);
            color: white;
            padding: 20px; 
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        h1 {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            font-size: 1.5rem; 
            font-weight: 700;
            letter-spacing: -0.3px;
        }

        .content-area {
            padding: 25px 30px; 
            flex-grow: 1;
        }

        h2 {
            font-family: 'Poppins', sans-serif;
            color: var(--brand-color);
            margin-top: 0;
            font-size: 1.3rem;
            margin-bottom: 0.8rem;
            line-height: 1.3;
        }

        /* Fact Section Styles */
        .fact-box {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            /* Borttagen border-left enligt √∂nskem√•l */
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }
        
        .fact-icon {
            font-size: 2rem;
            display: block;
            margin-top: -5px;
        }
        
        .fact-content {
            flex: 1;
        }

        .btn {
            background: var(--brand-gradient);
            color: white;
            border: none;
            padding: 12px 24px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: block;
            width: 100%;
            margin-top: 20px;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 14px rgba(52, 152, 219, 0.3);
            opacity: 0.95;
        }

        /* Question Styles */
        .question-meta {
            display: inline-block;
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .options-grid {
            display: grid;
            gap: 12px;
            margin-top: 20px;
        }

        .option-btn {
            background-color: #fff;
            border: 2px solid #f1f2f6;
            padding: 15px 20px;
            text-align: left;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Open Sans', sans-serif;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.15s ease;
            color: var(--text-main);
            position: relative;
        }

        .option-btn:hover:not(:disabled) {
            border-color: var(--accent-color);
            background-color: #f8fcff;
            transform: translateX(3px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        /* Status states for options */
        .option-btn.correct {
            background-color: var(--success-bg);
            border-color: var(--success-color);
            color: #0b6e4f;
            font-weight: 600;
        }
        
        .option-btn.correct::after {
            content: "‚úì";
            position: absolute;
            right: 15px;
            font-weight: bold;
        }

        .option-btn.incorrect {
            background-color: var(--error-bg);
            border-color: var(--error-color);
            color: #c0392b;
            opacity: 0.8;
        }

        .option-btn:disabled {
            cursor: default;
        }

        /* Feedback Box */
        .feedback-box {
            margin-top: 20px;
            padding: 20px 25px;
            border-radius: 12px;
            background-color: #f8f9fa;
            color: var(--text-main);
            border: 1px solid #e9ecef;
            display: none; 
            animation: fadeIn 0.3s ease;
        }
        
        .feedback-box h3 {
            margin-top: 0;
            font-family: 'Poppins', sans-serif;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .feedback-box.success h3 {
            color: var(--success-color);
        }
        
        .feedback-box.error h3 {
            color: var(--error-color);
        }

        .feedback-box strong {
            color: var(--brand-color);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Progress Bar Styles */
        .progress-bar-container {
            height: 6px; 
            background-color: #f1f3f5;
            width: 100%;
            position: relative;
            z-index: 10;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            width: 0%;
            transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            border-radius: 0 4px 4px 0;
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
        }

        /* Summary Styles */
        .summary-stats {
            text-align: center;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
            padding: 30px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .summary-score {
            font-size: 3.5rem;
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            display: block;
            margin: 5px 0;
            line-height: 1;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .summary-list {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .summary-item {
            background: white;
            border-bottom: 1px solid #f1f1f1;
            padding: 12px 0;
        }
        
        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-question {
            font-weight: 600;
            margin-bottom: 4px;
            display: block;
            font-size: 0.95rem;
        }
        
        .summary-answer-row {
            font-size: 0.9rem;
        }

        .summary-correct-text { color: var(--success-color); font-weight: 600; }
        .summary-wrong-text { color: var(--error-color); text-decoration: line-through; opacity: 0.8;}
        .real-answer { color: var(--success-color); font-weight: 600; margin-left: 5px; }

        /* Helpers */
        strong {
            color: var(--brand-color);
            font-weight: 700;
        }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1 id="header-title">Fysikquiz: El & Magnetism</h1>
    </header>
    <div class="progress-bar-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>

    <div class="content-area" id="app">
        <!-- Content will be injected here by JavaScript -->
    </div>
</div>

<script>
    // --- DATA ---
const quizData = [
    {
        title: "Block 1: Statisk Elektricitet",
        icon: "‚ö°",
        text: "En atom best√•r av negativt laddade <strong>elektroner</strong> och positivt laddade <strong>protoner</strong>. Normalt √§r atomen oladdad, men <strong>statisk elektricitet</strong> uppst√•r n√§r man gnider bort negativa laddningar, vilket g√∂r att atomen blir positivt laddad. Naturen str√§var alltid efter att j√§mna ut skillnader, s√• atomen kommer f√∂rr eller senare att √•terf√• sin negativa laddning. Ett exempel p√• statisk elektricitet √§r <strong>√•ska</strong>, d√§r √•skmolnen blir positivt laddade upptill och negativt laddade nertill, n√§rmast jorden.",
        questions: [
            {
                q: "Vilken partikel i atomen √§r negativt laddad?",
                options: [
                    "Protoner",
                    "Neutroner",
                    "Elektroner",
                    "Nukleoner"
                ],
                correct: 2, 
                explanation: "<strong>Elektronerna</strong> √§r de negativt laddade partiklarna som finns i atomen. Neutroner √§r oladdade och protoner √§r positivt laddade."
            },
            {
                q: "Vad kallas det n√§r en oladdad atom tappar negativa laddningar och blir positivt laddad?",
                options: [
                    "Elektrisk potential",
                    "Statisk elektricitet",
                    "Induktion",
                    "K√§rnenergi"
                ],
                correct: 1,
                explanation: "N√§r negativa laddningar (elektroner) gnids bort och den elektriska skillnaden uppst√•r, kallas det <strong>statisk elektricitet</strong>. Denna skillnad f√∂rs√∂ker naturen sedan j√§mna ut."
            },
            {
                q: "Vilken naturlig process √§r ett exempel p√• statisk elektricitet?",
                options: [
                    "V√§rmeutvidgning",
                    "Str√•lningsenergi",
                    "V√§xelstr√∂m",
                    "√Öska"
                ],
                correct: 3,
                explanation: "<strong>√Öska</strong> √§r ett exempel p√• statisk elektricitet som uppst√•r n√§r laddningsskillnaden i √•skmoln j√§mnas ut som en blixt."
            }
        ]
    },
    {
        title: "Block 2: Sp√§nning och Str√∂m",
        icon: "üîå",
        text: "Elektricitet √§r un fl√∂de av elektroner. <strong>Sp√§nning</strong> (m√§ts i <strong>volt, V</strong>) √§r skillnaden i laddning (elektrisk potential) mellan plus- och minuspolen, och det √§r sp√§nningen som f√•r elektronerna att r√∂ra sig. <strong>Str√∂m</strong> (m√§ts i <strong>Ampere, A</strong>) √§r fl√∂det av elektroner i en ledning. Sp√§nningen g√∂r det m√∂jligt f√∂r str√∂mmen att existera, men det √§r str√∂mmen som driver elektriska produkter.",
        questions: [
            {
                q: "Vilken enhet anv√§nds f√∂r att m√§ta sp√§nning?",
                options: [
                    "Ampere (A)",
                    "Volt (V)",
                    "Ohm (Œ©)",
                    "Watt (W)"
                ],
                correct: 1,
                explanation: "Sp√§nning √§r ett m√•tt p√• elektrisk kraft och m√§ts i enheten <strong>volt (V)</strong>. Str√∂m m√§ts i Ampere."
            },
            {
                q: "Vad driver elektriska produkter enligt k√§llorna?",
                options: [
                    "Sp√§nningen (skillnaden mellan polerna)",
                    "Elektrisk potential",
                    "Str√∂mmen",
                    "Likstr√∂m"
                ],
                correct: 2,
                explanation: "Det √§r <strong>str√∂mmen</strong> som driver elektriska produkter, medan sp√§nningen skapar m√∂jligheten f√∂r str√∂mmen att existera."
            },
            {
                q: "Vad √§r skillnaden mellan likstr√∂m och v√§xelstr√∂m?",
                options: [
                    "Likstr√∂m √•ker alltid i samma riktning, medan v√§xelstr√∂m byter riktning",
                    "V√§xelstr√∂m √§r starkare √§n likstr√∂m.",
                    "Likstr√∂m finns i v√§gguttag, v√§xelstr√∂m i batterier.",
                    "V√§xelstr√∂m m√§ts i Watt och likstr√∂m i Ampere."
                ],
                correct: 0,
                explanation: "<strong>Likstr√∂m</strong> (som i batterier) f√§rdas alltid i en riktning, medan <strong>v√§xelstr√∂m</strong> (som i v√§gguttag) byter riktning 100 g√•nger per sekund."
            }
        ]
    },
    {
        title: "Block 3: Resistans & Ohms lag",
        icon: "üí°",
        text: "<strong>Elektrisk resistans</strong> (motst√•nd) p√•verkar str√∂mmen i en ledare. En bra ledare, som <strong>koppar</strong>, har l√•g resistans, vilket till√•ter fler elektroner att passera. L√•g resistans uppn√•s genom <strong>l√•g temperatur</strong>, <strong>stor diameter</strong> och <strong>kort l√§ngd</strong> p√• ledaren. Sambandet mellan sp√§nning (U), str√∂m (I) och resistans (R) beskrivs av <strong>Ohms lag</strong>: U = R * I. N√§r str√∂m st√∂ter p√• motst√•nd omvandlas elektrisk energi till v√§rmeenergi.",
        questions: [
            {
                q: "Vilket uttalande om en ledares egenskaper ger den l√§gsta m√∂jliga resistansen?",
                options: [
                    "H√∂g temperatur och stor diameter.",
                    "L√•g temperatur och stor diameter.",
                    "Kort l√§ngd och litet motst√•nd.",
                    "L√•ng l√§ngd och l√•g temperatur."
                ],
                correct: 1,
                explanation: "L√•g resistans uppn√•s n√§r temperaturen √§r <strong>l√•g</strong>, diametern p√• ledaren √§r <strong>stor</strong> och l√§ngden √§r <strong>kort</strong>."
            },
            {
                q: "Vilken metall anv√§nds vanligen i elledningar i Sverige eftersom den √§r en bra ledare?",
                options: [
                    "Silver",
                    "Guld",
                    "Koppar",
                    "Plast"
                ],
                correct: 2,
                explanation: "Silver, koppar och guld leder elektricitet b√§st, men <strong>koppar</strong> anv√§nds i vanliga elledningar. Plast √§r en isolator som inte leder str√∂m."
            },
            {
                q: "Vilket samband beskriver Ohms lag?",
                options: [
                    "Sp√§nning = Str√∂m * Motst√•nd (U = I*R)",
                    "Str√∂m = Motst√•nd / Sp√§nning (I = R/U)",
                    "Motst√•nd = Sp√§nning / Str√∂m (R = U/I)",
                    "Effekt = Sp√§nning * Str√∂m (P = U*I)"
                ],
                correct: 0,
                explanation: "<strong>Ohms lag</strong> fastst√§ller att sp√§nningen (U) √§r lika med str√∂mstyrkan (I) multiplicerat med resistansen (R)."
            }
        ]
    },
    {
        title: "Block 4: Kopplingar & Effekt",
        icon: "üîã",
        text: "<strong>Elektrisk effekt</strong> (P, m√§ts i <strong>watt, W</strong>) m√§ter hur snabbt en apparat omvandlar elektrisk energi. F√∂r att m√§ta den totala energif√∂rbrukningen multiplicerar man effekten med tiden, vilket m√§ts i <strong>watt-timmar (Wh)</strong> eller kilowatt-timmar (kWh). N√§r komponenter kopplas i <strong>seriekoppling</strong> adderas sp√§nningen om det √§r batterier, men om en komponent g√•r s√∂nder bryts kretsen. I en <strong>parallellkoppling</strong> har str√∂mmen flera v√§gar, vilket g√∂r att om en lampa g√•r s√∂nder forts√§tter de andra att lysa.",
        questions: [
            {
                q: "Vad h√§nder i en seriekoppling om en av lamporna g√•r s√∂nder?",
                options: [
                    "Sp√§nningen i kretsen √∂kar.",
                    "De andra lamporna forts√§tter att lysa.",
                    "Str√∂mmen i kretsen dubbleras.",
                    "Alla lampor slocknar."
                ],
                correct: 3,
                explanation: "Om en lampa i en <strong>seriekoppling</strong> g√•r s√∂nder blir det inte en sluten krets, och str√∂mmen kan d√• inte ta sig runt mellan minus- och pluspolen."
            },
            {
                q: "Hur f√∂rh√•ller sig sp√§nningen i en parallellkoppling med flera lampor till batteriets sp√§nning?",
                options: [
                    "Sp√§nningen halveras f√∂r varje lampa.",
                    "Sp√§nningen dubbleras.",
                    "Sp√§nningen √∂ver varje lampa √§r lika stor som batteriets sp√§nning.",
                    "Sp√§nningen √∂ver lamporna minskar med antalet lampor."
                ],
                correct: 2,
                explanation: "I en <strong>parallellkoppling</strong> lyser alla lampor lika starkt eftersom sp√§nningen √∂ver dem kommer att vara lika stor som batteriets sp√§nning."
            },
            {
                q: "Vilken enhet anv√§nds f√∂r att m√§ta elektrisk effekt?",
                options: [
                    "Watt (W)",
                    "Volt (V)",
                    "Ampere (A)",
                    "Joule (J)"
                ],
                correct: 0,
                explanation: "<strong>Elektrisk effekt</strong> (P) m√§ts i enheten <strong>watt (W)</strong>."
            }
        ]
    },
    {
        title: "Block 5: Magnetism",
        icon: "üß≤",
        text: "Magneter drar till sig magnetiska metaller som j√§rn (Fe), nickel (Ni) och kobolt (Co). Runt varje magnet finns ett osynligt <strong>magnetf√§lt</strong>. Lika magnetpoler st√∂ter bort varandra (<strong>repellera</strong>), medan olika poler dras mot varandra (<strong>attrahera</strong>). Runt en str√∂mf√∂rande ledare uppst√•r det alltid ett magnetf√§lt. Detta utnyttjas i <strong>elektromagneter</strong>, vars styrka kan √∂kas genom att linda metalltr√•den som en <strong>spole</strong> (ju fler varv desto starkare) och anv√§nda en j√§rnspik som k√§rna.",
        questions: [
            {
                q: "Vad h√§nder med en kompass i n√§rheten av en magnet?",
                options: [
                    "Kompassen blir elektriskt laddad.",
                    "Magneten avmagnetiserar kompassen.",
                    "Kompassn√•len b√∂rjar snurra p√• grund av magnetf√§ltet.",
                    "Magnetf√§ltet skyddar kompassen fr√•n str√•lning."
                ],
                correct: 2,
                explanation: "Kring en magnet finns ett osynligt <strong>magnetf√§lt</strong> som p√•verkar kompasser s√• att kompassn√•len b√∂rjar snurra n√§r den f√∂rs mot magneten."
            },
            {
                q: "Vad √§r det som skapar magnetf√§ltet kring en elektromagnet?",
                options: [
                    "J√§rnspiken eller metallstaven.",
                    "Den statiska elektriciteten i spolen.",
                    "Str√∂mmen som g√•r genom ledaren.",
                    "Attraktionen mellan nord- och sydpolen."
                ],
                correct: 2,
                explanation: "Runt en sladd d√§r det g√•r <strong>str√∂m</strong> (ledare) uppst√•r det alltid ett <strong>magnetf√§lt</strong>."
            },
            {
                q: "Vilken regel g√§ller f√∂r magnetpoler?",
                options: [
                    "En nordpol och en sydpol repellerar varandra.",
                    "Tv√• sydpoler attraherar varandra.",
                    "Tv√• nordpoler st√∂ter bort varandra.",
                    "En nordpol kan attrahera ett icke-magnetiskt f√∂rem√•l."
                ],
                correct: 2,
                explanation: "Tv√• nordpoler eller tv√• sydpoler vill st√∂ta bort varandra (<strong>repellera</strong>)."
            }
        ]
    },
    {
        title: "Block 6: Elmotor och Generator",
        icon: "‚öôÔ∏è",
        text: "Sambandet mellan elektricitet och magnetism har lett till uppfinningar som elmotorn och generatorn. En <strong>elmotor</strong> omvandlar <strong>elektrisk energi till r√∂relseenergi</strong>. Den fungerar genom att en elektromagnet roterar i ett magnetf√§lt, d√§r snabba riktningsbyten i str√∂mmen f√•r elektromagnetens magnetf√§lt att v√§xla, vilket driver rotationen. En <strong>generator</strong> √§r motsatsen till elmotorn; den omvandlar <strong>r√∂relseenergi till elektrisk energi</strong> genom <strong>induktion</strong>. Generatorer producerar n√§stan all elektricitet i Sverige och kan finnas i vattenkraftverk, vindkraftverk och k√§rnkraftverk.",
        questions: [
            {
                q: "Vad omvandlar en generator?",
                options: [
                    "R√∂relseenergi till elektrisk energi.",
                    "Elektrisk energi till r√∂relseenergi.",
                    "V√§rmeenergi till kemisk energi.",
                    "Kemisk energi till elektrisk energi."
                ],
                correct: 0,
                explanation: "En <strong>generator</strong> √§r elmotorns motsats och omvandlar <strong>r√∂relseenergi till elektrisk energi</strong>, till exempel i vattenkraftverk."
            },
            {
                q: "Vad kallas det n√§r en magnet snurrar inuti en spole och alstrar str√∂m?",
                options: [
                    "Sp√§nning",
                    "Induktion",
                    "Ohms lag",
                    "Resistans"
                ],
                correct: 1,
                explanation: "Elektriciteten uppkommer genom att en magnet snurrar snabbt inuti en spole, vilket √§r ett fenomen som kallas <strong>induktion</strong>."
            },
            {
                q: "Vad √§r den grundl√§ggande funktionen hos en elmotor?",
                options: [
                    "Att utj√§mna laddningsskillnader.",
                    "Att m√§ta str√∂mstyrka.",
                    "Att reglera v√§xelstr√∂m.",
                    "Att omvandla elektrisk energi till r√∂relseenergi."
                ],
                correct: 3,
                explanation: "<strong>Elmotorer</strong> anv√§nds f√∂r att omvandla <strong>elektrisk energi till r√∂relseenergi</strong>, som i hush√•llsredskap och fordon."
            }
        ]
    }
];

    // --- STATE MANAGEMENT ---
    let currentSectionIndex = 0;
    let currentQuestionIndex = 0; // Relative to current section
    let score = 0;
    let userAnswers = [];
    let state = 'intro'; // 'intro', 'question', 'summary'

    // --- DOM ELEMENTS ---
    const app = document.getElementById('app');
    const headerTitle = document.getElementById('header-title');
    const progressBar = document.getElementById('progress-bar');

    // --- MAIN RENDER FUNCTION ---
    function render() {
        if (state === 'summary') {
            renderSummary();
            return;
        }

        const section = quizData[currentSectionIndex];

        // Update Header with smooth fade
        headerTitle.style.opacity = '0';
        setTimeout(() => {
            headerTitle.innerText = section.title;
            headerTitle.style.transition = 'opacity 0.2s';
            headerTitle.style.opacity = '1';
        }, 150);

        // Calculate total progress
        let totalQuestions = 0;
        let answeredQuestions = 0;
        
        quizData.forEach((sec, idx) => {
            totalQuestions += sec.questions.length;
            if (idx < currentSectionIndex) {
                answeredQuestions += sec.questions.length;
            } else if (idx === currentSectionIndex && state === 'question') {
                answeredQuestions += currentQuestionIndex;
            }
        });
        const pct = (answeredQuestions / totalQuestions) * 100;
        progressBar.style.width = `${pct}%`;

        if (state === 'intro') {
            renderSectionIntro(section);
        } else if (state === 'question') {
            renderQuestion(section.questions[currentQuestionIndex]);
        }
    }

    // --- RENDER SECTION TEXT ---
    function renderSectionIntro(section) {
        // Simple animation class reset
        app.classList.remove('fade-in');
        void app.offsetWidth; // trigger reflow
        app.classList.add('fade-in');

        app.innerHTML = `
            <div class="fact-box">
                <span class="fact-icon">${section.icon}</span>
                <div class="fact-content">
                    <h2>Fakta</h2>
                    <p style="line-height: 1.6; font-size: 1rem; margin-top:0;">${section.text}</p>
                </div>
            </div>
            <button class="btn" onclick="startQuestions()">Starta fr√•gor f√∂r denna del</button>
        `;
    }

    // --- RENDER QUESTION ---
    function renderQuestion(q) {
        const totalInCurrent = quizData[currentSectionIndex].questions.length;
        
        // Render with reset styles for feedback box
        app.innerHTML = `
            <div class="question-meta">Del ${currentSectionIndex + 1} ‚Ä¢ Fr√•ga ${currentQuestionIndex + 1}/${totalInCurrent}</div>
            <h2 style="color: #2c3e50; font-weight: 600; margin-bottom:15px;">${q.q}</h2>
            <div class="options-grid">
                ${q.options.map((opt, idx) => `
                    <button class="option-btn" onclick="handleAnswer(${idx})" id="opt-${idx}">${opt}</button>
                `).join('')}
            </div>
            <div id="feedback" class="feedback-box">
                <h3 id="feedback-title"></h3>
                <p id="feedback-text" style="margin: 5px 0 15px 0; font-size: 0.95rem; line-height: 1.6;"></p>
                <button class="btn" id="next-btn" onclick="nextStep()" style="margin-top:0; width: auto; min-width: 150px;">N√§sta fr√•ga ‚ûî</button>
            </div>
        `;
    }

    // --- RENDER SUMMARY ---
    function renderSummary() {
        headerTitle.innerText = "Sammanfattning";
        progressBar.style.width = '100%';
        
        let totalQ = 0;
        quizData.forEach(s => totalQ += s.questions.length);
        
        // Calculate score
        let correctCount = userAnswers.filter(a => a.isCorrect).length;
        let pct = Math.round((correctCount / totalQ) * 100);
        
        let gradeTitle = "";
        
        if(pct > 90) { gradeTitle = "Fantastiskt bra! üèÜ"; }
        else if(pct > 70) { gradeTitle = "Mycket bra jobbat! üåü"; }
        else if(pct > 50) { gradeTitle = "Godk√§nt! üëç"; }
        else { gradeTitle = "Forts√§tt k√§mpa! üí™"; }

        let html = `
            <div class="summary-stats">
                <h2 style="color:var(--brand-color); margin:0 0 10px 0;">${gradeTitle}</h2>
                <span class="summary-score">${correctCount}/${totalQ}</span>
                <span style="color:#666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">R√§tt svar</span>
                <button class="btn" onclick="location.reload()" style="background: transparent; border: 2px solid var(--accent-color); color: var(--accent-color); margin-top: 20px; box-shadow:none; width: auto; padding: 10px 30px;">G√∂r om testet</button>
            </div>
            <h3 style="margin: 0 0 10px 0; font-size: 1.1rem; color: var(--text-muted);">Dina svar:</h3>
            <div class="summary-list">
        `;

        userAnswers.forEach((ans, idx) => {
            const isCorrect = ans.isCorrect;
            
            html += `
                <div class="summary-item">
                    <span class="summary-question">${idx + 1}. ${ans.question}</span>
                    <div class="summary-answer-row">
                        ${isCorrect 
                            ? `<span class="summary-correct-text">‚úî ${ans.userAnswer}</span>` 
                            : `<span class="summary-wrong-text">‚úñ ${ans.userAnswer}</span> <span style="margin: 0 5px; color:#999;">‚ûî</span> <span class="real-answer">${ans.correctAnswer}</span>`
                        }
                    </div>
                </div>
            `;
        });

        html += `</div>`;
        app.innerHTML = html;
    }

    // --- LOGIC FUNCTIONS ---
    window.startQuestions = function() {
        state = 'question';
        currentQuestionIndex = 0;
        render();
    };

    window.handleAnswer = function(selectedIndex) {
        // Disable all buttons
        const buttons = document.querySelectorAll('.option-btn');
        buttons.forEach(b => b.disabled = true);

        const section = quizData[currentSectionIndex];
        const currentQ = section.questions[currentQuestionIndex];
        const isCorrect = selectedIndex === currentQ.correct;

        // Visual feedback on buttons
        const selectedBtn = document.getElementById(`opt-${selectedIndex}`);
        const correctBtn = document.getElementById(`opt-${currentQ.correct}`);

        if (isCorrect) {
            selectedBtn.classList.add('correct');
        } else {
            selectedBtn.classList.add('incorrect');
            correctBtn.classList.add('correct'); // Show which one was right
        }

        // Show feedback box
        const feedbackBox = document.getElementById('feedback');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackText = document.getElementById('feedback-text');
        const nextBtn = document.getElementById('next-btn');

        feedbackBox.style.display = 'block';
        
        // Add class for success/error styling
        if (isCorrect) {
            feedbackBox.className = "feedback-box success";
            feedbackTitle.innerHTML = "R√§tt svar!"; 
        } else {
            feedbackBox.className = "feedback-box error";
            feedbackTitle.innerHTML = "Inte riktigt..."; 
        }
        
        feedbackText.innerHTML = currentQ.explanation; // Use innerHTML to render <strong> tags

        // Check if last question of entire quiz
        const isLastQuestionOverall = (currentSectionIndex === quizData.length - 1) && (currentQuestionIndex === section.questions.length - 1);
        
        if(isLastQuestionOverall) {
            nextBtn.innerText = "Se resultat üèÅ";
        } else if (currentQuestionIndex === section.questions.length - 1) {
            nextBtn.innerText = "N√§sta del ‚ûî";
        }

        // Scroll to feedback if needed on mobile, but gently
        const rect = feedbackBox.getBoundingClientRect();
        const isVisible = (rect.top >= 0) && (rect.bottom <= window.innerHeight);
        if (!isVisible) {
             setTimeout(() => {
                feedbackBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        // Save data
        userAnswers.push({
            question: currentQ.q,
            userAnswer: currentQ.options[selectedIndex],
            correctAnswer: currentQ.options[currentQ.correct],
            isCorrect: isCorrect
        });
    };

    window.nextStep = function() {
        const section = quizData[currentSectionIndex];
        
        // Reset feedback styles for next render
        const feedbackBox = document.getElementById('feedback');
        if(feedbackBox) {
            feedbackBox.style.display = 'none';
        }

        // Check if there are more questions in this section
        if (currentQuestionIndex < section.questions.length - 1) {
            currentQuestionIndex++;
            render();
        } else {
            // End of section, move to next section
            if (currentSectionIndex < quizData.length - 1) {
                currentSectionIndex++;
                state = 'intro';
                render();
            } else {
                // End of quiz
                state = 'summary';
                render();
            }
        }
    };

    // --- INIT ---
    render();

</script>

</body>
</html>
