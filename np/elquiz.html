<!DOCTYPE html>
        <html lang="sv">
        <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Fysikquiz: El & Magnetism (Åk 9)</title>
        <!-- Importerar moderna fonter från Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
        


        <style>
        :root {
        /* Färgpalett - Professionell & Ren */
        --card-bg: #ffffff;
        


        --brand-color: #2c3e50;
        --brand-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        


        --accent-color: #3498db;
        


        --success-color: #10ac84;
        --success-bg: #e3f9f1;
        


        --error-color: #ee5253;
        --error-bg: #ffeded;
        


        --text-main: #2d3436;
        --text-muted: #636e72;
        


        --shadow-card: 0 10px 25px rgba(0,0,0,0.15);
        --shadow-hover: 0 6px 16px rgba(0,0,0,0.12);
        --radius-main: 16px;
        }
        


        body {
        font-family: 'Open Sans', sans-serif;
        /* Gråaktig fade (Silver/Metallic style) */
        background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        color: var(--text-main);
        margin: 0;
        padding: 15px;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        }
        


        .container {
        background-color: var(--card-bg);
        width: 100%;
        max-width: 680px;
        border-radius: var(--radius-main);
        box-shadow: var(--shadow-card);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        position: relative;
        margin-top: 3vh;
        margin-bottom: 3vh;
        }
        


        header {
        background: var(--brand-gradient);
        color: white;
        padding: 20px;
        text-align: center;
        position: relative;
        overflow: hidden;
        }
        


        h1 {
        font-family: 'Poppins', sans-serif;
        margin: 0;
        font-size: 1.5rem;
        font-weight: 700;
        letter-spacing: -0.3px;
        }
        


        .content-area {
        padding: 25px 30px;
        flex-grow: 1;
        }
        


        h2 {
        font-family: 'Poppins', sans-serif;
        color: var(--brand-color);
        margin-top: 0;
        font-size: 1.3rem;
        margin-bottom: 0.8rem;
        line-height: 1.3;
        }
        


        /* Fact Section Styles */
        .fact-box {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        /* Borttagen border-left enligt önskemål */
        display: flex;
        gap: 15px;
        align-items: flex-start;
        }
        


        .fact-icon {
        font-size: 2rem;
        display: block;
        margin-top: -5px;
        }
        


        .fact-content {
        flex: 1;
        }
        


        .btn {
        background: var(--brand-gradient);
        color: white;
        border: none;
        padding: 12px 24px;
        font-family: 'Poppins', sans-serif;
        font-size: 1rem;
        font-weight: 600;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: block;
        width: 100%;
        margin-top: 20px;
        box-shadow: 0 4px 10px rgba(52, 152, 219, 0.2);
        }
        


        .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 14px rgba(52, 152, 219, 0.3);
        opacity: 0.95;
        }
        


        /* Question Styles */
        .question-meta {
        display: inline-block;
        color: var(--text-muted);
        font-size: 0.85rem;
        margin-bottom: 10px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        }
        


        .options-grid {
        display: grid;
        gap: 12px;
        margin-top: 20px;
        }
        


        .option-btn {
        background-color: #fff;
        border: 2px solid #f1f2f6;
        padding: 15px 20px;
        text-align: left;
        border-radius: 10px;
        cursor: pointer;
        font-family: 'Open Sans', sans-serif;
        font-size: 0.95rem;
        font-weight: 500;
        transition: all 0.15s ease;
        color: var(--text-main);
        position: relative;
        }
        


        .option-btn:hover:not(:disabled) {
        border-color: var(--accent-color);
        background-color: #f8fcff;
        transform: translateX(3px);
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        


        /* Status states for options */
        .option-btn.correct {
        background-color: var(--success-bg);
        border-color: var(--success-color);
        color: #0b6e4f;
        font-weight: 600;
        }
        


        .option-btn.correct::after {
        content: "✓";
        position: absolute;
        right: 15px;
        font-weight: bold;
        }
        


        .option-btn.incorrect {
        background-color: var(--error-bg);
        border-color: var(--error-color);
        color: #c0392b;
        opacity: 0.8;
        }
        


        .option-btn:disabled {
        cursor: default;
        }
        


        /* Feedback Box */
        .feedback-box {
        margin-top: 20px;
        padding: 20px 25px;
        border-radius: 12px;
        background-color: #f8f9fa;
        color: var(--text-main);
        border: 1px solid #e9ecef;
        display: none;
        animation: fadeIn 0.3s ease;
        }
        


        .feedback-box h3 {
        margin-top: 0;
        font-family: 'Poppins', sans-serif;
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
        }
        


        .feedback-box.success h3 {
        color: var(--success-color);
        }
        


        .feedback-box.error h3 {
        color: var(--error-color);
        }
        


        .feedback-box strong {
        color: var(--brand-color);
        }
        


        @keyframes fadeIn {
        from { opacity: 0; transform: translateY(5px); }
        to { opacity: 1; transform: translateY(0); }
        }
        


        /* Progress Bar Styles */
        .progress-bar-container {
        height: 6px;
        background-color: #f1f3f5;
        width: 100%;
        position: relative;
        z-index: 10;
        }
        


        .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
        width: 0%;
        transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        border-radius: 0 4px 4px 0;
        box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
        }
        


        /* Summary Styles */
        .summary-stats {
        text-align: center;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border: 1px solid #dee2e6;
        padding: 30px 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        }
        


        .summary-score {
        font-size: 3.5rem;
        font-family: 'Poppins', sans-serif;
        font-weight: 700;
        display: block;
        margin: 5px 0;
        line-height: 1;
        background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        }
        


        .summary-list {
        max-height: 400px;
        overflow-y: auto;
        padding-right: 10px;
        }
        


        .summary-item {
        background: white;
        border-bottom: 1px solid #f1f1f1;
        padding: 12px 0;
        }
        


        .summary-item:last-child {
        border-bottom: none;
        }
        


        .summary-question {
        font-weight: 600;
        margin-bottom: 4px;
        display: block;
        font-size: 0.95rem;
        }
        


        .summary-answer-row {
        font-size: 0.9rem;
        }
        


        .summary-correct-text { color: var(--success-color); font-weight: 600; }
        .summary-wrong-text { color: var(--error-color); text-decoration: line-through; opacity: 0.8;}
        .real-answer { color: var(--success-color); font-weight: 600; margin-left: 5px; }
        


        /* Helpers */
        strong {
        color: var(--brand-color);
        font-weight: 700;
        }
        


        </style>
        </head>
        <body>
        


        <div class="container">
        <header>
        <h1 id="header-title">Fysikquiz: El & Magnetism</h1>
        </header>
        <div class="progress-bar-container">
        <div class="progress-bar" id="progress-bar"></div>
        </div>
        


        <div class="content-area" id="app">
        <!-- Content will be injected here by JavaScript -->
        </div>
        </div>
        


        <script>
        // --- DATA ---
        const quizData = [
         {
   "title": "Block 1: Statisk Elektricitet",
   "icon": "⚡",
   "text": "En atom består av negativt laddade <strong>elektroner</strong> och positivt laddade <strong>protoner</strong>. Normalt är atomen oladdad, men <strong>statisk elektricitet</strong> uppstår när man gnider bort negativa laddningar, vilket gör att atomen blir positivt laddad. Naturen strävar alltid efter att jämna ut skillnader, så atomen kommer förr eller senare att återfå sin negativa laddning. Ett exempel på statisk elektricitet är <strong>åska</strong>, där åskmolnen blir positivt laddade upptill och negativt laddade nertill, närmast jorden.",
   "questions": [
     {
       "q": "Vilken elementarpartikel i atomen bär på en negativ laddning?",
       "options": [
         "Protonen, som finns i atomkärnan.",
         "Neutronen, som väger mest.",
         "Elektronen, som cirkulerar runt kärnan.",
         "Fotonen, som bär på ljusenergi."
       ],
       "correct": 2,
       "explanation": "Det är <strong>elektronerna</strong> som är negativt laddade och befinner sig i banor runt atomkärnan. Protoner är positiva och neutroner är neutrala, medan fotoner är ljuspartiklar utan elektrisk laddning. Det är elektronernas rörelse som skapar elektricitet."
     },
     {
       "q": "Vad kallas fenomenet när laddningsskillnader uppstår genom gnidning?",
       "options": [
         "Statisk elektricitet",
         "Elektromagnetisk induktion",
         "Galvanisk ström",
         "Termisk jonisation"
       ],
       "correct": 0,
       "explanation": "När elektroner gnids bort från ett material uppstår ett överskott av positiva laddningar, vilket kallas <strong>statisk elektricitet</strong>. Detta skapar en obalans som naturen strävar efter att jämna ut, ibland genom en stöt. De andra alternativen beskriver andra fysikaliska fenomen."
     },
     {
       "q": "Vilket naturfenomen är en direkt följd av en kraftig statisk urladdning?",
       "options": [
         "Norrsken (Aurora Borealis)",
         "Geotermisk aktivitet",
         "Tidvattenvågor",
         "Åska och blixtar"
       ],
       "correct": 3,
       "explanation": "<strong>Åska</strong> uppstår när enorma mängder statisk elektricitet har byggts upp i moln och urladdas mot marken eller andra moln. Blixten är själva gnistan som jämnar ut laddningsskillnaden. Norrsken beror däremot på partiklar från solen som träffar atmosfären."
     }
   ]
 },
 {
   "title": "Block 2: Spänning och Ström",
   "icon": "🔌",
   "text": "Elektricitet är ett flöde av elektroner. <strong>Spänning</strong> (mäts i <strong>volt, V</strong>) är skillnaden i laddning (elektrisk potential) mellan plus- och minuspolen, och det är spänningen som får elektronerna att röra sig. <strong>Ström</strong> (mäts i <strong>Ampere, A</strong>) är flödet av elektroner i en ledning. Spänningen gör det möjligt för strömmen att existera, men det är strömmen som driver elektriska produkter.",
   "questions": [
     {
       "q": "Vilken enhet används korrekt för att mäta elektrisk spänning?",
       "options": [
         "Ampere (A)",
         "Volt (V)",
         "Ohm (Ω)",
         "Watt (W)"
       ],
       "correct": 1,
       "explanation": "Spänning är måttet på den drivande kraften och mäts alltid i <strong>Volt (V)</strong>. Ampere används för strömstyrka, Ohm för motstånd och Watt för effekt. En enkel minnesregel är att batterier ofta är märkta med just V (t.ex. 1.5V)."
     },
     {
       "q": "Vad är det som faktiskt får en lampa att lysa eller en motor att snurra?",
       "options": [
         "Spänningsnivån i uttaget",
         "Den elektriska potentialen",
         "Strömmen (elektronflödet)",
         "Resistansen i ledningen"
       ],
       "correct": 2,
       "explanation": "Det är själva <strong>strömmen</strong>, alltså flödet av elektroner, som utför arbetet och driver elektriska apparater. Spänningen är bara förutsättningen som knuffar igång strömmen, men utan flödet händer inget."
     },
     {
       "q": "Vad är den avgörande skillnaden mellan likström och växelström?",
       "options": [
         "Likström rör sig alltid i en riktning, medan växelström byter riktning.",
         "Växelström har alltid en högre spänning än vad likström har.",
         "Likström används i vägguttag medan växelström endast finns i batterier.",
         "Växelström mäts i Hertz medan likström mäts i Ampere."
       ],
       "correct": 0,
       "explanation": "Skillnaden ligger i flödets riktning: <strong>Likström</strong> (DC) går alltid från plus till minus, medan <strong>växelström</strong> (AC) byter riktning snabbt, i Sverige 50 gånger per sekund (50 Hz). Batterier ger likström, medan vägguttag ger växelström."
     }
   ]
 },
 {
   "title": "Block 3: Resistans & Ohms lag",
   "icon": "💡",
   "text": "<strong>Elektrisk resistans</strong> (motstånd) påverkar strömmen i en ledare. En bra ledare, som <strong>koppar</strong>, har låg resistans, vilket tillåter fler elektroner att passera. Låg resistans uppnås genom <strong>låg temperatur</strong>, <strong>stor diameter</strong> och <strong>kort längd</strong> på ledaren. Sambandet mellan spänning (U), ström (I) och resistans (R) beskrivs av <strong>Ohms lag</strong>: U = R * I. När ström stöter på motstånd omvandlas elektrisk energi till värmeenergi.",
   "questions": [
     {
       "q": "Vilken kombination av egenskaper ger en ledare lägst resistans?",
       "options": [
         "Hög temperatur, liten diameter och lång längd.",
         "Låg temperatur, liten diameter och kort längd.",
         "Hög temperatur, stor diameter och kort längd.",
         "Låg temperatur, stor diameter och kort längd."
       ],
       "correct": 3,
       "explanation": "För att elektroner ska passera så lätt som möjligt (låg resistans) ska ledaren vara kall, tjock och kort. En <strong>stor diameter</strong> ger mer plats, en <strong>kort längd</strong> ger mindre väg att färdas, och <strong>låg temperatur</strong> minskar atomernas rörelser som annars hindrar strömmen."
     },
     {
       "q": "Vilken metall är vanligast i elkablar tack vare sin goda ledningsförmåga?",
       "options": [
         "Järn (Fe)",
         "Koppar (Cu)",
         "Aluminium (Al)",
         "Zink (Zn)"
       ],
       "correct": 1,
       "explanation": "<strong>Koppar</strong> är den metall som används mest eftersom den leder ström mycket bra och är relativt billig jämfört med silver (som leder bäst). Järn har betydligt högre resistans och skulle skapa för mycket värme."
     },
     {
       "q": "Hur formuleras Ohms lag matematiskt om man vill räkna ut spänningen (U)?",
       "options": [
         "U = I / R (Spänning = Ström / Resistans)",
         "U = R + I (Spänning = Resistans + Ström)",
         "U = R * I (Spänning = Resistans * Ström)",
         "U = I - R (Spänning = Ström - Resistans)"
       ],
       "correct": 2,
       "explanation": "Enligt <strong>Ohms lag</strong> är spänningen lika med resistansen multiplicerat med strömmen (U = R * I). Det betyder att om du ökar motståndet vid en konstant ström, så krävs det högre spänning."
     }
   ]
 },
 {
   "title": "Block 4: Kopplingar & Effekt",
   "icon": "🔋",
   "text": "<strong>Elektrisk effekt</strong> (P, mäts i <strong>watt, W</strong>) mäter hur snabbt en apparat omvandlar elektrisk energi. För att mäta den totala energiförbrukningen multiplicerar man effekten med tiden, vilket mäts i <strong>watt-timmar (Wh)</strong> eller kilowatt-timmar (kWh). När komponenter kopplas i <strong>seriekoppling</strong> adderas spänningen om det är batterier, men om en komponent går sönder bryts kretsen. I en <strong>parallellkoppling</strong> har strömmen flera vägar, vilket gör att om en lampa går sönder fortsätter de andra att lysa.",
   "questions": [
     {
       "q": "Vad inträffar i en seriekoppling (t.ex. en gammal julgransbelysning) om en lampa går sönder?",
       "options": [
         "Kretsen bryts helt och alla lampor slocknar.",
         "Spänningen ökar i de lampor som är hela.",
         "De övriga lamporna lyser starkare än förut.",
         "Säkringen går omedelbart på grund av kortslutning."
       ],
       "correct": 0,
       "explanation": "I en <strong>seriekoppling</strong> finns bara en enda väg för strömmen. Om en lampa går sönder blir det ett avbrott i kretsen, precis som om man klipper av sladden, och därför <strong>slocknar alla lampor</strong>."
     },
     {
       "q": "Hur påverkas spänningen över lamporna i en parallellkoppling jämfört med strömkällan?",
       "options": [
         "Spänningen delas upp lika mellan antalet lampor.",
         "Spänningen varierar beroende på lampans storlek.",
         "Spänningen är lika stor över varje lampa som hos källan.",
         "Spänningen minskar drastiskt för varje ny lampa."
       ],
       "correct": 2,
       "explanation": "I en <strong>parallellkoppling</strong> är varje lampa direkt kopplad till strömkällans poler. Det innebär att alla lampor får <strong>samma spänning</strong> som batteriet, och de lyser därmed med full styrka oavsett hur många de är."
     },
     {
       "q": "Vilken enhet används för att beskriva elektrisk effekt (hur snabbt energi omvandlas)?",
       "options": [
         "Joule (J)",
         "Watt (W)",
         "Newton (N)",
         "Hertz (Hz)"
       ],
       "correct": 1,
       "explanation": "<strong>Elektrisk effekt</strong> mäts i <strong>Watt (W)</strong>. Det är ett mått på hur mycket energi en apparat förbrukar per sekund. Joule är en energienhet, Newton mäter kraft och Hertz mäter frekvens."
     }
   ]
 },
 {
   "title": "Block 5: Magnetism",
   "icon": "🧲",
   "text": "Magneter drar till sig magnetiska metaller som järn (Fe), nickel (Ni) och kobolt (Co). Runt varje magnet finns ett osynligt <strong>magnetfält</strong>. Lika magnetpoler stöter bort varandra (<strong>repellera</strong>), medan olika poler dras mot varandra (<strong>attrahera</strong>). Runt en strömförande ledare uppstår det alltid ett magnetfält. Detta utnyttjas i <strong>elektromagneter</strong>, vars styrka kan ökas genom att linda metalltråden som en <strong>spole</strong> (ju fler varv desto starkare) och använda en järnspik som kärna.",
   "questions": [
     {
       "q": "Hur reagerar en kompassnål om den placeras i ett magnetfält?",
       "options": [
         "Den tappar sin magnetism helt och hållet.",
         "Den börjar vibrera och alstrar värme.",
         "Den pekar alltid mot geografiskt söder.",
         "Den vrider in sig längs med magnetfältets linjer."
       ],
       "correct": 3,
       "explanation": "En kompassnål är själv en liten magnet. Eftersom magneter påverkar varandra kommer nålen att <strong>vrida sig</strong> tills den ligger i linje med det yttre <strong>magnetfältet</strong>, vare sig det kommer från jorden eller en annan magnet."
     },
     {
       "q": "Vad är den primära orsaken till att ett magnetfält uppstår i en elektromagnet?",
       "options": [
         "Den elektriska strömmen som rör sig i ledaren.",
         "Tyngden hos järnkärnan inuti spolen.",
         "Friktionen mellan ledaren och isoleringen.",
         "Det statiska lufttrycket runt spolen."
       ],
       "correct": 0,
       "explanation": "Det är <strong>strömmen</strong> (elektronernas rörelse) som skapar magnetfältet. Utan ström är elektromagneten bara en bit metalltråd. Järnkärnan förstärker bara det fält som strömmen redan skapat."
     },
     {
       "q": "Vad händer om du för en magnets nordpol mot en annan magnets nordpol?",
       "options": [
         "De attraherar varandra (dras ihop).",
         "De repellerar varandra (stöts bort).",
         "De neutraliserar varandra och tappar kraft.",
         "Ingenting händer eftersom de är lika."
       ],
       "correct": 1,
       "explanation": "Grundregeln inom magnetism är att lika poler (nord mot nord eller syd mot syd) <strong>repellerar</strong> varandra, medan olika poler <strong>attraherar</strong> varandra. Det känns som att det finns en osynlig kudde mellan dem."
     }
   ]
 },
 {
   "title": "Block 6: Elmotor och Generator",
   "icon": "⚙️",
   "text": "Sambandet mellan elektricitet och magnetism har lett till uppfinningar som elmotorn och generatorn. En <strong>elmotor</strong> omvandlar <strong>elektrisk energi till rörelseenergi</strong>. Den fungerar genom att en elektromagnet roterar i ett magnetfält, där snabba riktningsbyten i strömmen får elektromagnetens magnetfält att växla, vilket driver rotationen. En <strong>generator</strong> är motsatsen till elmotorn; den omvandlar <strong>rörelseenergi till elektrisk energi</strong> genom <strong>induktion</strong>. Generatorer producerar nästan all elektricitet i Sverige och kan finnas i vattenkraftverk, vindkraftverk och kärnkraftverk.",
   "questions": [
     {
       "q": "Vad är en generators huvudsakliga uppgift i ett kraftverk?",
       "options": [
         "Att omvandla elektrisk energi till rörelse.",
         "Att lagra överskottsvärme från turbinen.",
         "Att omvandla rörelseenergi till elektrisk energi.",
         "Att reglera vattenflödet genom dammluckorna."
       ],
       "correct": 2,
       "explanation": "Generatorn fungerar precis tvärtom mot en motor. Den tar emot <strong>rörelseenergi</strong> (t.ex. från en snurrande turbin i ett vattenkraftverk) och omvandlar den till <strong>elektrisk energi</strong> som vi kan använda."
     },
     {
       "q": "Vilket fysikaliskt fenomen beskriver hur ström skapas när en magnet rör sig i en spole?",
       "options": [
         "Induktion",
         "Deduktion",
         "Konduktion",
         "Reduktion"
       ],
       "correct": 0,
       "explanation": "Detta kallas <strong>induktion</strong>. När ett magnetfält förändras inuti en spole (genom att magneten rör sig) så \"knuffas\" elektronerna igång och en ström bildas. Det är principen för alla generatorer."
     },
     {
       "q": "Vad används en elmotor till?",
       "options": [
         "Att skapa värme i element.",
         "Att generera ström till elnätet.",
         "Att lagra kemisk energi.",
         "Att omvandla el till rörelse."
       ],
       "correct": 3,
       "explanation": "En <strong>elmotor</strong> använder elektricitet och magnetism för att skapa en roterande rörelse. Den omvandlar alltså <strong>elektrisk energi till rörelseenergi</strong>, vilket används i allt från elbilar till elvispar."
     }
   ]
 }
];


        // --- STATE MANAGEMENT ---
        let currentSectionIndex = 0;
        let currentQuestionIndex = 0; // Relative to current section
        let score = 0;
        let userAnswers = [];
        let state = 'intro'; // 'intro', 'question', 'summary'
        


        // --- DOM ELEMENTS ---
        const app = document.getElementById('app');
        const headerTitle = document.getElementById('header-title');
        const progressBar = document.getElementById('progress-bar');
        


        // --- MAIN RENDER FUNCTION ---
        function render() {
        if (state === 'summary') {
        renderSummary();
        return;
        }
        


        const section = quizData[currentSectionIndex];
        


        // Update Header with smooth fade
        headerTitle.style.opacity = '0';
        setTimeout(() => {
        headerTitle.innerText = section.title;
        headerTitle.style.transition = 'opacity 0.2s';
        headerTitle.style.opacity = '1';
        }, 150);
        


        // Calculate total progress
        let totalQuestions = 0;
        let answeredQuestions = 0;
        


        quizData.forEach((sec, idx) => {
        totalQuestions += sec.questions.length;
        if (idx < currentSectionIndex) {
        answeredQuestions += sec.questions.length;
        } else if (idx === currentSectionIndex && state === 'question') {
        answeredQuestions += currentQuestionIndex;
        }
        });
        const pct = (answeredQuestions / totalQuestions) * 100;
        progressBar.style.width = `${pct}%`;
        


        if (state === 'intro') {
        renderSectionIntro(section);
        } else if (state === 'question') {
        renderQuestion(section.questions[currentQuestionIndex]);
        }
        }
        


        // --- RENDER SECTION TEXT ---
        function renderSectionIntro(section) {
        // Simple animation class reset
        app.classList.remove('fade-in');
        void app.offsetWidth; // trigger reflow
        app.classList.add('fade-in');
        


        app.innerHTML = `
        <div class="fact-box">
        <span class="fact-icon">${section.icon}</span>
        <div class="fact-content">
        <h2>Fakta</h2>
        <p style="line-height: 1.6; font-size: 1rem; margin-top:0;">${section.text}</p>
        </div>
        </div>
        <button class="btn" onclick="startQuestions()">Starta frågor för denna del</button>
        `;
        }
        


        // --- RENDER QUESTION ---
        function renderQuestion(q) {
        const totalInCurrent = quizData[currentSectionIndex].questions.length;
        


        // Render with reset styles for feedback box
        app.innerHTML = `
        <div class="question-meta">Del ${currentSectionIndex + 1} • Fråga ${currentQuestionIndex + 1}/${totalInCurrent}</div>
        <h2 style="color: #2c3e50; font-weight: 600; margin-bottom:15px;">${q.q}</h2>
        <div class="options-grid">
        ${q.options.map((opt, idx) => `
        <button class="option-btn" onclick="handleAnswer(${idx})" id="opt-${idx}">${opt}</button>
        `).join('')}
        </div>
        <div id="feedback" class="feedback-box">
        <h3 id="feedback-title"></h3>
        <p id="feedback-text" style="margin: 5px 0 15px 0; font-size: 0.95rem; line-height: 1.6;"></p>
        <button class="btn" id="next-btn" onclick="nextStep()" style="margin-top:0; width: auto; min-width: 150px;">Nästa fråga ➔</button>
        </div>
        `;
        }
        


        // --- RENDER SUMMARY ---
        function renderSummary() {
        headerTitle.innerText = "Sammanfattning";
        progressBar.style.width = '100%';
        


        let totalQ = 0;
        quizData.forEach(s => totalQ += s.questions.length);
        


        // Calculate score
        let correctCount = userAnswers.filter(a => a.isCorrect).length;
        let pct = Math.round((correctCount / totalQ) * 100);
        


        let gradeTitle = "";
        


        if(pct > 90) { gradeTitle = "Fantastiskt bra! 🏆"; }
        else if(pct > 70) { gradeTitle = "Mycket bra jobbat! 🌟"; }
        else if(pct > 50) { gradeTitle = "Godkänt! 👍"; }
        else { gradeTitle = "Fortsätt kämpa! 💪"; }
        


        let html = `
        <div class="summary-stats">
        <h2 style="color:var(--brand-color); margin:0 0 10px 0;">${gradeTitle}</h2>
        <span class="summary-score">${correctCount}/${totalQ}</span>
        <span style="color:#666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Rätt svar</span>
        <button class="btn" onclick="location.reload()" style="background: transparent; border: 2px solid var(--accent-color); color: var(--accent-color); margin-top: 20px; box-shadow:none; width: auto; padding: 10px 30px;">Gör om testet</button>
        </div>
        <h3 style="margin: 0 0 10px 0; font-size: 1.1rem; color: var(--text-muted);">Dina svar:</h3>
        <div class="summary-list">
        `;
        


        userAnswers.forEach((ans, idx) => {
        const isCorrect = ans.isCorrect;
        


        html += `
        <div class="summary-item">
        <span class="summary-question">${idx + 1}. ${ans.question}</span>
        <div class="summary-answer-row">
        ${isCorrect
        ? `<span class="summary-correct-text">✔ ${ans.userAnswer}</span>`
        : `<span class="summary-wrong-text">✖ ${ans.userAnswer}</span> <span style="margin: 0 5px; color:#999;">➔</span> <span class="real-answer">${ans.correctAnswer}</span>`
        }
        </div>
        </div>
        `;
        });
        


        html += `</div>`;
        app.innerHTML = html;
        }
        


        // --- LOGIC FUNCTIONS ---
        window.startQuestions = function() {
        state = 'question';
        currentQuestionIndex = 0;
        render();
        };
        


        window.handleAnswer = function(selectedIndex) {
        // Disable all buttons
        const buttons = document.querySelectorAll('.option-btn');
        buttons.forEach(b => b.disabled = true);
        


        const section = quizData[currentSectionIndex];
        const currentQ = section.questions[currentQuestionIndex];
        const isCorrect = selectedIndex === currentQ.correct;
        


        // Visual feedback on buttons
        const selectedBtn = document.getElementById(`opt-${selectedIndex}`);
        const correctBtn = document.getElementById(`opt-${currentQ.correct}`);
        


        if (isCorrect) {
        selectedBtn.classList.add('correct');
        } else {
        selectedBtn.classList.add('incorrect');
        correctBtn.classList.add('correct'); // Show which one was right
        }
        


        // Show feedback box
        const feedbackBox = document.getElementById('feedback');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackText = document.getElementById('feedback-text');
        const nextBtn = document.getElementById('next-btn');
        


        feedbackBox.style.display = 'block';
        


        // Add class for success/error styling
        if (isCorrect) {
        feedbackBox.className = "feedback-box success";
        feedbackTitle.innerHTML = "Rätt svar!";
        } else {
        feedbackBox.className = "feedback-box error";
        feedbackTitle.innerHTML = "Inte riktigt...";
        }
        


        feedbackText.innerHTML = currentQ.explanation; // Use innerHTML to render <strong> tags
        


        // Check if last question of entire quiz
        const isLastQuestionOverall = (currentSectionIndex === quizData.length - 1) && (currentQuestionIndex === section.questions.length - 1);
        


        if(isLastQuestionOverall) {
        nextBtn.innerText = "Se resultat 🏁";
        } else if (currentQuestionIndex === section.questions.length - 1) {
        nextBtn.innerText = "Nästa del ➔";
        }
        


        // Scroll to feedback if needed on mobile, but gently
        const rect = feedbackBox.getBoundingClientRect();
        const isVisible = (rect.top >= 0) && (rect.bottom <= window.innerHeight);
        if (!isVisible) {
        setTimeout(() => {
        feedbackBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }, 100);
        }
        


        // Save data
        userAnswers.push({
        question: currentQ.q,
        userAnswer: currentQ.options[selectedIndex],
        correctAnswer: currentQ.options[currentQ.correct],
        isCorrect: isCorrect
        });
        };
        


        window.nextStep = function() {
        const section = quizData[currentSectionIndex];
        


        // Reset feedback styles for next render
        const feedbackBox = document.getElementById('feedback');
        if(feedbackBox) {
        feedbackBox.style.display = 'none';
        }
        


        // Check if there are more questions in this section
        if (currentQuestionIndex < section.questions.length - 1) {
        currentQuestionIndex++;
        render();
        } else {
        // End of section, move to next section
        if (currentSectionIndex < quizData.length - 1) {
        currentSectionIndex++;
        state = 'intro';
        render();
        } else {
        // End of quiz
        state = 'summary';
        render();
        }
        }
        };
        


        // --- INIT ---
        render();
        


        </script>
        


        </body>
        </html>