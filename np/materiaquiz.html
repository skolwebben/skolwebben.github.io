<!DOCTYPE html>
<html lang="sv">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Fysikquiz: Materia & Värme (Åk 9)</title>
   <!-- Importerar moderna fonter från Google Fonts -->
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  
   <style>
       :root {
           /* Färgpalett - Professionell & Ren */
           --card-bg: #ffffff;
          
           --brand-color: #2c3e50;
           --brand-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
          
           --accent-color: #3498db;
          
           --success-color: #10ac84;
           --success-bg: #e3f9f1;
          
           --error-color: #ee5253;
           --error-bg: #ffeded;
          
           --text-main: #2d3436;
           --text-muted: #636e72;
          
           --shadow-card: 0 10px 25px rgba(0,0,0,0.15);
           --shadow-hover: 0 6px 16px rgba(0,0,0,0.12);
           --radius-main: 16px;
       }


       body {
           font-family: 'Open Sans', sans-serif;
           /* Gråaktig fade (Silver/Metallic style) */
           background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
           color: var(--text-main);
           margin: 0;
           padding: 15px;
           display: flex;
           justify-content: center;
           align-items: flex-start;
           min-height: 100vh;
       }


       .container {
           background-color: var(--card-bg);
           width: 100%;
           max-width: 680px;
           border-radius: var(--radius-main);
           box-shadow: var(--shadow-card);
           overflow: hidden;
           display: flex;
           flex-direction: column;
           position: relative;
           margin-top: 3vh;
           margin-bottom: 3vh;
       }


       header {
           background: var(--brand-gradient);
           color: white;
           padding: 20px;
           text-align: center;
           position: relative;
           overflow: hidden;
       }


       h1 {
           font-family: 'Poppins', sans-serif;
           margin: 0;
           font-size: 1.5rem;
           font-weight: 700;
           letter-spacing: -0.3px;
       }


       .content-area {
           padding: 25px 30px;
           flex-grow: 1;
       }


       h2 {
           font-family: 'Poppins', sans-serif;
           color: var(--brand-color);
           margin-top: 0;
           font-size: 1.3rem;
           margin-bottom: 0.8rem;
           line-height: 1.3;
       }


       /* Fact Section Styles */
       .fact-box {
           background: #f8f9fa;
           border-radius: 12px;
           padding: 20px;
           margin-bottom: 20px;
           /* Ingen border-left */
           display: flex;
           gap: 15px;
           align-items: flex-start;
       }
      
       .fact-icon {
           font-size: 2rem;
           display: block;
           margin-top: -5px;
       }
      
       .fact-content {
           flex: 1;
       }


       .btn {
           background: var(--brand-gradient);
           color: white;
           border: none;
           padding: 12px 24px;
           font-family: 'Poppins', sans-serif;
           font-size: 1rem;
           font-weight: 600;
           border-radius: 8px;
           cursor: pointer;
           transition: all 0.2s ease;
           display: block;
           width: 100%;
           margin-top: 20px;
           box-shadow: 0 4px 10px rgba(52, 152, 219, 0.2);
       }


       .btn:hover {
           transform: translateY(-2px);
           box-shadow: 0 6px 14px rgba(52, 152, 219, 0.3);
           opacity: 0.95;
       }


       /* Question Styles */
       .question-meta {
           display: inline-block;
           color: var(--text-muted);
           font-size: 0.85rem;
           margin-bottom: 10px;
           font-weight: 600;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }


       .options-grid {
           display: grid;
           gap: 12px;
           margin-top: 20px;
       }


       .option-btn {
           background-color: #fff;
           border: 2px solid #f1f2f6;
           padding: 15px 20px;
           text-align: left;
           border-radius: 10px;
           cursor: pointer;
           font-family: 'Open Sans', sans-serif;
           font-size: 0.95rem;
           font-weight: 500;
           transition: all 0.15s ease;
           color: var(--text-main);
           position: relative;
       }


       .option-btn:hover:not(:disabled) {
           border-color: var(--accent-color);
           background-color: #f8fcff;
           transform: translateX(3px);
           box-shadow: 0 2px 5px rgba(0,0,0,0.05);
       }
      
       /* Status states for options */
       .option-btn.correct {
           background-color: var(--success-bg);
           border-color: var(--success-color);
           color: #0b6e4f;
           font-weight: 600;
       }
      
       .option-btn.correct::after {
           content: "✓";
           position: absolute;
           right: 15px;
           font-weight: bold;
       }


       .option-btn.incorrect {
           background-color: var(--error-bg);
           border-color: var(--error-color);
           color: #c0392b;
           opacity: 0.8;
       }


       .option-btn:disabled {
           cursor: default;
       }


       /* Feedback Box */
       .feedback-box {
           margin-top: 20px;
           padding: 20px 25px;
           border-radius: 12px;
           background-color: #f8f9fa;
           color: var(--text-main);
           border: 1px solid #e9ecef;
           display: none;
           animation: fadeIn 0.3s ease;
       }
      
       .feedback-box h3 {
           margin-top: 0;
           font-family: 'Poppins', sans-serif;
           font-size: 1.2rem;
           display: flex;
           align-items: center;
           gap: 8px;
           margin-bottom: 8px;
       }


       .feedback-box.success h3 {
           color: var(--success-color);
       }
      
       .feedback-box.error h3 {
           color: var(--error-color);
       }


       .feedback-box strong {
           color: var(--brand-color);
       }


       @keyframes fadeIn {
           from { opacity: 0; transform: translateY(5px); }
           to { opacity: 1; transform: translateY(0); }
       }


       /* Progress Bar Styles */
       .progress-bar-container {
           height: 6px;
           background-color: #f1f3f5;
           width: 100%;
           position: relative;
           z-index: 10;
       }


       .progress-bar {
           height: 100%;
           background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
           width: 0%;
           transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
           border-radius: 0 4px 4px 0;
           box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
       }


       /* Summary Styles */
       .summary-stats {
           text-align: center;
           background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
           border: 1px solid #dee2e6;
           padding: 30px 20px;
           border-radius: 12px;
           margin-bottom: 20px;
       }


       .summary-score {
           font-size: 3.5rem;
           font-family: 'Poppins', sans-serif;
           font-weight: 700;
           display: block;
           margin: 5px 0;
           line-height: 1;
           background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
           -webkit-background-clip: text;
           -webkit-text-fill-color: transparent;
       }
      
       .summary-list {
           max-height: 400px;
           overflow-y: auto;
           padding-right: 10px;
       }
      
       .summary-item {
           background: white;
           border-bottom: 1px solid #f1f1f1;
           padding: 12px 0;
       }
      
       .summary-item:last-child {
           border-bottom: none;
       }


       .summary-question {
           font-weight: 600;
           margin-bottom: 4px;
           display: block;
           font-size: 0.95rem;
       }
      
       .summary-answer-row {
           font-size: 0.9rem;
       }


       .summary-correct-text { color: var(--success-color); font-weight: 600; }
       .summary-wrong-text { color: var(--error-color); text-decoration: line-through; opacity: 0.8;}
       .real-answer { color: var(--success-color); font-weight: 600; margin-left: 5px; }


       /* Helpers */
       strong {
           color: var(--brand-color);
           font-weight: 700;
       }


   </style>
</head>
<body>


<div class="container">
   <header>
       <h1 id="header-title">Fysikquiz: Materia & Värme</h1>
   </header>
   <div class="progress-bar-container">
       <div class="progress-bar" id="progress-bar"></div>
   </div>


   <div class="content-area" id="app">
       <!-- Content will be injected here by JavaScript -->
   </div>
</div>


<script>
   // --- DATA ---
const quizData = [
    {
        title: "Tema 1: Partikelmodellen & Värme",
        icon: "⚛️",
        text: "Allt omkring oss är uppbyggt av atomer, som är naturens byggstenar. Materia är allt som har en massa (vikt). Enligt <strong>partikelmodellen</strong> rör sig dessa små partiklar ständigt. Värme är ett mått på hur mycket partiklarna rör sig; ju högre temperaturen är, desto snabbare rör sig atomerna. När materia värms upp tar partiklarna mer plats eftersom de knuffar på varandra mer, vilket kallas för <strong>värmeutvidgning</strong>.",
        questions: [
            {
                q: "En rispapperslykta fylld med varm luft stiger uppåt. Vilket påstående förklarar bäst varför?",
                options: [
                    "Varm luft har lägre densitet än kall luft.", // Flyttad till index 0
                    "Varm luft har högre densitet än kall luft.",
                    "Partiklarna i varm luft har lägre massa än i kall luft.",
                    "Dragningskraften slutar verka på varm luft."
                ],
                correct: 0,
                explanation: "När luften i lyktan värms upp rör sig partiklarna mer och tar större plats, vilket gör att luften blir <strong>mindre tät</strong> (lägre <strong>densitet</strong>) än den omgivande kalla luften."
            },
            {
                q: "Om du tar ut en tom, stängd PET-flaska i kylan en vinterdag ändrar den form. Varför?",
                options: [
                    "Luften läcker ut genom plasten när det blir kallt.",
                    "Partiklarna i flaskan blir färre till antalet.",
                    "Lufttrycket utanför flaskan minskar i kylan.",
                    "Partiklarna rör sig mindre och tar mindre plats." // Flyttad till index 3
                ],
                correct: 3,
                explanation: "Vid lägre temperatur rör sig luftpartiklarna inne i flaskan <strong>långsammare</strong> och kommer närmare varandra, vilket gör att <strong>volymen minskar</strong>."
            },
            {
                q: "Vad händer med en järnvägsräls av stål en mycket varm sommardag?",
                options: [
                    "Skenornas massa ökar av solenergin.",
                    "Skenornas volym ökar.", // Flyttad till index 1
                    "Skenornas volym minskar.",
                    "Skenornas massa minskar."
                ],
                correct: 1,
                explanation: "När metallen värms upp ökar <strong>partiklarnas rörelse</strong>, vilket gör att materialet <strong>expanderar</strong> och tar upp en större volym."
            }
        ]
    },
    {
        title: "Tema 2: Fasövergångar",
        icon: "💧",
        text: "De flesta ämnen kan förekomma i tre olika faser: <strong>fast</strong>, <strong>flytande</strong> och <strong>gas</strong>. Vilken fas ett ämne befinner sig i styrs av temperaturen och partiklarnas rörelse. När ett ämne byter fas kallas det för en <strong>fasövergång</strong>. Exempelvis kallas det <strong>kondensation</strong> när en gas blir vätska, och <strong>avdunstning</strong> när en vätska blir gas.",
        questions: [
            {
                q: "Efter att du duschat varmt kan det bildas vattendroppar på en kall vattenledning i badrummet. Vad kallas detta fenomen?",
                options: [
                    "Smältning",
                    "Avdunstning",
                    "Stelning",
                    "Kondensation" // Flyttad till index 3
                ],
                correct: 3,
                explanation: "Varm vattenånga <strong>kyls ner</strong> när den träffar den kalla ledningen, vilket gör att vattenmolekylerna går samman till <strong>flytande</strong> droppar."
            },
            {
                q: "Varför torkar en blöt tröja snabbare i solen än i skuggan?",
                options: [
                    "Solen tar bort luftmotståndet runt tröjan.",
                    "Solens strålar gör att vattnet i tröjan fryser och ramlar av.",
                    "Energin från solen får vattenmolekylerna att röra sig snabbare.", // Flyttad till index 2
                    "Vattnet sugs upp av solstrålarna genom strålning."
                ],
                correct: 2,
                explanation: "Energin från solljuset <strong>ökar vattenmolekylernas rörelse</strong> så att de lättare kan lämna tröjan i form av vattenånga (<strong>avdunstning</strong>)."
            },
            {
                q: "Vilket ämne i tabellen nedan är bäst lämpat för en utetermometer i Sverige? (Pentan: -130°C/36°C, Etanol: -117°C/79°C, Glykol: -13°C/197°C)",
                options: [
                    "Etanol, för den är flytande i både sträng kyla och sommarvärme.", // Flyttad till index 0
                    "Glykol, för den har högsta kokpunkten.",
                    "Pentan, för den fryser aldrig.",
                    "Glykol, för den fryser snabbast."
                ],
                correct: 0,
                explanation: "Etanol har en tillräckligt låg <strong>smältpunkt</strong> för att inte frysa på vintern och en tillräckligt hög <strong>kokpunkt</strong> för att inte koka bort en varm sommardag."
            }
        ]
    },
    {
        title: "Tema 3: Densitet & Arkimedes princip",
        icon: "🚤",
        text: "<strong>Densitet</strong> beskriver hur tätt partiklarna i ett ämne är packade (massa per volym). Ett ämne med låg densitet är 'lättare' än ett ämne med hög densitet om de har samma volym. <strong>Arkimedes princip</strong> säger att ett föremål som sänks ner i en vätska påverkas av en <strong>lyftkraft</strong> som är lika stor som tyngden av den vätska som trängs undan.",
        questions: [
            {
                q: "Ett lastfartyg flyter högre i saltvatten än i sötvatten. Vad beror det på?",
                options: [
                    "Salthalten minskar fartygets totala massa.",
                    "Sötvatten trycker hårdare mot fartygets sidor.",
                    "Saltvatten har högre densitet, vilket ger en större lyftkraft.", // Flyttad till index 2
                    "Saltet i vattnet suger fast i fartygets botten."
                ],
                correct: 2,
                explanation: "Saltet gör att vattnet blir <strong>tätare</strong> (högre <strong>densitet</strong>), vilket innebär att den undanträngda vätskan väger mer och ger fartyget en större <strong>lyftkraft</strong>."
            },
            {
                q: "Is flyter på vatten. Vad kan vi då veta om isens densitet?",
                options: [
                    "Is har högre densitet än vatten.",
                    "Is har lägre densitet än vatten.", // Flyttad till index 1
                    "Is har samma densitet som vatten.",
                    "Is saknar helt densitet."
                ],
                correct: 1,
                explanation: "Föremål med <strong>lägre densitet</strong> än den omgivande vätskan flyter."
            },
            {
                q: "Du sänker ner en sten som väger 50 N i en full bägare med vatten. 20 N vatten rinner över. Hur mycket väger stenen när den är under vattnet?",
                options: [
                    "50 N",
                    "20 N",
                    "70 N",
                    "30 N" // Flyttad till index 3
                ],
                correct: 3,
                explanation: "<strong>Lyftkraften</strong> är lika stor som <strong>tyngden</strong> av det undanträngda vattnet (20 N), så stenens tyngd i vattnet blir 50 N - 20 N = 30 N."
            }
        ]
    },
    {
        title: "Tema 4: Tryck i luft och vatten",
        icon: "🎈",
        text: "<strong>Tryck</strong> definieras som kraft fördelad på en yta. Ju mindre ytan är, desto högre blir trycket om kraften är densamma. <strong>Lufttrycket</strong> beror på tyngden av alla luftmolekyler ovanför oss och minskar ju högre upp vi kommer. <strong>Kommunicerande kärl</strong> innebär att vattenytan i sammanhängande kärl alltid hamnar på samma nivå.",
        questions: [
            {
                q: "Varför utvidgas en oöppnad chipspåse när man tar med den högt upp på ett berg?",
                options: [
                    "Luftpartiklarna inne i påsen blir fler.",
                    "Lufttrycket utanför påsen minskar.", // Flyttad till index 1
                    "Temperaturen är alltid mycket högre på bergstoppar.",
                    "Påsen vill suga in mer luft från omgivningen."
                ],
                correct: 1,
                explanation: "Eftersom <strong>lufttrycket</strong> utanför påsen <strong>sjunker</strong> på hög höjd kan de instängda luftpartiklarna inuti påsen pressa ut väggarna mer."
            },
            {
                q: "Varför sjunker man ner mindre i snön om man använder snöskor?",
                options: [
                    "Kroppens tyngd fördelas på en större yta.", // Flyttad till index 0
                    "Snöskorna minskar kroppens tyngd.",
                    "Snöskorna skapar en kemisk reaktion som gör snön hård.",
                    "Snöskorna ökar friktionen mot luften."
                ],
                correct: 0,
                explanation: "Genom att <strong>öka ytan</strong> mot snön sprids kroppens tyngdkraft ut, vilket <strong>minskar trycket</strong> per kvadratcentimeter."
            },
            {
                q: "Åt vilket håll blåser vindar oftast mellan ett högtryck och ett lågtryck?",
                options: [
                    "Från lågtrycket mot högtrycket på grund av värme.",
                    "Vindarna rör sig aldrig mellan tryckområden.",
                    "Från högtrycket mot lågtrycket för att jämna ut trycket.", // Flyttad till index 2
                    "Medurs i en cirkel runt högtrycket utan att flytta på sig."
                ],
                correct: 2,
                explanation: "Luft rör sig från områden med mycket luftpartiklar (<strong>högtryck</strong>) mot områden med färre (<strong>lågtryck</strong>) för att jämna ut skillnaden."
            }
        ]
    },
    {
        title: "Tema 5: Värmespridning",
        icon: "☀️",
        text: "Värme kan spridas på tre sätt: <strong>ledning</strong>, <strong>strömning</strong> och <strong>strålning</strong>. Ledning sker främst i fasta material (metaller leder bäst), strömning sker i vätskor och gaser, och strålning är ljuspartiklar (<strong>fotoner</strong>). Mörka ytor <strong>absorberar</strong> (tar upp) mer strålningsvärme än ljusa ytor, som istället <strong>reflekterar</strong> bort den.",
        questions: [
            {
                q: "Varför bränner man sig ofta mer på tomaten än på brödet i en varm smörgås, trots att de varit i ugnen lika länge?",
                options: [
                    "Brödet har en mycket högre temperatur än tomaten.",
                    "Tomaten innehåller mycket vatten som lagrar och leder värme bra.", // Flyttad till index 1
                    "Tomaten drar till sig mer strålning från ugnen.",
                    "Brödet består av metall som svalnar snabbt."
                ],
                correct: 1,
                explanation: "Vatten har god förmåga att <strong>lagra energi</strong> och <strong>leda värme</strong>, medan brödet innehåller mycket luft som fungerar som <strong>isolering</strong>."
            },
            {
                q: "Vilket sätt att sprida värme förklarar varför solen kan värma jorden trots att det är vakuum i rymden?",
                options: [
                    "Ledning",
                    "Strömning",
                    "Strålning", // Flyttad till index 2
                    "Konvektion"
                ],
                correct: 2,
                explanation: "<strong>Värmestrålning</strong> (elektromagnetisk strålning) behöver inget material för att sprida sig."
            },
            {
                q: "Varför är det bättre att ha en vit tröja än en svart tröja om man vill hålla sig sval en solig dag?",
                options: [
                    "Vita ytor reflekterar bort mer värmestrålning.", // Flyttad till index 0
                    "Svarta ytor leder bort värme snabbare från kroppen.",
                    "Vita ytor har högre densitet och släpper igenom vind.",
                    "Svarta ytor skapar kyla genom kondensation."
                ],
                correct: 0,
                explanation: "Ljusa färger <strong>absorberar</strong> mindre <strong>strålningsenergi</strong> från solen och <strong>reflekterar</strong> istället bort den."
            },
            {
                q: "I ett strykjärn finns en bimetall som fungerar som strömbrytare. Hur fungerar den?",
                options: [
                    "Den ena metallen leder ström bättre än den andra.",
                    "Metallerna utvidgar sig olika mycket vid värme så att skenan böjs.", // Flyttad till index 1
                    "Den ena metallen smälter vid en viss temperatur.",
                    "Metallerna dras till varandra som magneter när det blir varmt."
                ],
                correct: 1,
                explanation: "En <strong>bimetall</strong> består av två olika metaller som <strong>expanderar</strong> olika snabbt vid uppvärmning, vilket tvingar skenan att böja sig."
            }
        ]
    }
];


   // --- STATE MANAGEMENT ---
   let currentSectionIndex = 0;
   let currentQuestionIndex = 0; // Relative to current section
   let score = 0;
   let userAnswers = [];
   let state = 'intro'; // 'intro', 'question', 'summary'


   // --- DOM ELEMENTS ---
   const app = document.getElementById('app');
   const headerTitle = document.getElementById('header-title');
   const progressBar = document.getElementById('progress-bar');


   // --- MAIN RENDER FUNCTION ---
   function render() {
       if (state === 'summary') {
           renderSummary();
           return;
       }


       const section = quizData[currentSectionIndex];


       // Update Header with smooth fade
       headerTitle.style.opacity = '0';
       setTimeout(() => {
           headerTitle.innerText = section.title;
           headerTitle.style.transition = 'opacity 0.2s';
           headerTitle.style.opacity = '1';
       }, 150);


       // Calculate total progress
       let totalQuestions = 0;
       let answeredQuestions = 0;
      
       quizData.forEach((sec, idx) => {
           totalQuestions += sec.questions.length;
           if (idx < currentSectionIndex) {
               answeredQuestions += sec.questions.length;
           } else if (idx === currentSectionIndex && state === 'question') {
               answeredQuestions += currentQuestionIndex;
           }
       });
       const pct = (answeredQuestions / totalQuestions) * 100;
       progressBar.style.width = `${pct}%`;


       if (state === 'intro') {
           renderSectionIntro(section);
       } else if (state === 'question') {
           renderQuestion(section.questions[currentQuestionIndex]);
       }
   }


   // --- RENDER SECTION TEXT ---
   function renderSectionIntro(section) {
       // Simple animation class reset
       app.classList.remove('fade-in');
       void app.offsetWidth; // trigger reflow
       app.classList.add('fade-in');


       app.innerHTML = `
           <div class="fact-box">
               <span class="fact-icon">${section.icon}</span>
               <div class="fact-content">
                   <h2>Fakta</h2>
                   <p style="line-height: 1.6; font-size: 1rem; margin-top:0;">${section.text}</p>
               </div>
           </div>
           <button class="btn" onclick="startQuestions()">Starta frågor för denna del</button>
       `;
   }


   // --- RENDER QUESTION ---
   function renderQuestion(q) {
       const totalInCurrent = quizData[currentSectionIndex].questions.length;
      
       // Render with reset styles for feedback box
       app.innerHTML = `
           <div class="question-meta">Del ${currentSectionIndex + 1} • Fråga ${currentQuestionIndex + 1}/${totalInCurrent}</div>
           <h2 style="color: #2c3e50; font-weight: 600; margin-bottom:15px;">${q.q}</h2>
           <div class="options-grid">
               ${q.options.map((opt, idx) => `
                   <button class="option-btn" onclick="handleAnswer(${idx})" id="opt-${idx}">${opt}</button>
               `).join('')}
           </div>
           <div id="feedback" class="feedback-box">
               <h3 id="feedback-title"></h3>
               <p id="feedback-text" style="margin: 5px 0 15px 0; font-size: 0.95rem; line-height: 1.6;"></p>
               <button class="btn" id="next-btn" onclick="nextStep()" style="margin-top:0; width: auto; min-width: 150px;">Nästa fråga ➔</button>
           </div>
       `;
   }


   // --- RENDER SUMMARY ---
   function renderSummary() {
       headerTitle.innerText = "Sammanfattning";
       progressBar.style.width = '100%';
      
       let totalQ = 0;
       quizData.forEach(s => totalQ += s.questions.length);
      
       // Calculate score
       let correctCount = userAnswers.filter(a => a.isCorrect).length;
       let pct = Math.round((correctCount / totalQ) * 100);
      
       let gradeTitle = "";
      
       if(pct > 90) { gradeTitle = "Fantastiskt bra! 🏆"; }
       else if(pct > 70) { gradeTitle = "Mycket bra jobbat! 🌟"; }
       else if(pct > 50) { gradeTitle = "Godkänt! 👍"; }
       else { gradeTitle = "Fortsätt kämpa! 💪"; }


       let html = `
           <div class="summary-stats">
               <h2 style="color:var(--brand-color); margin:0 0 10px 0;">${gradeTitle}</h2>
               <span class="summary-score">${correctCount}/${totalQ}</span>
               <span style="color:#666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Rätt svar</span>
               <button class="btn" onclick="location.reload()" style="background: transparent; border: 2px solid var(--accent-color); color: var(--accent-color); margin-top: 20px; box-shadow:none; width: auto; padding: 10px 30px;">Gör om testet</button>
           </div>
           <h3 style="margin: 0 0 10px 0; font-size: 1.1rem; color: var(--text-muted);">Dina svar:</h3>
           <div class="summary-list">
       `;


       userAnswers.forEach((ans, idx) => {
           const isCorrect = ans.isCorrect;
          
           html += `
               <div class="summary-item">
                   <span class="summary-question">${idx + 1}. ${ans.question}</span>
                   <div class="summary-answer-row">
                       ${isCorrect
                           ? `<span class="summary-correct-text">✔ ${ans.userAnswer}</span>`
                           : `<span class="summary-wrong-text">✖ ${ans.userAnswer}</span> <span style="margin: 0 5px; color:#999;">➔</span> <span class="real-answer">${ans.correctAnswer}</span>`
                       }
                   </div>
               </div>
           `;
       });


       html += `</div>`;
       app.innerHTML = html;
   }


   // --- LOGIC FUNCTIONS ---
   window.startQuestions = function() {
       state = 'question';
       currentQuestionIndex = 0;
       render();
   };


   window.handleAnswer = function(selectedIndex) {
       // Disable all buttons
       const buttons = document.querySelectorAll('.option-btn');
       buttons.forEach(b => b.disabled = true);


       const section = quizData[currentSectionIndex];
       const currentQ = section.questions[currentQuestionIndex];
       const isCorrect = selectedIndex === currentQ.correct;


       // Visual feedback on buttons
       const selectedBtn = document.getElementById(`opt-${selectedIndex}`);
       const correctBtn = document.getElementById(`opt-${currentQ.correct}`);


       if (isCorrect) {
           selectedBtn.classList.add('correct');
       } else {
           selectedBtn.classList.add('incorrect');
           correctBtn.classList.add('correct'); // Show which one was right
       }


       // Show feedback box
       const feedbackBox = document.getElementById('feedback');
       const feedbackTitle = document.getElementById('feedback-title');
       const feedbackText = document.getElementById('feedback-text');
       const nextBtn = document.getElementById('next-btn');


       feedbackBox.style.display = 'block';
      
       // Add class for success/error styling
       if (isCorrect) {
           feedbackBox.className = "feedback-box success";
           feedbackTitle.innerHTML = "Rätt svar!";
       } else {
           feedbackBox.className = "feedback-box error";
           feedbackTitle.innerHTML = "Inte riktigt...";
       }
      
       feedbackText.innerHTML = currentQ.explanation; // Use innerHTML to render <strong> tags


       // Check if last question of entire quiz
       const isLastQuestionOverall = (currentSectionIndex === quizData.length - 1) && (currentQuestionIndex === section.questions.length - 1);
      
       if(isLastQuestionOverall) {
           nextBtn.innerText = "Se resultat 🏁";
       } else if (currentQuestionIndex === section.questions.length - 1) {
           nextBtn.innerText = "Nästa del ➔";
       }


       // Scroll to feedback if needed on mobile, but gently
       const rect = feedbackBox.getBoundingClientRect();
       const isVisible = (rect.top >= 0) && (rect.bottom <= window.innerHeight);
       if (!isVisible) {
            setTimeout(() => {
               feedbackBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
           }, 100);
       }


       // Save data
       userAnswers.push({
           question: currentQ.q,
           userAnswer: currentQ.options[selectedIndex],
           correctAnswer: currentQ.options[currentQ.correct],
           isCorrect: isCorrect
       });
   };


   window.nextStep = function() {
       const section = quizData[currentSectionIndex];
      
       // Reset feedback styles for next render
       const feedbackBox = document.getElementById('feedback');
       if(feedbackBox) {
           feedbackBox.style.display = 'none';
       }


       // Check if there are more questions in this section
       if (currentQuestionIndex < section.questions.length - 1) {
           currentQuestionIndex++;
           render();
       } else {
           // End of section, move to next section
           if (currentSectionIndex < quizData.length - 1) {
               currentSectionIndex++;
               state = 'intro';
               render();
           } else {
               // End of quiz
               state = 'summary';
               render();
           }
       }
   };


   // --- INIT ---
   render();


</script>


</body>
</html>
