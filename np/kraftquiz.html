<!DOCTYPE html>
<html lang="sv">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Fysikquiz: Krafter & Rörelse (Åk 9)</title>
   <!-- Importerar moderna fonter från Google Fonts -->
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  
   <style>
       :root {
           /* Färgpalett - Professionell & Ren */
           --card-bg: #ffffff;
          
           --brand-color: #2c3e50;
           --brand-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
          
           --accent-color: #3498db;
          
           --success-color: #10ac84;
           --success-bg: #e3f9f1;
          
           --error-color: #ee5253;
           --error-bg: #ffeded;
          
           --text-main: #2d3436;
           --text-muted: #636e72;
          
           --shadow-card: 0 10px 25px rgba(0,0,0,0.15);
           --shadow-hover: 0 6px 16px rgba(0,0,0,0.12);
           --radius-main: 16px;
       }


       body {
           font-family: 'Open Sans', sans-serif;
           /* Gråaktig fade (Silver/Metallic style) */
           background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
           color: var(--text-main);
           margin: 0;
           padding: 15px;
           display: flex;
           justify-content: center;
           align-items: flex-start;
           min-height: 100vh;
       }


       .container {
           background-color: var(--card-bg);
           width: 100%;
           max-width: 680px;
           border-radius: var(--radius-main);
           box-shadow: var(--shadow-card);
           overflow: hidden;
           display: flex;
           flex-direction: column;
           position: relative;
           margin-top: 3vh;
           margin-bottom: 3vh;
       }


       header {
           background: var(--brand-gradient);
           color: white;
           padding: 20px;
           text-align: center;
           position: relative;
           overflow: hidden;
       }


       h1 {
           font-family: 'Poppins', sans-serif;
           margin: 0;
           font-size: 1.5rem;
           font-weight: 700;
           letter-spacing: -0.3px;
       }


       .content-area {
           padding: 25px 30px;
           flex-grow: 1;
       }


       h2 {
           font-family: 'Poppins', sans-serif;
           color: var(--brand-color);
           margin-top: 0;
           font-size: 1.3rem;
           margin-bottom: 0.8rem;
           line-height: 1.3;
       }


       /* Fact Section Styles */
       .fact-box {
           background: #f8f9fa;
           border-radius: 12px;
           padding: 20px;
           margin-bottom: 20px;
           /* Ingen border-left */
           display: flex;
           gap: 15px;
           align-items: flex-start;
       }
      
       .fact-icon {
           font-size: 2rem;
           display: block;
           margin-top: -5px;
       }
      
       .fact-content {
           flex: 1;
       }


       .btn {
           background: var(--brand-gradient);
           color: white;
           border: none;
           padding: 12px 24px;
           font-family: 'Poppins', sans-serif;
           font-size: 1rem;
           font-weight: 600;
           border-radius: 8px;
           cursor: pointer;
           transition: all 0.2s ease;
           display: block;
           width: 100%;
           margin-top: 20px;
           box-shadow: 0 4px 10px rgba(52, 152, 219, 0.2);
       }


       .btn:hover {
           transform: translateY(-2px);
           box-shadow: 0 6px 14px rgba(52, 152, 219, 0.3);
           opacity: 0.95;
       }


       /* Question Styles */
       .question-meta {
           display: inline-block;
           color: var(--text-muted);
           font-size: 0.85rem;
           margin-bottom: 10px;
           font-weight: 600;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }


       .options-grid {
           display: grid;
           gap: 12px;
           margin-top: 20px;
       }


       .option-btn {
           background-color: #fff;
           border: 2px solid #f1f2f6;
           padding: 15px 20px;
           text-align: left;
           border-radius: 10px;
           cursor: pointer;
           font-family: 'Open Sans', sans-serif;
           font-size: 0.95rem;
           font-weight: 500;
           transition: all 0.15s ease;
           color: var(--text-main);
           position: relative;
       }


       .option-btn:hover:not(:disabled) {
           border-color: var(--accent-color);
           background-color: #f8fcff;
           transform: translateX(3px);
           box-shadow: 0 2px 5px rgba(0,0,0,0.05);
       }
      
       /* Status states for options */
       .option-btn.correct {
           background-color: var(--success-bg);
           border-color: var(--success-color);
           color: #0b6e4f;
           font-weight: 600;
       }
      
       .option-btn.correct::after {
           content: "✓";
           position: absolute;
           right: 15px;
           font-weight: bold;
       }


       .option-btn.incorrect {
           background-color: var(--error-bg);
           border-color: var(--error-color);
           color: #c0392b;
           opacity: 0.8;
       }


       .option-btn:disabled {
           cursor: default;
       }


       /* Feedback Box */
       .feedback-box {
           margin-top: 20px;
           padding: 20px 25px;
           border-radius: 12px;
           background-color: #f8f9fa;
           color: var(--text-main);
           border: 1px solid #e9ecef;
           display: none;
           animation: fadeIn 0.3s ease;
       }
      
       .feedback-box h3 {
           margin-top: 0;
           font-family: 'Poppins', sans-serif;
           font-size: 1.2rem;
           display: flex;
           align-items: center;
           gap: 8px;
           margin-bottom: 8px;
       }


       .feedback-box.success h3 {
           color: var(--success-color);
       }
      
       .feedback-box.error h3 {
           color: var(--error-color);
       }


       .feedback-box strong {
           color: var(--brand-color);
       }


       @keyframes fadeIn {
           from { opacity: 0; transform: translateY(5px); }
           to { opacity: 1; transform: translateY(0); }
       }


       /* Progress Bar Styles */
       .progress-bar-container {
           height: 6px;
           background-color: #f1f3f5;
           width: 100%;
           position: relative;
           z-index: 10;
       }


       .progress-bar {
           height: 100%;
           background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
           width: 0%;
           transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
           border-radius: 0 4px 4px 0;
           box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
       }


       /* Summary Styles */
       .summary-stats {
           text-align: center;
           background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
           border: 1px solid #dee2e6;
           padding: 30px 20px;
           border-radius: 12px;
           margin-bottom: 20px;
       }


       .summary-score {
           font-size: 3.5rem;
           font-family: 'Poppins', sans-serif;
           font-weight: 700;
           display: block;
           margin: 5px 0;
           line-height: 1;
           background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
           -webkit-background-clip: text;
           -webkit-text-fill-color: transparent;
       }
      
       .summary-list {
           max-height: 400px;
           overflow-y: auto;
           padding-right: 10px;
       }
      
       .summary-item {
           background: white;
           border-bottom: 1px solid #f1f1f1;
           padding: 12px 0;
       }
      
       .summary-item:last-child {
           border-bottom: none;
       }


       .summary-question {
           font-weight: 600;
           margin-bottom: 4px;
           display: block;
           font-size: 0.95rem;
       }
      
       .summary-answer-row {
           font-size: 0.9rem;
       }


       .summary-correct-text { color: var(--success-color); font-weight: 600; }
       .summary-wrong-text { color: var(--error-color); text-decoration: line-through; opacity: 0.8;}
       .real-answer { color: var(--success-color); font-weight: 600; margin-left: 5px; }


       /* Helpers */
       strong {
           color: var(--brand-color);
           font-weight: 700;
       }


   </style>
</head>
<body>


<div class="container">
   <header>
       <h1 id="header-title">Fysikquiz: Krafter & Rörelse</h1>
   </header>
   <div class="progress-bar-container">
       <div class="progress-bar" id="progress-bar"></div>
   </div>


   <div class="content-area" id="app">
       <!-- Content will be injected here by JavaScript -->
   </div>
</div>


<script>
   // --- DATA ---
   const quizData = [
       {
           title: "Block 1: Kraft och Tyngdkraft",
           icon: "🍏",
           text: "<strong>Kraft</strong> är ett centralt begrepp inom fysiken som beskriver något som sätter föremål i rörelse eller ändrar deras form, och mäts i enheten <strong>Newton (N)</strong>. <strong>Tyngdkraft</strong> (gravitation) påverkar alla föremål och är riktad mot jordens mittpunkt. <strong>Tyngd</strong> beror på både föremålets <strong>massa</strong> och tyngdkraften, till skillnad från massa som bara är måttet på materian. Månens tyngdkraft är endast en sjättedel av Jordens.",
           questions: [
               {
                   q: "Vilken enhet används för att mäta kraft?",
                   options: [
                       "Pascal (Pa)",
                       "Joule (J)",
                       "Newton (N)", // Rätt (Index 2)
                       "Watt (W)"
                   ],
                   correct: 2,
                   explanation: "Kraft mäts i enheten <strong>Newton (N)</strong>, uppkallad efter Isaac Newton. Joule är enheten för energi och Watt för effekt, så de mäter andra fysikaliska storheter."
               },
               {
                   q: "Vad menas egentligen med begreppet Tyngd inom fysiken?",
                   options: [
                       "Det är måttet på hur stor dragningskraften är på ett föremål (Massa × Tyngdacceleration).", // Rätt (Index 0)
                       "Det är exakt samma sak som massa och mäts alltid i kilogram.",
                       "Det är ett mått på ett föremåls inneboende tröghet vid rörelseförändring.",
                       "Det är den kraft som krävs för att lyfta föremålet 1 meter rakt upp."
                   ],
                   correct: 0,
                   explanation: "<strong>Tyngd</strong> är en kraft som uppstår genom att gravitationen drar i ett föremåls massa. Den varierar beroende på var i universum du befinner dig (t.ex. på månen), till skillnad från massan som alltid är konstant."
               },
               {
                   q: "Hur förhåller sig Tyngdkraften på Månen till Tyngdkraften på Jorden?",
                   options: [
                       "Månens tyngdkraft är noll eftersom den helt saknar atmosfär.",
                       "Den är ungefär hälften så stor som Jordens tyngdkraft.",
                       "Den är lika stor, men känns mindre på grund av månens rotation.",
                       "Den är ungefär en sjättedel av Jordens tyngdkraft." // Rätt (Index 3)
                   ],
                   correct: 3,
                   explanation: "Eftersom Månen har mycket mindre massa än Jorden är dess dragningskraft svagare. Det gör att du skulle väga ungefär <strong>en sjättedel</strong> så mycket på Månen, trots att din massa (kroppens atomer) är densamma."
               }
           ]
       },
       {
           title: "Block 2: Rörelsebeskrivning",
           icon: "🏎️",
           text: "<strong>Likformig rörelse</strong> definieras som en rörelse i konstant hastighet. <strong>Hastighet</strong> beskriver både fart och riktning, och medelhastigheten beräknas som sträckan delat med tiden (v=s/t). <strong>Olikformig rörelse</strong> sker när farten ändras, alltså vid <strong>acceleration</strong> eller retardation. Vid fritt fall ökar hastigheten på grund av <strong>tyngdaccelerationen</strong> (g ≈ 10m/s²).",
           questions: [
               {
                   q: "Vad krävs för att en rörelse ska klassas som Likformig rörelse?",
                   options: [
                       "Att föremålet accelererar konstant i en rät linje framåt.",
                       "Att föremålet rör sig med konstant hastighet och riktning.", // Rätt (Index 1)
                       "Att föremålet rör sig fram och tillbaka i en jämn pendelrörelse.",
                       "Att föremålet minskar sin hastighet likformigt tills det stannar."
                   ],
                   correct: 1,
                   explanation: "En <strong>likformig rörelse</strong> innebär att hastigheten är konstant, vilket betyder att både farten och riktningen är oförändrad. Om farten eller riktningen ändras räknas det som en accelererad rörelse."
               },
               {
                   q: "Vad kallas den specifika hastighetsökning som sker vid ett fritt fall?",
                   options: [
                       "Tyngdacceleration.", // Rätt (Index 0)
                       "Centripetalacceleration.",
                       "Retardationskraft.",
                       "Konstant hastighetsökning (saknar specifik term)."
                   ],
                   correct: 0,
                   explanation: "När något faller fritt (bortsett från luftmotstånd) ökar hastigheten konstant på grund av Jordens dragningskraft. Denna acceleration kallas för <strong>tyngdacceleration</strong> och ligger på ca 9,8 m/s² i Sverige."
               },
               {
                   q: "Hur beräknar man matematiskt medelhastigheten (v)?",
                   options: [
                       "Hastighet = Sträcka × Tid (v = s · t)",
                       "Hastighet = Kraft / Massa (v = F / m)",
                       "Hastighet = Sträcka / Tid (v = s / t)", // Rätt (Index 2)
                       "Hastighet = Tid / Sträcka (v = t / s)"
                   ],
                   correct: 2,
                   explanation: "För att räkna ut medelhastigheten delar du den totala <strong>sträckan</strong> med den <strong>tid</strong> det tog att färdas den. Formeln skrivs ofta som v = s / t."
               }
           ]
       },
       {
           title: "Block 3: Newtons Lagar",
           icon: "⚖️",
           text: "<strong>Newtons första lag</strong> (Tröghetslagen) säger att en kropp förblir i vila eller likformig rörelse om summan av alla krafter (<strong>resultanten</strong>) är noll. En kraft krävs alltid för att ändra hastighet eller riktning. <strong>Newtons tredje lag</strong> (Lagen om reaktion och motreaktion) säger att två kroppar alltid påverkar varandra med lika stora men motriktade krafter.",
           questions: [
               {
                   q: "Vad måste gälla enligt Tröghetslagen för att ett föremål ska fortsätta vara i vila?",
                   options: [
                       "Resultantkraften måste vara större än friktionskraften.",
                       "Tyngdkraften måste vara noll (viktlöst tillstånd).",
                       "Normalkraften måste vara betydligt större än tyngdkraften.",
                       "Resultanten av alla krafter som verkar på föremålet måste vara noll." // Rätt (Index 3)
                   ],
                   correct: 3,
                   explanation: "Newtons första lag (Tröghetslagen) säger att ett föremål förblir i vila eller likformig rörelse om krafterna tar ut varandra. Det betyder att <strong>resultantkraften</strong> (summan av krafterna) måste vara noll."
               },
               {
                   q: "Vad är en 'resultant' inom fysiken?",
                   options: [
                       "Den kraft som återstår när friktionen räknats bort.",
                       "Summan av alla krafter som verkar på ett föremål.", // Rätt (Index 1)
                       "Motkraften till tyngdkraften vid fritt fall.",
                       "Den kraft som krävs för att lyfta ett föremål från marken."
                   ],
                   correct: 1,
                   explanation: "En <strong>resultant</strong> är den gemensamma kraften man får om man lägger ihop (adderar) alla enskilda krafter som påverkar ett föremål. Den avgör åt vilket håll och hur snabbt föremålet accelererar."
               },
               {
                   q: "Vilken lag förklarar varför Jorden drar i en boll och bollen drar lika mycket tillbaka i Jorden?",
                   options: [
                       "Tröghetslagen (Newtons första lag).",
                       "Accelerationslagen (Newtons andra lag).",
                       "Lagen om verkan och motverkan (Newtons tredje lag).", // Rätt (Index 2)
                       "Gravitationslagen (Newtons fjärde lag)."
                   ],
                   correct: 2,
                   explanation: "<strong>Newtons tredje lag</strong> förklarar att krafter alltid uppträder i par. Om Jorden drar i bollen (verkan), drar bollen lika mycket tillbaka i Jorden (motverkan/reaktion), fast åt motsatt håll."
               }
           ]
       },
       {
           title: "Block 4: Friktion och Normalkraft",
           icon: "🛑",
           text: "<strong>Friktionskraft</strong> är ett motstånd som uppstår när ytor dras mot varandra. Det är nödvändigt för att kunna gå eller köra bil. <strong>Normalkraften</strong> är den kraft som trycker uppåt från ett underlag och motverkar tyngdkraften; den är alltid vinkelrät mot ytan. Ett föremåls <strong>stabilitet</strong> beror på storleken på dess <strong>stödyta</strong> och var <strong>tyngdpunkten</strong> är placerad.",
           questions: [
               {
                   q: "Vilken är en av friktionskraftens viktigaste funktioner i vår vardag?",
                   options: [
                       "Att ge oss fäste så att vi kan gå eller köra bil framåt.", // Rätt (Index 0)
                       "Att minska luftmotståndet vid höga hastigheter.",
                       "Att öka tyngdkraften så att vi inte svävar iväg från marken.",
                       "Att omvandla rörelseenergi till lägesenergi i uppförsbackar."
                   ],
                   correct: 0,
                   explanation: "Utan <strong>friktion</strong> mellan skosulan och marken skulle foten bara glida bakåt när du försöker ta ett steg, precis som på hal is. Friktionen är alltså nödvändig för att skapa rörelse framåt."
               },
               {
                   q: "Vad är kännetecknande för en Normalkraft?",
                   options: [
                       "Det är tyngdkraftens motsats som alltid drar föremål nedåt.",
                       "Det är en kontaktkraft vinkelrätt från underlaget som bär upp föremålet.", // Rätt (Index 1)
                       "Det är en kraft som verkar parallellt med ytan och bromsar rörelse.",
                       "Det är den kraft som uppstår vid luftmotstånd i höga hastigheter."
                   ],
                   correct: 1,
                   explanation: "<strong>Normalkraften</strong> är den kraft som golvet, stolen eller bordet trycker tillbaka med. Den är alltid vinkelrät mot ytan och hindrar föremål från att falla rakt igenom underlaget."
               },
               {
                   q: "Vilken kombination ger bäst stabilitet (svårast att välta)?",
                   options: [
                       "Hög tyngdpunkt och liten stödyta.",
                       "Hög tyngdpunkt och stor stödyta.",
                       "Låg tyngdpunkt och liten stödyta.",
                       "Låg tyngdpunkt och stor stödyta." // Rätt (Index 3)
                   ],
                   correct: 3,
                   explanation: "Ett föremål välter inte så länge lodlinjen från tyngdpunkten faller innanför stödytan. Med en <strong>låg tyngdpunkt</strong> och <strong>stor stödyta</strong> blir det mycket svårare för lodlinjen att hamna utanför, vilket ger maximal stabilitet."
               }
           ]
       },
       {
           title: "Block 5: Arbete och Energi",
           icon: "🏗️",
           text: "<strong>Fysikaliskt arbete</strong> utförs när en kraft flyttar ett föremål en sträcka (Arbete = Kraft · Sträcka). Enheten är <strong>Newtonmeter (Nm)</strong> eller <strong>Joule (J)</strong>. Att bara hålla något stilla är inte arbete i fysikalisk mening. <strong>Lägesenergi</strong> (potentiell energi) beror på höjden, medan <strong>rörelseenergi</strong> finns hos allt som rör sig.",
           questions: [
               {
                   q: "Vilket av följande alternativ räknas som ett 'fysikaliskt arbete'?",
                   options: [
                       "Du bär en tung väska stillastående i 10 minuter medan du väntar på bussen.",
                       "Du försöker putta på en bergvägg som inte rör sig ur fläcken.",
                       "Du knuffar en tung låda framåt på golvet en viss sträcka.", // Rätt (Index 2)
                       "Du tänker intensivt på hur du ska lösa ett svårt fysikproblem."
                   ],
                   correct: 2,
                   explanation: "Fysikaliskt arbete definieras som <strong>Kraft × Sträcka</strong>. Om föremålet inte rör sig (sträckan är noll), eller om kraften inte verkar i rörelseriktningen (som när man bär väskan vågrätt men lyfter lodrätt), utförs inget fysikaliskt arbete."
               },
               {
                   q: "Vad är Lägesenergi för typ av energi?",
                   options: [
                       "Det är lagrad energi beroende på föremålets höjd (potentiell energi).", // Rätt (Index 0)
                       "Det är energin ett föremål har på grund av sin hastighet.",
                       "Det är energin som frigörs när två ytor gnids mot varandra.",
                       "Det är energin som finns lagrad i atomernas kemiska bindningar."
                   ],
                   correct: 0,
                   explanation: "<strong>Lägesenergi</strong> (potentiell energi) är den energi ett föremål har tack vare sin position i ett kraftfält, till exempel högt upp i luften. Om föremålet släpps omvandlas denna energi till rörelseenergi."
               },
               {
                   q: "Vilken enhet används för att mäta både Fysikaliskt arbete och Energi?",
                   options: [
                       "Watt (W)",
                       "Joule (J)", // Rätt (Index 1)
                       "Newton (N)",
                       "Ampere (A)"
                   ],
                   correct: 1,
                   explanation: "Både fysikaliskt arbete och energi mäts i enheten <strong>Joule (J)</strong>. En Joule motsvarar arbetet som utförs när kraften 1 Newton flyttar ett föremål 1 meter (1 J = 1 Nm)."
               }
           ]
       },
       {
           title: "Block 6: Enkla Maskiner",
           icon: "🔧",
           text: "<strong>Enkla maskiner</strong> (t.ex. hävstång, lutande plan) ändrar kraftens riktning eller storlek. <strong>Mekanikens gyllene lag</strong> säger: 'Det du vinner i kraft förlorar du i väg'. I en <strong>hävstång</strong> avgör avståndet till <strong>vridningspunkten</strong> hur stor kraft som behövs; längre hävarm ger mer kraft.",
           questions: [
               {
                   q: "Vad innebär 'Mekanikens gyllene lag'?",
                   options: [
                       "Att kraft och motkraft alltid är lika stora vid jämvikt.",
                       "Att energi inte kan skapas eller förstöras, bara omvandlas.",
                       "Att ju tyngre ett föremål är, desto snabbare faller det mot marken.",
                       "Att det man vinner i kraft förlorar man i väg." // Rätt (Index 3)
                   ],
                   correct: 3,
                   explanation: "Denna gamla minnesregel beskriver hur enkla maskiner fungerar. Om du använder ett lutande plan för att rulla upp en tung tunna behöver du använda mindre kraft än om du lyft den, men du måste putta tunnan en längre sträcka."
               },
               {
                   q: "Två personer gungar gungbräda. En väger dubbelt så mycket som den andra. Var ska den tunga personen sitta för att det ska väga jämnt?",
                   options: [
                       "Längst ut på kanten för att få maximal kraft.",
                       "På exakt samma avstånd från mitten som den lätta personen.",
                       "Närmare mitten (vridningspunkten) än den lätta personen.", // Rätt (Index 2)
                       "Det går inte att balansera om de väger olika mycket."
                   ],
                   correct: 2,
                   explanation: "För att vridmomenten ska ta ut varandra (balans) måste Kraft × Hävarm vara lika på båda sidor. Eftersom den tyngre personen har mer kraft (tyngd), måste deras hävarm vara kortare (dvs. de måste sitta närmare mitten)."
               },
               {
                   q: "Vilket av följande är ett exempel på en 'enkel maskin'?",
                   options: [
                       "Lutande planet.", // Rätt (Index 0)
                       "Förbränningsmotor.",
                       "Transistor.",
                       "Mikrovågsugn."
                   ],
                   correct: 0,
                   explanation: "Det lutande planet är en av de klassiska enkla maskinerna som används för att minska kraftbehovet vid lyft. De andra alternativen är sammansatta eller elektriska maskiner som är mycket mer komplexa."
               }
           ]
       }
   ];


   // --- STATE MANAGEMENT ---
   let currentSectionIndex = 0;
   let currentQuestionIndex = 0; // Relative to current section
   let score = 0;
   let userAnswers = [];
   let state = 'intro'; // 'intro', 'question', 'summary'


   // --- DOM ELEMENTS ---
   const app = document.getElementById('app');
   const headerTitle = document.getElementById('header-title');
   const progressBar = document.getElementById('progress-bar');


   // --- MAIN RENDER FUNCTION ---
   function render() {
       if (state === 'summary') {
           renderSummary();
           return;
       }


       const section = quizData[currentSectionIndex];


       // Update Header with smooth fade
       headerTitle.style.opacity = '0';
       setTimeout(() => {
           headerTitle.innerText = section.title;
           headerTitle.style.transition = 'opacity 0.2s';
           headerTitle.style.opacity = '1';
       }, 150);


       // Calculate total progress
       let totalQuestions = 0;
       let answeredQuestions = 0;
      
       quizData.forEach((sec, idx) => {
           totalQuestions += sec.questions.length;
           if (idx < currentSectionIndex) {
               answeredQuestions += sec.questions.length;
           } else if (idx === currentSectionIndex && state === 'question') {
               answeredQuestions += currentQuestionIndex;
           }
       });
       const pct = (answeredQuestions / totalQuestions) * 100;
       progressBar.style.width = `${pct}%`;


       if (state === 'intro') {
           renderSectionIntro(section);
       } else if (state === 'question') {
           renderQuestion(section.questions[currentQuestionIndex]);
       }
   }


   // --- RENDER SECTION TEXT ---
   function renderSectionIntro(section) {
       // Simple animation class reset
       app.classList.remove('fade-in');
       void app.offsetWidth; // trigger reflow
       app.classList.add('fade-in');


       app.innerHTML = `
           <div class="fact-box">
               <span class="fact-icon">${section.icon}</span>
               <div class="fact-content">
                   <h2>Fakta</h2>
                   <p style="line-height: 1.6; font-size: 1rem; margin-top:0;">${section.text}</p>
               </div>
           </div>
           <button class="btn" onclick="startQuestions()">Starta frågor för denna del</button>
       `;
   }


   // --- RENDER QUESTION ---
   function renderQuestion(q) {
       const totalInCurrent = quizData[currentSectionIndex].questions.length;
      
       // Render with reset styles for feedback box
       app.innerHTML = `
           <div class="question-meta">Del ${currentSectionIndex + 1} • Fråga ${currentQuestionIndex + 1}/${totalInCurrent}</div>
           <h2 style="color: #2c3e50; font-weight: 600; margin-bottom:15px;">${q.q}</h2>
           <div class="options-grid">
               ${q.options.map((opt, idx) => `
                   <button class="option-btn" onclick="handleAnswer(${idx})" id="opt-${idx}">${opt}</button>
               `).join('')}
           </div>
           <div id="feedback" class="feedback-box">
               <h3 id="feedback-title"></h3>
               <p id="feedback-text" style="margin: 5px 0 15px 0; font-size: 0.95rem; line-height: 1.6;"></p>
               <button class="btn" id="next-btn" onclick="nextStep()" style="margin-top:0; width: auto; min-width: 150px;">Nästa fråga ➔</button>
           </div>
       `;
   }


   // --- RENDER SUMMARY ---
   function renderSummary() {
       headerTitle.innerText = "Sammanfattning";
       progressBar.style.width = '100%';
      
       let totalQ = 0;
       quizData.forEach(s => totalQ += s.questions.length);
      
       // Calculate score
       let correctCount = userAnswers.filter(a => a.isCorrect).length;
       let pct = Math.round((correctCount / totalQ) * 100);
      
       let gradeTitle = "";
      
       if(pct > 90) { gradeTitle = "Fantastiskt bra! 🏆"; }
       else if(pct > 70) { gradeTitle = "Mycket bra jobbat! 🌟"; }
       else if(pct > 50) { gradeTitle = "Godkänt! 👍"; }
       else { gradeTitle = "Fortsätt kämpa! 💪"; }


       let html = `
           <div class="summary-stats">
               <h2 style="color:var(--brand-color); margin:0 0 10px 0;">${gradeTitle}</h2>
               <span class="summary-score">${correctCount}/${totalQ}</span>
               <span style="color:#666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Rätt svar</span>
               <button class="btn" onclick="location.reload()" style="background: transparent; border: 2px solid var(--accent-color); color: var(--accent-color); margin-top: 20px; box-shadow:none; width: auto; padding: 10px 30px;">Gör om testet</button>
           </div>
           <h3 style="margin: 0 0 10px 0; font-size: 1.1rem; color: var(--text-muted);">Dina svar:</h3>
           <div class="summary-list">
       `;


       userAnswers.forEach((ans, idx) => {
           const isCorrect = ans.isCorrect;
          
           html += `
               <div class="summary-item">
                   <span class="summary-question">${idx + 1}. ${ans.question}</span>
                   <div class="summary-answer-row">
                       ${isCorrect
                           ? `<span class="summary-correct-text">✔ ${ans.userAnswer}</span>`
                           : `<span class="summary-wrong-text">✖ ${ans.userAnswer}</span> <span style="margin: 0 5px; color:#999;">➔</span> <span class="real-answer">${ans.correctAnswer}</span>`
                       }
                   </div>
               </div>
           `;
       });


       html += `</div>`;
       app.innerHTML = html;
   }


   // --- LOGIC FUNCTIONS ---
   window.startQuestions = function() {
       state = 'question';
       currentQuestionIndex = 0;
       render();
   };


   window.handleAnswer = function(selectedIndex) {
       // Disable all buttons
       const buttons = document.querySelectorAll('.option-btn');
       buttons.forEach(b => b.disabled = true);


       const section = quizData[currentSectionIndex];
       const currentQ = section.questions[currentQuestionIndex];
       const isCorrect = selectedIndex === currentQ.correct;


       // Visual feedback on buttons
       const selectedBtn = document.getElementById(`opt-${selectedIndex}`);
       const correctBtn = document.getElementById(`opt-${currentQ.correct}`);


       if (isCorrect) {
           selectedBtn.classList.add('correct');
       } else {
           selectedBtn.classList.add('incorrect');
           correctBtn.classList.add('correct'); // Show which one was right
       }


       // Show feedback box
       const feedbackBox = document.getElementById('feedback');
       const feedbackTitle = document.getElementById('feedback-title');
       const feedbackText = document.getElementById('feedback-text');
       const nextBtn = document.getElementById('next-btn');


       feedbackBox.style.display = 'block';
      
       // Add class for success/error styling
       if (isCorrect) {
           feedbackBox.className = "feedback-box success";
           feedbackTitle.innerHTML = "Rätt svar!";
       } else {
           feedbackBox.className = "feedback-box error";
           feedbackTitle.innerHTML = "Inte riktigt...";
       }
      
       feedbackText.innerHTML = currentQ.explanation; // Use innerHTML to render <strong> tags


       // Check if last question of entire quiz
       const isLastQuestionOverall = (currentSectionIndex === quizData.length - 1) && (currentQuestionIndex === section.questions.length - 1);
      
       if(isLastQuestionOverall) {
           nextBtn.innerText = "Se resultat 🏁";
       } else if (currentQuestionIndex === section.questions.length - 1) {
           nextBtn.innerText = "Nästa del ➔";
       }


       // Scroll to feedback if needed on mobile, but gently
       const rect = feedbackBox.getBoundingClientRect();
       const isVisible = (rect.top >= 0) && (rect.bottom <= window.innerHeight);
       if (!isVisible) {
           setTimeout(() => {
               feedbackBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
           }, 100);
       }


       // Save data
       userAnswers.push({
           question: currentQ.q,
           userAnswer: currentQ.options[selectedIndex],
           correctAnswer: currentQ.options[currentQ.correct],
           isCorrect: isCorrect
       });
   };


   window.nextStep = function() {
       const section = quizData[currentSectionIndex];
      
       // Reset feedback styles for next render
       const feedbackBox = document.getElementById('feedback');
       if(feedbackBox) {
           feedbackBox.style.display = 'none';
       }


       // Check if there are more questions in this section
       if (currentQuestionIndex < section.questions.length - 1) {
           currentQuestionIndex++;
           render();
       } else {
           // End of section, move to next section
           if (currentSectionIndex < quizData.length - 1) {
               currentSectionIndex++;
               state = 'intro';
               render();
           } else {
               // End of quiz
               state = 'summary';
               render();
           }
       }
   };


   // --- INIT ---
   render();


</script>


</body>
</html>