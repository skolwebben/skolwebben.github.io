<!DOCTYPE html>
<html lang="sv">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Biologiquiz: Hälsa & Sjukdom (Åk 9)</title>
   <!-- Importerar moderna fonter från Google Fonts -->
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  
   <style>
       :root {
           /* Färgpalett - Rött Tema (Hälsa/Sjukvård) med Komplement */
           --card-bg: #ffffff;
          
           --brand-color: #c62828; /* Djup röd */
           --brand-gradient: linear-gradient(135deg, #c62828 0%, #e53935 100%);
          
           --accent-color: #ef5350; /* Ljusare röd */
          
           /* Komplementfärg: Mörk Gråblå (Slate) - För balans */
           --complement-color: #37474f;


           --success-color: #2e7d32;
           --success-bg: #e8f5e9;
          
           --error-color: #c62828;
           --error-bg: #ffebee;
          
           --text-main: #212121;
           --text-muted: #616161;
          
           --shadow-card: 0 10px 25px rgba(0,0,0,0.1);
           --shadow-hover: 0 6px 16px rgba(0,0,0,0.12);
           --radius-main: 16px;
       }


       body {
           font-family: 'Open Sans', sans-serif;
           /* Neutral bakgrund med varm ton */
           background-image: linear-gradient(135deg, #fafafa 0%, #eceff1 100%);
           color: var(--text-main);
           margin: 0;
           padding: 15px;
           display: flex;
           justify-content: center;
           align-items: flex-start;
           min-height: 100vh;
       }


       .container {
           background-color: var(--card-bg);
           width: 100%;
           max-width: 680px;
           border-radius: var(--radius-main);
           box-shadow: var(--shadow-card);
           overflow: hidden;
           display: flex;
           flex-direction: column;
           position: relative;
           margin-top: 3vh;
           margin-bottom: 3vh;
       }


       header {
           background: var(--brand-gradient);
           color: white;
           padding: 20px;
           text-align: center;
           position: relative;
           overflow: hidden;
       }


       h1 {
           font-family: 'Poppins', sans-serif;
           margin: 0;
           font-size: 1.5rem;
           font-weight: 700;
           letter-spacing: -0.3px;
       }


       .content-area {
           padding: 25px 30px;
           flex-grow: 1;
       }


       h2 {
           font-family: 'Poppins', sans-serif;
           color: var(--text-main);
           margin-top: 0;
           font-size: 1.3rem;
           margin-bottom: 0.8rem;
           line-height: 1.3;
       }


       /* Fact Section Styles */
       .fact-box {
           background: #ffffff;
           border: 1px solid #eeeeee;
           border-radius: 12px;
           padding: 20px;
           margin-bottom: 20px;
           display: flex;
           gap: 15px;
           align-items: flex-start;
           box-shadow: 0 2px 8px rgba(0,0,0,0.03);
       }
      
       .fact-icon {
           font-size: 2rem;
           display: block;
           margin-top: -5px;
           color: var(--complement-color); /* Komplementfärg på ikonen */
       }
      
       .fact-content {
           flex: 1;
       }


       .btn {
           background: var(--brand-gradient);
           color: white;
           border: none;
           padding: 12px 24px;
           font-family: 'Poppins', sans-serif;
           font-size: 1rem;
           font-weight: 600;
           border-radius: 8px;
           cursor: pointer;
           transition: all 0.2s ease;
           display: block;
           width: 100%;
           margin-top: 20px;
           box-shadow: 0 4px 10px rgba(198, 40, 40, 0.2);
       }


       .btn:hover {
           transform: translateY(-2px);
           box-shadow: 0 6px 14px rgba(198, 40, 40, 0.3);
           opacity: 0.95;
       }


       /* Question Styles */
       .question-meta {
           display: inline-block;
           color: var(--complement-color);
           font-size: 0.85rem;
           margin-bottom: 10px;
           font-weight: 700;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }


       .options-grid {
           display: grid;
           gap: 12px;
           margin-top: 20px;
       }


       .option-btn {
           background-color: #fff;
           border: 2px solid #f5f5f5;
           padding: 15px 20px;
           text-align: left;
           border-radius: 10px;
           cursor: pointer;
           font-family: 'Open Sans', sans-serif;
           font-size: 0.95rem;
           font-weight: 500;
           transition: all 0.15s ease;
           color: var(--text-main);
           position: relative;
       }


       .option-btn:hover:not(:disabled) {
           border-color: var(--accent-color);
           background-color: #ffebee;
           transform: translateX(3px);
           box-shadow: 0 2px 5px rgba(0,0,0,0.05);
       }
      
       /* Status states for options */
       .option-btn.correct {
           background-color: var(--success-bg);
           border-color: var(--success-color);
           color: #1b5e20;
           font-weight: 600;
       }
      
       .option-btn.correct::after {
           content: "✓";
           position: absolute;
           right: 15px;
           font-weight: bold;
       }


       .option-btn.incorrect {
           background-color: var(--error-bg);
           border-color: var(--error-color);
           color: #b71c1c;
           opacity: 0.8;
       }


       .option-btn:disabled {
           cursor: default;
       }


       /* Feedback Box */
       .feedback-box {
           margin-top: 20px;
           padding: 20px 25px;
           border-radius: 12px;
           background-color: #f9f9f9;
           color: var(--text-main);
           border: 1px solid #e0e0e0;
           display: none;
           animation: fadeIn 0.3s ease;
       }
      
       .feedback-box h3 {
           margin-top: 0;
           font-family: 'Poppins', sans-serif;
           font-size: 1.2rem;
           display: flex;
           align-items: center;
           gap: 8px;
           margin-bottom: 8px;
       }


       .feedback-box.success h3 {
           color: var(--success-color);
       }
      
       .feedback-box.error h3 {
           color: var(--error-color);
       }


       .feedback-box strong {
           color: #000;
       }


       @keyframes fadeIn {
           from { opacity: 0; transform: translateY(5px); }
           to { opacity: 1; transform: translateY(0); }
       }


       /* Progress Bar Styles */
       .progress-bar-container {
           height: 6px;
           background-color: #eeeeee;
           width: 100%;
           position: relative;
           z-index: 10;
       }


       .progress-bar {
           height: 100%;
           /* Röd gradient */
           background: linear-gradient(90deg, #ef5350 0%, #c62828 100%);
           width: 0%;
           transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
           border-radius: 0 4px 4px 0;
           box-shadow: 0 0 10px rgba(229, 57, 53, 0.5);
       }


       /* Summary Styles */
       .summary-stats {
           text-align: center;
           background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
           border: 1px solid #ef9a9a;
           padding: 30px 20px;
           border-radius: 12px;
           margin-bottom: 20px;
       }


       .summary-score {
           font-size: 3.5rem;
           font-family: 'Poppins', sans-serif;
           font-weight: 700;
           display: block;
           margin: 5px 0;
           line-height: 1;
           background: linear-gradient(135deg, #b71c1c 0%, #e53935 100%);
           -webkit-background-clip: text;
           -webkit-text-fill-color: transparent;
       }
      
       .summary-list {
           max-height: 400px;
           overflow-y: auto;
           padding-right: 10px;
       }
      
       .summary-item {
           background: white;
           border-bottom: 1px solid #eeeeee;
           padding: 12px 0;
       }
      
       .summary-item:last-child {
           border-bottom: none;
       }


       .summary-question {
           font-weight: 600;
           margin-bottom: 4px;
           display: block;
           font-size: 0.95rem;
       }
      
       .summary-answer-row {
           font-size: 0.9rem;
       }


       .summary-correct-text { color: var(--success-color); font-weight: 600; }
       .summary-wrong-text { color: var(--error-color); text-decoration: line-through; opacity: 0.8;}
       .real-answer { color: var(--success-color); font-weight: 600; margin-left: 5px; }


       /* Helpers */
       strong {
           color: #000;
           font-weight: 700;
       }


   </style>
</head>
<body>


<div class="container">
   <header>
       <h1 id="header-title">Biologiquiz: Hälsa & Sjukdom</h1>
   </header>
   <div class="progress-bar-container">
       <div class="progress-bar" id="progress-bar"></div>
   </div>


   <div class="content-area" id="app">
       <!-- Content will be injected here by JavaScript -->
   </div>
</div>


<script>
   // --- DATA ---
   const quizData = [
       {
           title: "Del 1: Infektioner & Smitta",
           icon: "🦠",
           text: "Sjukdomar orsakas ofta av mikroorganismer som <strong>bakterier</strong> eller <strong>virus</strong>. En infektion uppstår när dessa tränger in i kroppen, till exempel genom sår i huden eller via slemhinnor. Smitta sprids ofta genom luften eller via kroppsvätskor. God <strong>handhygien</strong> är ett av de mest effektiva sätten att minska smittspridning.",
           questions: [
               {
                   q: "Vilken typ av organism orsakar de infektioner som behandlas med antibiotika?",
                   options: [
                       "Bakterier",
                       "Virus",
                       "Svampar",
                       "Parasiter"
                   ],
                   correct: 0,
                   explanation: "<strong>Antibiotika</strong> verkar genom att döda eller hämma tillväxten av just <strong>bakterier</strong>, men biter inte på virus."
               },
               {
                   q: "Varför minskade dödligheten på militärsjukhuset när Florence Nightingale införde noggrann handtvätt?",
                   options: [
                       "Patienterna kände sig mer välvårdade och pigga",
                       "Färre smittämnen spreds mellan patienter via händerna",
                       "Tvålen dödade alla virus som fanns i sjukhusluften",
                       "Personalens händer blev varmare vilket gynnade läkning"
                   ],
                   correct: 1,
                   explanation: "<strong>Handtvätt</strong> avlägsnar de mikroorganismer som annars flyttas från en sjuk person till en frisk."
               },
               {
                   q: "Vilket påstående beskriver bäst hur bakterier blir resistenta mot antibiotika?",
                   options: [
                       "Bakterierna lär sig hur medicinen ser ut och gömmer sig",
                       "Människor blir immuna mot medicinen så den slutar verka",
                       "Känsliga bakterier dör medan de som tål medicinen överlever",
                       "Bakterierna väntar tills man slutar äta kuren och anfaller"
                   ],
                   correct: 2,
                   explanation: "Det är ett <strong>naturligt urval</strong> där de motståndskraftiga bakterierna överlever behandlingen och förökar sig."
               },
               {
                   q: "Varför fungerar inte penicillin mot en vanlig förkylning eller influensa?",
                   options: [
                       "Penicillin är för svagt för att bita på influensasymtom",
                       "Man måste ta sprutor istället för tabletter mot virus",
                       "Kroppen bryter ner penicillinet för snabbt vid feber",
                       "Penicillin biter bara på bakterier, inte på virussjukdomar"
                   ],
                   correct: 3,
                   explanation: "Förkylning och influensa orsakas av <strong>virus</strong>, vilka inte påverkas av antibiotika."
               }
           ]
       },
       {
           title: "Del 2: Immunförsvar",
           icon: "🛡️",
           text: "Kroppen har ett <strong>medfött immunförsvar</strong> (t.ex. huden) och ett <strong>specifikt försvar</strong>. Det specifika försvaret använder vita blodkroppar som bildar <strong>antikroppar</strong> för att känna igen och besegra specifika smittämnen. Genom <strong>vaccination</strong> får kroppen en ofarlig dos av smittämnet så att <strong>minnesceller</strong> kan bildas, vilket gör dig immun.",
           questions: [
               {
                   q: "Vad händer i kroppen när en vaccination ger immunitet mot en sjukdom?",
                   options: [
                       "Immunförsvaret bildar antikroppar och minnesceller mot ämnet",
                       "Vaccinet lägger sig som ett skyddande lager runt alla friska celler",
                       "Vita blodkroppar dör för att ge plats åt nya och starkare celler",
                       "Blodet blir tjockare så att viruset inte kan simma runt i kroppen"
                   ],
                   correct: 0,
                   explanation: "Kroppen 'lär sig' känna igen smittämnet så att försvaret kan aktiveras <strong>blixtsnabbt</strong> vid en riktig infektion."
               },
               {
                   q: "Vilket av följande är ett exempel på kroppens medfödda, yttre försvar?",
                   options: [
                       "Vita blodkroppar",
                       "Huden",
                       "Antikroppar",
                       "Lungorna"
                   ],
                   correct: 1,
                   explanation: "<strong>Huden</strong> fungerar som en mekanisk barriär som stänger ute bakterier och virus."
               },
               {
                   q: "Vad är 'antikroppar' för något i immunförsvaret?",
                   options: [
                       "Små bakterier som äter upp farliga virus i blodet",
                       "Celler som bygger upp huden igen efter en skada",
                       "Proteiner som känner igen och oskadliggör smittämnen",
                       "En typ av medicin som man sväljer när man är sjuk"
                   ],
                   correct: 2,
                   explanation: "B-celler bildar <strong>antikroppar</strong> som fungerar som målsökande försvar mot specifika inkräktare."
               },
               {
                   q: "Varför kan en inflammation kännas varm, röd och svullen?",
                   options: [
                       "Det är viruset som kokar blodet för att föröka sig",
                       "Kroppen sparar på vatten för att skölja bort bakterier",
                       "Cellerna i området dör och släpper ut all sin värme",
                       "Blodtillförseln till det infekterade området ökar kraftigt"
                   ],
                   correct: 3,
                   explanation: "Ökat <strong>blodflöde</strong> transporterar fler vita blodkroppar till platsen för att bekämpa infektionen."
               },
               {
                   q: "Vad händer i kroppen vid en allergisk reaktion?",
                   options: [
                       "Immunförsvaret är för svagt för att känna igen farliga ämnen",
                       "Bakterier i magen börjar producera giftiga gaser efter måltiden",
                       "Kroppen slutar producera röda blodkroppar under en kort period",
                       "Immunförsvaret överreagerar på ämnen som egentligen är ofarliga"
                   ],
                   correct: 3,
                   explanation: "Allergi innebär att <strong>försvaret attackerar</strong> t.ex. pollen eller matprotein som om de vore farliga inkräktare."
               }
           ]
       },
       {
           title: "Del 3: Levnadsvanor",
           icon: "🏃",
           text: "Vår hälsa påverkas av hur vi lever. Långvarig <strong>sömnbrist</strong> kan leda till nedsatt immunförsvar och ökad risk för sjukdomar. <strong>Motion</strong> stärker hjärtat, vilket gör att mer syre kan pumpas ut till musklerna per slag. <strong>Alkohol</strong> kan vid långvarigt bruk skada organ som <strong>levern</strong> (bryter ner gifter) och njurarna.",
           questions: [
               {
                   q: "Hur påverkas kroppen av sömnbrist under flera månaders tid?",
                   options: [
                       "Immunförsvaret försämras så att man lättare blir sjuk",
                       "Musklerna växer snabbare eftersom de får vila mer",
                       "Kroppen slutar helt att producera vita blodkroppar",
                       "Man får lättare att koncentrera sig på svåra uppgifter"
                   ],
                   correct: 0,
                   explanation: "Under sömnen <strong>återhämtar</strong> sig kroppen och reparerar funktioner som är viktiga för försvaret."
               },
               {
                   q: "Varför förbättras konditionen av regelbunden motion?",
                   options: [
                       "Lungorna blir mindre så att de får plats med mer luft",
                       "Hjärtat blir starkare och kan pumpa ut mer blod per slag",
                       "Blodet blir tunnare så att det rinner snabbare i ådrorna",
                       "Musklerna behöver inte längre något syre för att arbeta"
                   ],
                   correct: 1,
                   explanation: "Ett <strong>starkare hjärta</strong> ger effektivare transport av syre till cellernas cellandning."
               },
               {
                   q: "Vilket organ skadas ofta vid långvarigt drickande av alkohol?",
                   options: [
                       "Lungorna",
                       "Skelettet",
                       "Levern",
                       "Huden"
                   ],
                   correct: 2,
                   explanation: "<strong>Levern</strong> ansvarar för att bryta ner gifter som alkohol, men kan ta allvarlig skada vid överbelastning."
               },
               {
                   q: "Vilket näringsämne i blodet behövs för att transportera syre?",
                   options: [
                       "Socker i plasman",
                       "Vitamin C i serumet",
                       "Kalcium i plättarna",
                       "Järn i hemoglobinet"
                   ],
                   correct: 3,
                   explanation: "<strong>Hemoglobin</strong> i de röda blodkropparna innehåller <strong>järnatomer</strong> som binder syret."
               },
               {
                   q: "Hur kan enäggstvillingar få olika stora muskler trots att de har samma gener?",
                   options: [
                       "Det är omöjligt eftersom generna styr allt i kroppen helt och hållet",
                       "Den ena tvillingen har ärvt fler dominanta anlag från pappan än den andra",
                       "Miljöfaktorer som träning och kost påverkar hur musklerna utvecklas",
                       "Det beror på att de har olika blodgrupper i AB0-systemet från födseln"
                   ],
                   correct: 2,
                   explanation: "Egenskaper som muskelmassa bestäms av en kombination av både <strong>arv och miljö</strong>."
               }
           ]
       },
       {
           title: "Del 4: Sexualitet & Relationer",
           icon: "❤️",
           text: "Preventivmedel används för att förhindra oönskad graviditet och sjukdomar. <strong>Kondom</strong> är det enda preventivmedlet som skyddar mot både graviditet och <strong>könssjukdomar</strong> som klamydia eller HIV. Oskyddat sex kan leda till långsiktiga följder som <strong>infertilitet</strong> (oförmåga att få barn).",
           questions: [
               {
                   q: "Vilket preventivmedel ger skydd mot könssjukdomar?",
                   options: [
                       "Kondom",
                       "P-piller",
                       "Spiral",
                       "P-stav"
                   ],
                   correct: 0,
                   explanation: "<strong>Kondomen</strong> fungerar som en barriär som hindrar smitta från att föras över mellan partners."
               },
               {
                   q: "Vilken är en möjlig långsiktig följd av en obehandlad könssjukdom?",
                   options: [
                       "Man blir immun mot alla framtida infektioner",
                       "Man kan bli steril (infertilitet)",
                       "Blodtrycket sjunker till en farligt låg nivå",
                       "Skelettet blir mjukare och går lättare sönder"
                   ],
                   correct: 1,
                   explanation: "Vissa infektioner kan skada fortplantningsorganen så att det blir svårt att <strong>få barn</strong> senare i livet."
               },
               {
                   q: "Vilken sjukdom orsakas av en bakterie och behandlas med antibiotika?",
                   options: [
                       "AIDS",
                       "Kondylom",
                       "Klamydia",
                       "Influensa"
                   ],
                   correct: 2,
                   explanation: "<strong>Klamydia</strong> är en bakterieinfektion som ofta ger sveda när man kissar och kan botas med antibiotika."
               },
               {
                   q: "Vad kännetecknar sjukdomen AIDS?",
                   options: [
                       "Den orsakas av bakterier och botas med en enkel penicillinkur",
                       "Den ger vårtor kring könsorganen som kan frysas bort av läkare",
                       "Den ger alltid kraftiga symtom direkt efter att man blivit smittad",
                       "Den orsakas av virus som försvagar kroppens immunförsvar"
                   ],
                   correct: 3,
                   explanation: "HIV-viruset angriper <strong>immunförsvaret</strong> så att kroppen inte kan försvara sig mot andra sjukdomar."
               }
           ]
       },
       {
  "title": "Del 5: Psykisk hälsa & Beroende",
  "icon": "🧠",
  "text": "Hälsa handlar om både kropp och själ. <strong>Psykisk ohälsa</strong> kan yttra sig som depression eller ätstörningar. Vid ätstörningar är det viktigt med tidig hjälp. Beroendesjukdomar påverkar hjärnans <strong>belöningssystem</strong> där signalämnet <strong>dopamin</strong> spelar en central roll.",
  "questions": [
    {
      "q": "Vilket signalämne i hjärnan har en central roll vid beroendesjukdomar?",
      "options": [
        "Insulin",
        "Dopamin",
        "Hemoglobin",
        "Adrenalin"
      ],
      "correct": 1,
      "explanation": "<strong>Dopamin</strong> ingår i kroppens belöningssystem som kan 'kapas' vid ett beroende."
    },
    {
      "q": "Vad är sant gällande ätstörningar enligt informationen i texten?",
      "options": [
        "Det är viktigt att få hjälp i ett tidigt skede.",
        "Det är en fysisk sjukdom som inte är psykisk.",
        "Det går oftast över av sig självt utan stöd.",
        "Det är en ovanlig form av beroendesjukdom."
      ],
      "correct": 0,
      "explanation": "Vid ätstörningar poängteras vikten av <strong>tidig hjälp</strong> för tillfrisknandet."
    },
    {
      "q": "Vilken del av hjärnan påverkas främst vid en beroendesjukdom?",
      "options": [
        "Hjärnans centrum för språkinlärning.",
        "Den del som styr kroppens balanssinne.",
        "Hjärnans centrala belöningssystem.",
        "Området som hanterar vårt mörkerseende."
      ],
      "correct": 2,
      "explanation": "Beroendesjukdomar påverkar hjärnans <strong>belöningssystem</strong> direkt."
    }
  ]
}
   ];


   // --- STATE MANAGEMENT ---
   let currentSectionIndex = 0;
   let currentQuestionIndex = 0; // Relative to current section
   let score = 0;
   let userAnswers = [];
   let state = 'intro'; // 'intro', 'question', 'summary'


   // --- DOM ELEMENTS ---
   const app = document.getElementById('app');
   const headerTitle = document.getElementById('header-title');
   const progressBar = document.getElementById('progress-bar');


   // --- MAIN RENDER FUNCTION ---
   function render() {
       if (state === 'summary') {
           renderSummary();
           return;
       }


       const section = quizData[currentSectionIndex];


       // Update Header with smooth fade
       headerTitle.style.opacity = '0';
       setTimeout(() => {
           headerTitle.innerText = section.title;
           headerTitle.style.transition = 'opacity 0.2s';
           headerTitle.style.opacity = '1';
       }, 150);


       // Calculate total progress
       let totalQuestions = 0;
       let answeredQuestions = 0;
      
       quizData.forEach((sec, idx) => {
           totalQuestions += sec.questions.length;
           if (idx < currentSectionIndex) {
               answeredQuestions += sec.questions.length;
           } else if (idx === currentSectionIndex && state === 'question') {
               answeredQuestions += currentQuestionIndex;
           }
       });
       const pct = (answeredQuestions / totalQuestions) * 100;
       progressBar.style.width = `${pct}%`;


       if (state === 'intro') {
           renderSectionIntro(section);
       } else if (state === 'question') {
           renderQuestion(section.questions[currentQuestionIndex]);
       }
   }


   // --- RENDER SECTION TEXT ---
   function renderSectionIntro(section) {
       // Simple animation class reset
       app.classList.remove('fade-in');
       void app.offsetWidth; // trigger reflow
       app.classList.add('fade-in');


       app.innerHTML = `
           <div class="fact-box">
               <span class="fact-icon">${section.icon}</span>
               <div class="fact-content">
                   <h2>Fakta</h2>
                   <p style="line-height: 1.6; font-size: 1rem; margin-top:0;">${section.text}</p>
               </div>
           </div>
           <button class="btn" onclick="startQuestions()">Starta frågor för denna del</button>
       `;
   }


   // --- RENDER QUESTION ---
   function renderQuestion(q) {
       const totalInCurrent = quizData[currentSectionIndex].questions.length;
      
       // Render with reset styles for feedback box
       app.innerHTML = `
           <div class="question-meta">Del ${currentSectionIndex + 1} • Fråga ${currentQuestionIndex + 1}/${totalInCurrent}</div>
           <h2 style="color: var(--text-main); font-weight: 600; margin-bottom:15px;">${q.q}</h2>
           <div class="options-grid">
               ${q.options.map((opt, idx) => `
                   <button class="option-btn" onclick="handleAnswer(${idx})" id="opt-${idx}">${opt}</button>
               `).join('')}
           </div>
           <div id="feedback" class="feedback-box">
               <h3 id="feedback-title"></h3>
               <p id="feedback-text" style="margin: 5px 0 15px 0; font-size: 0.95rem; line-height: 1.6;"></p>
               <button class="btn" id="next-btn" onclick="nextStep()" style="margin-top:0; width: auto; min-width: 150px;">Nästa fråga ➔</button>
           </div>
       `;
   }


   // --- RENDER SUMMARY ---
   function renderSummary() {
       headerTitle.innerText = "Sammanfattning";
       progressBar.style.width = '100%';
      
       let totalQ = 0;
       quizData.forEach(s => totalQ += s.questions.length);
      
       // Calculate score
       let correctCount = userAnswers.filter(a => a.isCorrect).length;
       let pct = Math.round((correctCount / totalQ) * 100);
      
       let gradeTitle = "";
      
       if(pct > 90) { gradeTitle = "Fantastiskt bra! 🏆"; }
       else if(pct > 70) { gradeTitle = "Mycket bra jobbat! 🌟"; }
       else if(pct > 50) { gradeTitle = "Godkänt! 👍"; }
       else { gradeTitle = "Fortsätt kämpa! 💪"; }


       let html = `
           <div class="summary-stats">
               <h2 style="color:var(--brand-color); margin:0 0 10px 0;">${gradeTitle}</h2>
               <span class="summary-score">${correctCount}/${totalQ}</span>
               <span style="color:#666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Rätt svar</span>
               <button class="btn" onclick="location.reload()" style="background: transparent; border: 2px solid var(--accent-color); color: var(--accent-color); margin-top: 20px; box-shadow:none; width: auto; padding: 10px 30px;">Gör om testet</button>
           </div>
           <h3 style="margin: 0 0 10px 0; font-size: 1.1rem; color: var(--text-muted);">Dina svar:</h3>
           <div class="summary-list">
       `;


       userAnswers.forEach((ans, idx) => {
           const isCorrect = ans.isCorrect;
          
           html += `
               <div class="summary-item">
                   <span class="summary-question">${idx + 1}. ${ans.question}</span>
                   <div class="summary-answer-row">
                       ${isCorrect
                           ? `<span class="summary-correct-text">✔ ${ans.userAnswer}</span>`
                           : `<span class="summary-wrong-text">✖ ${ans.userAnswer}</span> <span style="margin: 0 5px; color:#999;">➔</span> <span class="real-answer">${ans.correctAnswer}</span>`
                       }
                   </div>
               </div>
           `;
       });


       html += `</div>`;
       app.innerHTML = html;
   }


   // --- LOGIC FUNCTIONS ---
   window.startQuestions = function() {
       state = 'question';
       currentQuestionIndex = 0;
       render();
   };


   window.handleAnswer = function(selectedIndex) {
       // Disable all buttons
       const buttons = document.querySelectorAll('.option-btn');
       buttons.forEach(b => b.disabled = true);


       const section = quizData[currentSectionIndex];
       const currentQ = section.questions[currentQuestionIndex];
       const isCorrect = selectedIndex === currentQ.correct;


       // Visual feedback on buttons
       const selectedBtn = document.getElementById(`opt-${selectedIndex}`);
       const correctBtn = document.getElementById(`opt-${currentQ.correct}`);


       if (isCorrect) {
           selectedBtn.classList.add('correct');
       } else {
           selectedBtn.classList.add('incorrect');
           correctBtn.classList.add('correct'); // Show which one was right
       }


       // Show feedback box
       const feedbackBox = document.getElementById('feedback');
       const feedbackTitle = document.getElementById('feedback-title');
       const feedbackText = document.getElementById('feedback-text');
       const nextBtn = document.getElementById('next-btn');


       feedbackBox.style.display = 'block';
      
       // Add class for success/error styling
       if (isCorrect) {
           feedbackBox.className = "feedback-box success";
           feedbackTitle.innerHTML = "Rätt svar!";
       } else {
           feedbackBox.className = "feedback-box error";
           feedbackTitle.innerHTML = "Inte riktigt...";
       }
      
       feedbackText.innerHTML = currentQ.explanation; // Use innerHTML to render <strong> tags


       // Check if last question of entire quiz
       const isLastQuestionOverall = (currentSectionIndex === quizData.length - 1) && (currentQuestionIndex === section.questions.length - 1);
      
       if(isLastQuestionOverall) {
           nextBtn.innerText = "Se resultat 🏁";
       } else if (currentQuestionIndex === section.questions.length - 1) {
           nextBtn.innerText = "Nästa del ➔";
       }


       // Scroll to feedback if needed on mobile, but gently
       const rect = feedbackBox.getBoundingClientRect();
       const isVisible = (rect.top >= 0) && (rect.bottom <= window.innerHeight);
       if (!isVisible) {
            setTimeout(() => {
               feedbackBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
           }, 100);
       }


       // Save data
       userAnswers.push({
           question: currentQ.q,
           userAnswer: currentQ.options[selectedIndex],
           correctAnswer: currentQ.options[currentQ.correct],
           isCorrect: isCorrect
       });
   };


   window.nextStep = function() {
       const section = quizData[currentSectionIndex];
      
       // Reset feedback styles for next render
       const feedbackBox = document.getElementById('feedback');
       if(feedbackBox) {
           feedbackBox.style.display = 'none';
       }


       // Check if there are more questions in this section
       if (currentQuestionIndex < section.questions.length - 1) {
           currentQuestionIndex++;
           render();
       } else {
           // End of section, move to next section
           if (currentSectionIndex < quizData.length - 1) {
               currentSectionIndex++;
               state = 'intro';
               render();
           } else {
               // End of quiz
               state = 'summary';
               render();
           }
       }
   };


   // --- INIT ---
   render();


</script>


</body>
</html>
