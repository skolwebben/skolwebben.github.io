<!DOCTYPE html>
<html lang="sv">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Fysikquiz: Systematiska Undersökningar (Åk 9)</title>
   <!-- Importerar moderna fonter från Google Fonts -->
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  
   <style>
       :root {
           /* Färgpalett - Professionell & Ren */
           --card-bg: #ffffff;
          
           --brand-color: #2c3e50;
           --brand-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
          
           --accent-color: #3498db;
          
           --success-color: #10ac84;
           --success-bg: #e3f9f1;
          
           --error-color: #ee5253;
           --error-bg: #ffeded;
          
           --text-main: #2d3436;
           --text-muted: #636e72;
          
           --shadow-card: 0 10px 25px rgba(0,0,0,0.15);
           --shadow-hover: 0 6px 16px rgba(0,0,0,0.12);
           --radius-main: 16px;
       }


       body {
           font-family: 'Open Sans', sans-serif;
           /* Gråaktig fade (Silver/Metallic style) */
           background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
           color: var(--text-main);
           margin: 0;
           padding: 15px;
           display: flex;
           justify-content: center;
           align-items: flex-start;
           min-height: 100vh;
       }


       .container {
           background-color: var(--card-bg);
           width: 100%;
           max-width: 680px;
           border-radius: var(--radius-main);
           box-shadow: var(--shadow-card);
           overflow: hidden;
           display: flex;
           flex-direction: column;
           position: relative;
           margin-top: 3vh;
           margin-bottom: 3vh;
       }


       header {
           background: var(--brand-gradient);
           color: white;
           padding: 20px;
           text-align: center;
           position: relative;
           overflow: hidden;
       }


       h1 {
           font-family: 'Poppins', sans-serif;
           margin: 0;
           font-size: 1.5rem;
           font-weight: 700;
           letter-spacing: -0.3px;
       }


       .content-area {
           padding: 25px 30px;
           flex-grow: 1;
       }


       h2 {
           font-family: 'Poppins', sans-serif;
           color: var(--brand-color);
           margin-top: 0;
           font-size: 1.3rem;
           margin-bottom: 0.8rem;
           line-height: 1.3;
       }


       /* Fact Section Styles */
       .fact-box {
           background: #f8f9fa;
           border-radius: 12px;
           padding: 20px;
           margin-bottom: 20px;
           /* Ingen border-left */
           display: flex;
           gap: 15px;
           align-items: flex-start;
       }
      
       .fact-icon {
           font-size: 2rem;
           display: block;
           margin-top: -5px;
       }
      
       .fact-content {
           flex: 1;
       }


       .btn {
           background: var(--brand-gradient);
           color: white;
           border: none;
           padding: 12px 24px;
           font-family: 'Poppins', sans-serif;
           font-size: 1rem;
           font-weight: 600;
           border-radius: 8px;
           cursor: pointer;
           transition: all 0.2s ease;
           display: block;
           width: 100%;
           margin-top: 20px;
           box-shadow: 0 4px 10px rgba(52, 152, 219, 0.2);
       }


       .btn:hover {
           transform: translateY(-2px);
           box-shadow: 0 6px 14px rgba(52, 152, 219, 0.3);
           opacity: 0.95;
       }


       /* Question Styles */
       .question-meta {
           display: inline-block;
           color: var(--text-muted);
           font-size: 0.85rem;
           margin-bottom: 10px;
           font-weight: 600;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }


       .options-grid {
           display: grid;
           gap: 12px;
           margin-top: 20px;
       }


       .option-btn {
           background-color: #fff;
           border: 2px solid #f1f2f6;
           padding: 15px 20px;
           text-align: left;
           border-radius: 10px;
           cursor: pointer;
           font-family: 'Open Sans', sans-serif;
           font-size: 0.95rem;
           font-weight: 500;
           transition: all 0.15s ease;
           color: var(--text-main);
           position: relative;
       }


       .option-btn:hover:not(:disabled) {
           border-color: var(--accent-color);
           background-color: #f8fcff;
           transform: translateX(3px);
           box-shadow: 0 2px 5px rgba(0,0,0,0.05);
       }
      
       /* Status states for options */
       .option-btn.correct {
           background-color: var(--success-bg);
           border-color: var(--success-color);
           color: #0b6e4f;
           font-weight: 600;
       }
      
       .option-btn.correct::after {
           content: "✓";
           position: absolute;
           right: 15px;
           font-weight: bold;
       }


       .option-btn.incorrect {
           background-color: var(--error-bg);
           border-color: var(--error-color);
           color: #c0392b;
           opacity: 0.8;
       }


       .option-btn:disabled {
           cursor: default;
       }


       /* Feedback Box */
       .feedback-box {
           margin-top: 20px;
           padding: 20px 25px;
           border-radius: 12px;
           background-color: #f8f9fa;
           color: var(--text-main);
           border: 1px solid #e9ecef;
           display: none;
           animation: fadeIn 0.3s ease;
       }
      
       .feedback-box h3 {
           margin-top: 0;
           font-family: 'Poppins', sans-serif;
           font-size: 1.2rem;
           display: flex;
           align-items: center;
           gap: 8px;
           margin-bottom: 8px;
       }


       .feedback-box.success h3 {
           color: var(--success-color);
       }
      
       .feedback-box.error h3 {
           color: var(--error-color);
       }


       .feedback-box strong {
           color: var(--brand-color);
       }


       @keyframes fadeIn {
           from { opacity: 0; transform: translateY(5px); }
           to { opacity: 1; transform: translateY(0); }
       }


       /* Progress Bar Styles */
       .progress-bar-container {
           height: 6px;
           background-color: #f1f3f5;
           width: 100%;
           position: relative;
           z-index: 10;
       }


       .progress-bar {
           height: 100%;
           background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
           width: 0%;
           transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
           border-radius: 0 4px 4px 0;
           box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
       }


       /* Summary Styles */
       .summary-stats {
           text-align: center;
           background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
           border: 1px solid #dee2e6;
           padding: 30px 20px;
           border-radius: 12px;
           margin-bottom: 20px;
       }


       .summary-score {
           font-size: 3.5rem;
           font-family: 'Poppins', sans-serif;
           font-weight: 700;
           display: block;
           margin: 5px 0;
           line-height: 1;
           background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
           -webkit-background-clip: text;
           -webkit-text-fill-color: transparent;
       }
      
       .summary-list {
           max-height: 400px;
           overflow-y: auto;
           padding-right: 10px;
       }
      
       .summary-item {
           background: white;
           border-bottom: 1px solid #f1f1f1;
           padding: 12px 0;
       }
      
       .summary-item:last-child {
           border-bottom: none;
       }


       .summary-question {
           font-weight: 600;
           margin-bottom: 4px;
           display: block;
           font-size: 0.95rem;
       }
      
       .summary-answer-row {
           font-size: 0.9rem;
       }


       .summary-correct-text { color: var(--success-color); font-weight: 600; }
       .summary-wrong-text { color: var(--error-color); text-decoration: line-through; opacity: 0.8;}
       .real-answer { color: var(--success-color); font-weight: 600; margin-left: 5px; }


       /* Helpers */
       strong {
           color: var(--brand-color);
           font-weight: 700;
       }


   </style>
</head>
<body>


<div class="container">
   <header>
       <h1 id="header-title">Fysikquiz: Systematiska Undersökningar</h1>
   </header>
   <div class="progress-bar-container">
       <div class="progress-bar" id="progress-bar"></div>
   </div>


   <div class="content-area" id="app">
       <!-- Content will be injected here by JavaScript -->
   </div>
</div>


<script>
   // --- DATA ---
   const quizData = [
       {
           title: "Del 1: Planering och Variabler",
           icon: "📝",
           text: "En systematisk undersökning börjar alltid med en frågeställning och ofta en <strong>hypotes</strong> (en välgrundad gissning). För att undersökningen ska bli rättvis ('fair test') måste man ha koll på sina variabler. <strong>Oberoende variabel</strong> är den sak du ändrar på med flit. Man ska bara ändra en sak i taget. <strong>Beroende variabel</strong> är den sak du mäter för att se resultatet. <strong>Kontrollvariabler</strong> är allt annat som måste hållas lika för att inte förstöra resultatet.",
           questions: [
               {
                   q: "Du ska undersöka hur pendelns längd påverkar svängningstiden. Vad är den oberoende variabeln?",
                   options: [
                       "Svängningstiden, eftersom det är den vi mäter med tidtagaruret.",
                       "Tyngden på pendeln, eftersom den påverkar hur fort det går.",
                       "Luftmotståndet, eftersom det alltid bromsar pendeln lite.",
                       "Snörets längd, eftersom det är den faktorn vi bestämmer och ändrar." // Rätt (Index 3)
                   ],
                   correct: 3,
                   explanation: "I en systematisk undersökning är den <strong>oberoende variabeln</strong> den faktor du medvetet ändrar för att se om det påverkar resultatet. Här ändrar du **snörets längd** för att mäta hur det påverkar tiden."
               },
               {
                   q: "Varför är det så viktigt att bara ändra en variabel i taget under ett experiment?",
                   options: [
                       "För att mätinstrumenten ska hinna registrera alla värden korrekt.",
                       "För att veta exakt vilken faktor som orsakar förändringen i resultatet.", // Rätt (Index 1)
                       "För att det sparar tid och materiel under laborationen.",
                       "För att hypotesen annars automatiskt blir motbevisad."
                   ],
                   correct: 1,
                   explanation: "Om man ändrar flera saker samtidigt (t.ex. både längd och tyngd) går det inte att avgöra vilken av dem som orsakade resultatförändringen. Detta kallas för <strong>variabelkontroll</strong> och är grunden för en rättvis undersökning."
               },
               {
                   q: "Vad är den vetenskapliga definitionen av en hypotes?",
                   options: [
                       "Ett genomtänkt antagande om resultatet som görs före experimentet.", // Rätt (Index 0)
                       "En ren gissning som inte behöver ha någon koppling till teori.",
                       "Det slutgiltiga beviset på att experimentet lyckades.",
                       "En sammanfattning av resultaten efter laborationen."
                   ],
                   correct: 0,
                   explanation: "En <strong>hypotes</strong> är ett vetenskapligt antagande om vad som kommer hända, baserat på tidigare kunskaper eller teorier. Den formuleras ofta som 'Om jag gör X, så händer Y, därför att...'."
               }
           ]
       },
       {
           title: "Del 2: Genomförande och Mätningar",
           icon: "📏",
           text: "När du genomför laborationen är det viktigt att använda rätt mätinstrument. I fysiken mäter vi <strong>storheter</strong> (t.ex. kraft, tid) som har <strong>enheter</strong> (Newton, sekunder). För att minska risken för slarvfel eller tillfälliga fel är det bra att göra <strong>upprepade mätningar</strong>. Om du mäter samma sak tre gånger och får nästan samma svar kan du lita mer på ditt resultat.",
           questions: [
               {
                   q: "Vilket mätinstrument ska du använda om du vill mäta en kraft i Newton?",
                   options: [
                       "En barometer, som mäter tryckförändringar.",
                       "En termometer, som mäter värmeenergi.",
                       "En dynamometer, som mäter dragkraft.", // Rätt (Index 2)
                       "Ett skjutmått, som mäter små avstånd."
                   ],
                   correct: 2,
                   explanation: "En <strong>dynamometer</strong> är ett instrument med en fjäder som dras ut proportionellt mot kraften, och skalan är graderad i enheten <strong>Newton (N)</strong>. En barometer mäter tryck och en termometer temperatur."
               },
               {
                   q: "Eleverna Maja och Li får mätvärdena 1,25 m, 1,22 m och 1,28 m. Vad bör de göra?",
                   options: [
                       "De bör beräkna ett medelvärde för att minska slumpens inverkan.", // Rätt (Index 0)
                       "De bör välja mätvärdet som stämmer bäst med deras hypotes.",
                       "De bör addera alla värden för att få en totalsumma.",
                       "De bör välja det mittersta värdet och kasta de andra."
                   ],
                   correct: 0,
                   explanation: "Genom att göra flera mätningar och beräkna ett <strong>medelvärde</strong> minskar man inverkan av <strong>slumpmässiga fel</strong>. Detta ger ett mätvärde som ligger närmare det sanna värdet än en enskild mätning gör."
               },
               {
                   q: "Varför ska man läsa av mätinstrument rakt framifrån (vinkelrätt)?",
                   options: [
                       "För att instrumentet fungerar bäst i 90 graders vinkel.",
                       "För att ljuset ska reflekteras rätt i glaset.",
                       "För att vätskan i instrumentet ska stabilisera sig.",
                       "För att undvika parallaxfel som ger felaktiga mätvärden." // Rätt (Index 3)
                   ],
                   correct: 3,
                   explanation: "Om man tittar snett på en mätskala eller vätskeyta uppstår ett s.k. <strong>parallaxfel</strong>, vilket gör att värdet ser högre eller lägre ut än det är. Man ska alltid ha ögat i jämnhöjd med skalan."
               }
           ]
       },
       {
           title: "Del 3: Dokumentation och Bearbetning",
           icon: "📊",
           text: "Resultaten från en undersökning ska dokumenteras tydligt, ofta i en <strong>tabell</strong> och sedan i ett <strong>diagram</strong>. Tabeller ska ha tydliga rubriker där storhet och enhet står. Diagram gör det lättare att se samband. Den oberoende variabeln (den vi styrde) sätts oftast på <strong>x-axeln</strong> (vågrät), och den beroende variabeln (resultatet) på <strong>y-axeln</strong> (lodrät).",
           questions: [
               {
                   q: "Vilken diagramtyp är bäst för att visa hur vattnets temperatur förändras över tid?",
                   options: [
                       "Ett stapeldiagram, eftersom det visar tydliga nivåer.",
                       "Ett linjediagram, för att visa förändring över tid.", // Rätt (Index 1)
                       "Ett cirkeldiagram, för att se andelar av tiden.",
                       "Ett flödesschema, för att visa processens steg."
                   ],
                   correct: 1,
                   explanation: "Ett <strong>linjediagram</strong> är bäst lämpat för att visa hur en kontinuerlig variabel (som temperatur) förändras beroende på en annan (som tid). Stapeldiagram används oftare för kategorier som inte hänger ihop."
               },
               {
                   q: "I din resultattabell har du skrivit 'Sträcka' som rubrik. Vad mer måste finnas med?",
                   options: [
                       "Datum för när mätningen gjordes.",
                       "Namnet på mätinstrumentet som användes.",
                       "Enheten (t.ex. meter) för att siffrorna ska betyda något.", // Rätt (Index 2)
                       "En förklaring av eventuella felkällor."
                   ],
                   correct: 2,
                   explanation: "En fysikalisk <strong>storhet</strong> (som sträcka) blir meningslös utan en tillhörande <strong>enhet</strong> (som meter eller cm). Utan enheten vet man inte om siffran 5 betyder 5 millimeter eller 5 mil."
               },
               {
                   q: "Om punkterna i diagrammet bildar en rät linje genom origo (0,0), vad visar det?",
                   options: [
                       "Att variablerna är proportionella mot varandra.", // Rätt (Index 0)
                       "Att det inte finns något tydligt samband mellan variablerna.",
                       "Att sambandet är exponentiellt och ökar snabbare och snabbare.",
                       "Att mätvärdena är felaktiga eftersom linjen borde vara krokig."
                   ],
                   correct: 0,
                   explanation: "En rät linje som startar i origo (0,0) innebär att det finns ett <strong>proportionellt samband</strong>. Det betyder att om den ena variabeln dubblas, så dubblas även den andra variabeln exakt."
               }
           ]
       },
       {
           title: "Del 4: Slutsats och Utvärdering",
           icon: "🔍",
           text: "I <strong>slutsatsen</strong> svarar du på din frågeställning. I utvärderingen diskuterar man undersökningens kvalitet, <strong>tillförlitlighet</strong> och <strong>felkällor</strong>. Vi skiljer på slarvfel och <strong>systematiska fel</strong> (t.ex. att vågen alltid visar 5g för mycket). En viktig del är att kunna föreslå förbättringar av metoden.",
           questions: [
               {
                   q: "Du mäter kokpunkten på vatten till 98 °C istället för 100 °C. Vad är en rimlig felkälla?",
                   options: [
                       "Vattnet var troligen gammalt och hade förlorat sin kokförmåga.",
                       "Värmeplattan var inte tillräckligt varm för att nå 100 grader.",
                       "Experimentet utfördes slarvigt och bör därför underkännas.",
                       "Termometern kan vara felkalibrerad eller påverkad av lufttrycket." // Rätt (Index 3)
                   ],
                   correct: 3,
                   explanation: "En bra diskussion om felkällor letar efter fysikaliska orsaker. Termometern kan vara felkalibrerad (ett <strong>systematiskt fel</strong>) eller så kan det aktuella <strong>lufttrycket</strong> vara lågt, vilket sänker kokpunkten."
               },
               {
                   q: "Vad innebär det att kritiskt granska sin metod i en labbrapport?",
                   options: [
                       "Att man erkänner att man var dålig på att genomföra labben.",
                       "Att man letar efter svagheter i utförandet och föreslår förbättringar.", // Rätt (Index 1)
                       "Att man justerar sina mätvärden så att de stämmer med facit.",
                       "Att man skriver att allt gick bra och att resultatet är perfekt."
                   ],
                   correct: 1,
                   explanation: "Att kritiskt granska metoden innebär att analysera undersökningens <strong>tillförlitlighet</strong> och föreslå konkreta <strong>förbättringar</strong>. Det handlar om att hitta svagheter som kan ha påverkat resultatet, inte att skylla på personliga misstag."
               },
               {
                   q: "Vad skiljer ett systematiskt fel från ett slumpmässigt fel?",
                   options: [
                       "Slumpmässiga fel är allvarligare eftersom de inte går att upptäcka.",
                       "Det finns ingen praktisk skillnad, båda ger felaktiga slutsatser.",
                       "Systematiska fel ger fel åt samma håll, medan slumpmässiga varierar.", // Rätt (Index 2)
                       "Systematiska fel beror på slarv, medan slumpmässiga beror på utrustningen."
                   ],
                   correct: 2,
                   explanation: "<strong>Systematiska fel</strong>, som en felkalibrerad våg, ger en avvikelse åt samma håll varje gång. <strong>Slumpmässiga fel</strong> beror på tillfälligheter och varierar både uppåt och nedåt kring det sanna värdet."
               }
           ]
       },
       {
           title: "Del 5: Säkerhet och Modeller",
           icon: "🥽",
           text: "Systematiska undersökningar handlar också om <strong>säkerhet</strong> och att koppla resultatet till <strong>fysikaliska modeller</strong>. Om du undersöker friktion måste du kunna koppla dina resultat till teorin om ytors ojämnhet. Riskbedömning görs för att undvika skador innan man börjar.",
           questions: [
               {
                   q: "Varför gör man en riskbedömning innan en laboration påbörjas?",
                   options: [
                       "För att identifiera faror och förhindra att någon skadar sig.", // Rätt (Index 0)
                       "För att se till att materialet räcker till alla elever.",
                       "För att resultatet av experimentet ska bli mer exakt.",
                       "För att läraren ska slippa ta ansvar om något händer."
                   ],
                   correct: 0,
                   explanation: "En <strong>riskbedömning</strong> görs för att identifiera moment som kan vara farliga, t.ex. hantering av kemikalier eller värme. Syftet är att förebygga olyckor och skapa en god <strong>säkerhet</strong> i laboratoriet."
               },
               {
                   q: "Ditt resultat visar att en järnbit sjunker medan en träbit flyter. Vilken modell förklarar detta?",
                   options: [
                       "Newtons tröghetslag och friktion.",
                       "Termodynamikens lagar om värme.",
                       "Ohms lag om elektriskt motstånd.",
                       "Arkimedes princip och densitet." // Rätt (Index 3)
                   ],
                   correct: 3,
                   explanation: "Resultatet förklaras med fysikaliska modeller om <strong>densitet</strong> och <strong>Arkimedes princip</strong>. Om föremålets densitet är högre än vätskans densitet blir tyngden större än lyftkraften, och föremålet sjunker."
               },
               {
                   q: "Vad är det viktigaste vetenskapliga syftet med en laborationsrapport?",
                   options: [
                       "Att visa att man har förstått teorin i läroboken.",
                       "Att någon annan ska kunna göra om undersökningen exakt likadant.", // Rätt (Index 1)
                       "Att skriva så långt och detaljerat som möjligt.",
                       "Att samla in poäng för att få ett högre betyg."
                   ],
                   correct: 1,
                   explanation: "Huvudsyftet med en vetenskaplig rapport är att dokumentera arbetet så tydligt att någon annan kan upprepa undersökningen. Detta krav på <strong>reproducerbarhet</strong> är grunden för att verifiera vetenskapliga resultat."
               }
           ]
       }
   ];


   // --- STATE MANAGEMENT ---
   let currentSectionIndex = 0;
   let currentQuestionIndex = 0; // Relative to current section
   let score = 0;
   let userAnswers = [];
   let state = 'intro'; // 'intro', 'question', 'summary'


   // --- DOM ELEMENTS ---
   const app = document.getElementById('app');
   const headerTitle = document.getElementById('header-title');
   const progressBar = document.getElementById('progress-bar');


   // --- MAIN RENDER FUNCTION ---
   function render() {
       if (state === 'summary') {
           renderSummary();
           return;
       }


       const section = quizData[currentSectionIndex];


       // Update Header with smooth fade
       headerTitle.style.opacity = '0';
       setTimeout(() => {
           headerTitle.innerText = section.title;
           headerTitle.style.transition = 'opacity 0.2s';
           headerTitle.style.opacity = '1';
       }, 150);


       // Calculate total progress
       let totalQuestions = 0;
       let answeredQuestions = 0;
      
       quizData.forEach((sec, idx) => {
           totalQuestions += sec.questions.length;
           if (idx < currentSectionIndex) {
               answeredQuestions += sec.questions.length;
           } else if (idx === currentSectionIndex && state === 'question') {
               answeredQuestions += currentQuestionIndex;
           }
       });
       const pct = (answeredQuestions / totalQuestions) * 100;
       progressBar.style.width = `${pct}%`;


       if (state === 'intro') {
           renderSectionIntro(section);
       } else if (state === 'question') {
           renderQuestion(section.questions[currentQuestionIndex]);
       }
   }


   // --- RENDER SECTION TEXT ---
   function renderSectionIntro(section) {
       // Simple animation class reset
       app.classList.remove('fade-in');
       void app.offsetWidth; // trigger reflow
       app.classList.add('fade-in');


       app.innerHTML = `
           <div class="fact-box">
               <span class="fact-icon">${section.icon}</span>
               <div class="fact-content">
                   <h2>Fakta</h2>
                   <p style="line-height: 1.6; font-size: 1rem; margin-top:0;">${section.text}</p>
               </div>
           </div>
           <button class="btn" onclick="startQuestions()">Starta frågor för denna del</button>
       `;
   }


   // --- RENDER QUESTION ---
   function renderQuestion(q) {
       const totalInCurrent = quizData[currentSectionIndex].questions.length;
      
       // Render with reset styles for feedback box
       app.innerHTML = `
           <div class="question-meta">Del ${currentSectionIndex + 1} • Fråga ${currentQuestionIndex + 1}/${totalInCurrent}</div>
           <h2 style="color: #2c3e50; font-weight: 600; margin-bottom:15px;">${q.q}</h2>
           <div class="options-grid">
               ${q.options.map((opt, idx) => `
                   <button class="option-btn" onclick="handleAnswer(${idx})" id="opt-${idx}">${opt}</button>
               `).join('')}
           </div>
           <div id="feedback" class="feedback-box">
               <h3 id="feedback-title"></h3>
               <p id="feedback-text" style="margin: 5px 0 15px 0; font-size: 0.95rem; line-height: 1.6;"></p>
               <button class="btn" id="next-btn" onclick="nextStep()" style="margin-top:0; width: auto; min-width: 150px;">Nästa fråga ➔</button>
           </div>
       `;
   }


   // --- RENDER SUMMARY ---
   function renderSummary() {
       headerTitle.innerText = "Sammanfattning";
       progressBar.style.width = '100%';
      
       let totalQ = 0;
       quizData.forEach(s => totalQ += s.questions.length);
      
       // Calculate score
       let correctCount = userAnswers.filter(a => a.isCorrect).length;
       let pct = Math.round((correctCount / totalQ) * 100);
      
       let gradeTitle = "";
      
       if(pct > 90) { gradeTitle = "Fantastiskt bra! 🏆"; }
       else if(pct > 70) { gradeTitle = "Mycket bra jobbat! 🌟"; }
       else if(pct > 50) { gradeTitle = "Godkänt! 👍"; }
       else { gradeTitle = "Fortsätt kämpa! 💪"; }


       let html = `
           <div class="summary-stats">
               <h2 style="color:var(--brand-color); margin:0 0 10px 0;">${gradeTitle}</h2>
               <span class="summary-score">${correctCount}/${totalQ}</span>
               <span style="color:#666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Rätt svar</span>
               <button class="btn" onclick="location.reload()" style="background: transparent; border: 2px solid var(--accent-color); color: var(--accent-color); margin-top: 20px; box-shadow:none; width: auto; padding: 10px 30px;">Gör om testet</button>
           </div>
           <h3 style="margin: 0 0 10px 0; font-size: 1.1rem; color: var(--text-muted);">Dina svar:</h3>
           <div class="summary-list">
       `;


       userAnswers.forEach((ans, idx) => {
           const isCorrect = ans.isCorrect;
          
           html += `
               <div class="summary-item">
                   <span class="summary-question">${idx + 1}. ${ans.question}</span>
                   <div class="summary-answer-row">
                       ${isCorrect
                           ? `<span class="summary-correct-text">✔ ${ans.userAnswer}</span>`
                           : `<span class="summary-wrong-text">✖ ${ans.userAnswer}</span> <span style="margin: 0 5px; color:#999;">➔</span> <span class="real-answer">${ans.correctAnswer}</span>`
                       }
                   </div>
               </div>
           `;
       });


       html += `</div>`;
       app.innerHTML = html;
   }


   // --- LOGIC FUNCTIONS ---
   window.startQuestions = function() {
       state = 'question';
       currentQuestionIndex = 0;
       render();
   };


   window.handleAnswer = function(selectedIndex) {
       // Disable all buttons
       const buttons = document.querySelectorAll('.option-btn');
       buttons.forEach(b => b.disabled = true);


       const section = quizData[currentSectionIndex];
       const currentQ = section.questions[currentQuestionIndex];
       const isCorrect = selectedIndex === currentQ.correct;


       // Visual feedback on buttons
       const selectedBtn = document.getElementById(`opt-${selectedIndex}`);
       const correctBtn = document.getElementById(`opt-${currentQ.correct}`);


       if (isCorrect) {
           selectedBtn.classList.add('correct');
       } else {
           selectedBtn.classList.add('incorrect');
           correctBtn.classList.add('correct'); // Show which one was right
       }


       // Show feedback box
       const feedbackBox = document.getElementById('feedback');
       const feedbackTitle = document.getElementById('feedback-title');
       const feedbackText = document.getElementById('feedback-text');
       const nextBtn = document.getElementById('next-btn');


       feedbackBox.style.display = 'block';
      
       // Add class for success/error styling
       if (isCorrect) {
           feedbackBox.className = "feedback-box success";
           feedbackTitle.innerHTML = "Rätt svar!";
       } else {
           feedbackBox.className = "feedback-box error";
           feedbackTitle.innerHTML = "Inte riktigt...";
       }
      
       feedbackText.innerHTML = currentQ.explanation; // Use innerHTML to render <strong> tags


       // Check if last question of entire quiz
       const isLastQuestionOverall = (currentSectionIndex === quizData.length - 1) && (currentQuestionIndex === section.questions.length - 1);
      
       if(isLastQuestionOverall) {
           nextBtn.innerText = "Se resultat 🏁";
       } else if (currentQuestionIndex === section.questions.length - 1) {
           nextBtn.innerText = "Nästa del ➔";
       }


       // Scroll to feedback if needed on mobile, but gently
       const rect = feedbackBox.getBoundingClientRect();
       const isVisible = (rect.top >= 0) && (rect.bottom <= window.innerHeight);
       if (!isVisible) {
           setTimeout(() => {
               feedbackBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
           }, 100);
       }


       // Save data
       userAnswers.push({
           question: currentQ.q,
           userAnswer: currentQ.options[selectedIndex],
           correctAnswer: currentQ.options[currentQ.correct],
           isCorrect: isCorrect
       });
   };


   window.nextStep = function() {
       const section = quizData[currentSectionIndex];
      
       // Reset feedback styles for next render
       const feedbackBox = document.getElementById('feedback');
       if(feedbackBox) {
           feedbackBox.style.display = 'none';
       }


       // Check if there are more questions in this section
       if (currentQuestionIndex < section.questions.length - 1) {
           currentQuestionIndex++;
           render();
       } else {
           // End of section, move to next section
           if (currentSectionIndex < quizData.length - 1) {
               currentSectionIndex++;
               state = 'intro';
               render();
           } else {
               // End of quiz
               state = 'summary';
               render();
           }
       }
   };


   // --- INIT ---
   render();


</script>


</body>
</html>