<!DOCTYPE html>
<html lang="sv">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Kemiquiz: Materia & Separation (Åk 9)</title>
   <!-- Importerar moderna fonter från Google Fonts -->
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  
   <style>
       :root {
           /* Färgpalett - Orange Tema med Blå Accent */
           --card-bg: #ffffff;
          
           --brand-color: #ef6c00; /* Mörk orange */
           --brand-gradient: linear-gradient(135deg, #ef6c00 0%, #ff9800 100%);
          
           --accent-color: #ffb74d; /* Ljusare orange */
          
           /* Komplementfärg: Blå för kontrast */
           --complement-color: #1565c0;


           --success-color: #2e7d32;
           --success-bg: #e8f5e9;
          
           --error-color: #c62828;
           --error-bg: #ffebee;
          
           --text-main: #212121; /* Mörkare grå/svart för text */
           --text-muted: #616161;
          
           --shadow-card: 0 10px 25px rgba(0,0,0,0.1);
           --shadow-hover: 0 6px 16px rgba(0,0,0,0.12);
           --radius-main: 16px;
       }


       body {
           font-family: 'Open Sans', sans-serif;
           /* Gråaktig fade (Silver/Metallic style) */
           background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
           color: var(--text-main);
           margin: 0;
           padding: 15px;
           display: flex;
           justify-content: center;
           align-items: flex-start;
           min-height: 100vh;
       }


       .container {
           background-color: var(--card-bg);
           width: 100%;
           max-width: 680px;
           border-radius: var(--radius-main);
           box-shadow: var(--shadow-card);
           overflow: hidden;
           display: flex;
           flex-direction: column;
           position: relative;
           margin-top: 3vh;
           margin-bottom: 3vh;
       }


       header {
           background: var(--brand-gradient);
           color: white;
           padding: 20px;
           text-align: center;
           position: relative;
           overflow: hidden;
       }


       h1 {
           font-family: 'Poppins', sans-serif;
           margin: 0;
           font-size: 1.5rem;
           font-weight: 700;
           letter-spacing: -0.3px;
       }


       .content-area {
           padding: 25px 30px;
           flex-grow: 1;
       }


       h2 {
           font-family: 'Poppins', sans-serif;
           color: var(--text-main);
           margin-top: 0;
           font-size: 1.3rem;
           margin-bottom: 0.8rem;
           line-height: 1.3;
       }


       /* Fact Section Styles */
       .fact-box {
           background: #ffffff;
           border: 1px solid #eeeeee; /* Neutral border */
           border-radius: 12px;
           padding: 20px;
           margin-bottom: 20px;
           display: flex;
           gap: 15px;
           align-items: flex-start;
           box-shadow: 0 2px 8px rgba(0,0,0,0.03);
       }
      
       .fact-icon {
           font-size: 2rem;
           display: block;
           margin-top: -5px;
           color: var(--complement-color); /* Blå färg på ikonen */
       }
      
       .fact-content {
           flex: 1;
       }


       .btn {
           background: var(--brand-gradient);
           color: white;
           border: none;
           padding: 12px 24px;
           font-family: 'Poppins', sans-serif;
           font-size: 1rem;
           font-weight: 600;
           border-radius: 8px;
           cursor: pointer;
           transition: all 0.2s ease;
           display: block;
           width: 100%;
           margin-top: 20px;
           box-shadow: 0 4px 10px rgba(239, 108, 0, 0.2);
       }


       .btn:hover {
           transform: translateY(-2px);
           box-shadow: 0 6px 14px rgba(239, 108, 0, 0.3);
           opacity: 0.95;
       }


       /* Question Styles */
       .question-meta {
           display: inline-block;
           color: var(--complement-color); /* Blå färg */
           font-size: 0.85rem;
           margin-bottom: 10px;
           font-weight: 700;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }


       .options-grid {
           display: grid;
           gap: 12px;
           margin-top: 20px;
       }


       .option-btn {
           background-color: #fff;
           border: 2px solid #f5f5f5;
           padding: 15px 20px;
           text-align: left;
           border-radius: 10px;
           cursor: pointer;
           font-family: 'Open Sans', sans-serif;
           font-size: 0.95rem;
           font-weight: 500;
           transition: all 0.15s ease;
           color: var(--text-main);
           position: relative;
       }


       .option-btn:hover:not(:disabled) {
           border-color: var(--accent-color);
           background-color: #fff3e0;
           transform: translateX(3px);
           box-shadow: 0 2px 5px rgba(0,0,0,0.05);
       }
      
       /* Status states for options */
       .option-btn.correct {
           background-color: var(--success-bg);
           border-color: var(--success-color);
           color: #1b5e20;
           font-weight: 600;
       }
      
       .option-btn.correct::after {
           content: "✓";
           position: absolute;
           right: 15px;
           font-weight: bold;
       }


       .option-btn.incorrect {
           background-color: var(--error-bg);
           border-color: var(--error-color);
           color: #b71c1c;
           opacity: 0.8;
       }


       .option-btn:disabled {
           cursor: default;
       }


       /* Feedback Box */
       .feedback-box {
           margin-top: 20px;
           padding: 20px 25px;
           border-radius: 12px;
           background-color: #f9f9f9;
           color: var(--text-main);
           border: 1px solid #e0e0e0;
           display: none;
           animation: fadeIn 0.3s ease;
       }
      
       .feedback-box h3 {
           margin-top: 0;
           font-family: 'Poppins', sans-serif;
           font-size: 1.2rem;
           display: flex;
           align-items: center;
           gap: 8px;
           margin-bottom: 8px;
       }


       .feedback-box.success h3 {
           color: var(--success-color);
       }
      
       .feedback-box.error h3 {
           color: var(--error-color);
       }


       .feedback-box strong {
           color: #000; /* Svarta fetstilade ord */
       }


       @keyframes fadeIn {
           from { opacity: 0; transform: translateY(5px); }
           to { opacity: 1; transform: translateY(0); }
       }


       /* Progress Bar Styles */
       .progress-bar-container {
           height: 6px;
           background-color: #eeeeee;
           width: 100%;
           position: relative;
           z-index: 10;
       }


       .progress-bar {
           height: 100%;
           /* Orange Gradient för att matcha temat */
           background: linear-gradient(90deg, #ffcc80 0%, #ef6c00 100%);
           width: 0%;
           transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
           border-radius: 0 4px 4px 0;
           box-shadow: 0 0 10px rgba(239, 108, 0, 0.5);
       }


       /* Summary Styles */
       .summary-stats {
           text-align: center;
           background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
           border: 1px solid #ffcc80;
           padding: 30px 20px;
           border-radius: 12px;
           margin-bottom: 20px;
       }


       .summary-score {
           font-size: 3.5rem;
           font-family: 'Poppins', sans-serif;
           font-weight: 700;
           display: block;
           margin: 5px 0;
           line-height: 1;
           background: linear-gradient(135deg, #e65100 0%, #fb8c00 100%);
           -webkit-background-clip: text;
           -webkit-text-fill-color: transparent;
       }
      
       .summary-list {
           max-height: 400px;
           overflow-y: auto;
           padding-right: 10px;
       }
      
       .summary-item {
           background: white;
           border-bottom: 1px solid #eeeeee;
           padding: 12px 0;
       }
      
       .summary-item:last-child {
           border-bottom: none;
       }


       .summary-question {
           font-weight: 600;
           margin-bottom: 4px;
           display: block;
           font-size: 0.95rem;
       }
      
       .summary-answer-row {
           font-size: 0.9rem;
       }


       .summary-correct-text { color: var(--success-color); font-weight: 600; }
       .summary-wrong-text { color: var(--error-color); text-decoration: line-through; opacity: 0.8;}
       .real-answer { color: var(--success-color); font-weight: 600; margin-left: 5px; }


       /* Helpers */
       strong {
           color: #000; /* Svarta fetstilade ord */
           font-weight: 700;
       }


   </style>
</head>
<body>


<div class="container">
   <header>
       <h1 id="header-title">Kemiquiz: Materia & Separation</h1>
   </header>
   <div class="progress-bar-container">
       <div class="progress-bar" id="progress-bar"></div>
   </div>


   <div class="content-area" id="app">
       <!-- Content will be injected here by JavaScript -->
   </div>
</div>


<script>
   // --- DATA ---
   const quizData = [
       {
           title: "Del 1: Partikelmodellen och materia",
           icon: "⚛️",
           text: "Enligt <strong>partikelmodellen</strong> är allt runt omkring oss uppbyggt av pyttesmå partiklar (atomer eller molekyler). Dessa befinner sig i ständig rörelse, och <strong>temperatur</strong> är ett mått på hur mycket de rör sig. Vi skiljer på <strong>fysikaliska förändringar</strong>, där ett ämne bara byter fas, och <strong>kemiska reaktioner</strong>, där nya ämnen bildas.",
           questions: [
               {
                   q: "Vad händer med partiklarna i ett ämne när temperaturen ökar?",
                   options: [
                       "De rör sig mer och tar därmed oftast större plats (volym).",
                       "De blir tyngre och sjunker till botten av behållaren.",
                       "Partiklarna förvandlas till nya sorters atomer genom reaktioner.",
                       "De slutar röra sig helt eftersom de når en kritisk punkt."
                   ],
                   correct: 0,
                   explanation: "Temperatur mäter atomernas rörelse; när det blir varmare kräver partiklarna mer volym på grund av <strong>ökad rörelseenergi</strong>."
               },
               {
                   q: "Vilket av följande är ett exempel på en kemisk förändring (reaktion)?",
                   options: [
                       "En sockerbit som långsamt löses upp i en kopp varmt te.",
                       "En bit järnull som brinner och bildar en mörk oxid.",
                       "Vattenånga som kondenserar till droppar på en kall spegel.",
                       "En metallstång som blir längre när den värms upp i solen."
                   ],
                   correct: 1,
                   explanation: "När järnull brinner reagerar järnatomerna med syre och bildar ett helt nytt ämne, <strong>järnoxid</strong>."
               },
               {
                   q: "Vad innebär lagen om 'massans bevarande' vid en reaktion?",
                   options: [
                       "Att energin alltid försvinner ut i atmosfären som värme.",
                       "Att ämnen i gasform alltid väger mer än de i fast form.",
                       "Att vikten före och efter en reaktion i ett slutet rum är lika stor.",
                       "Att antalet molekyler alltid måste vara exakt samma efteråt."
                   ],
                   correct: 2,
                   explanation: "Inga atomer försvinner eller tillkommer; de byter bara plats, vilket innebär att den <strong>totala massan</strong> är densamma."
               }
           ]
       },
       {
           title: "Del 2: Fasövergångar",
           icon: "🧊",
           text: "Materia kan finnas i tre olika <strong>faser</strong>: fast, flytande och gas. När ett ämne byter fas kallas det en <strong>fasövergång</strong>. Ett vanligt exempel är <strong>kondensation</strong> (gas till vätska). För att partiklar ska kunna lämna en vätska och bli gas (<strong>avdunsta</strong>) krävs energi.",
           questions: [
               {
                   q: "Varför bildas det ofta vattendroppar på utsidan av en kallvattenledning i ett varmt badrum?",
                   options: [
                       "För att ledningen läcker små mängder vatten genom metallens porer.",
                       "För att partiklarna i röret rör sig snabbare än de i luften utanför.",
                       "För att vattnet i röret reagerar kemiskt med syret i badrumsluften.",
                       "För att vattenånga kyls ner och vattenmolekylerna rör sig långsammare."
                   ],
                   correct: 3,
                   explanation: "När vattenångan kyls ner förlorar partiklarna rörelseenergi och går från gasfas till flytande form (<strong>kondensation</strong>)."
               },
               {
                   q: "Vad skiljer koldioxidmolekylerna i en gastub (flytande form) från de som släppts ut i luften (gasform)?",
                   options: [
                       "Molekylerna i luften är längre ifrån varandra och rör sig fritt.",
                       "Molekylerna i tuben är mycket tyngre än de som finns i gasen.",
                       "Varje enskild molekyl blir betydligt mindre när den blir till gas.",
                       "Partiklarna i gasform slutar helt att ha bindningar till varandra."
                   ],
                   correct: 0,
                   explanation: "I <strong>gasform</strong> sprids partiklarna ut i hela det tillgängliga utrymmet och har inga fasta positioner."
               },
               {
                   q: "Vilken fasövergång sker när du kokar en blandning av vätskor med olika kokpunkter?",
                   options: [
                       "Sublimering",
                       "Förångning",
                       "Stelning",
                       "Sedimentering"
                   ],
                   correct: 1,
                   explanation: "När en vätska kokas övergår den till gasfas (<strong>förångas</strong>), vilket utnyttjas vid separation."
               }
           ]
       },
       {
           title: "Del 3: Densitet",
           icon: "⚖️",
           text: "<strong>Densitet</strong> anger hur <strong>kompakt</strong> ett ämne är, det vill säga hur mycket massa som ryms på en viss volym. Ett ämne med hög densitet väger mer än ett ämne med låg densitet om volymerna är lika stora.",
           questions: [
               {
                   q: "Du har två kuber som är exakt lika stora. Kub A är gjord av bly och Kub B av aluminium. Varför väger de olika mycket?",
                   options: [
                       "För att Kub A har fler elektronskal än vad Kub B har.",
                       "För att Kub B har en lägre smältpunkt än vad Kub A har.",
                       "För att de har olika densitet (partiklarna sitter olika tätt).",
                       "För att gravitationen påverkar olika metaller på olika sätt."
                   ],
                   correct: 2,
                   explanation: "<strong>Densitet</strong> mäter ett ämnes täthet; olika ämnen har olika mycket massa på samma volym."
               },
               {
                   q: "Hur kan man separera små plastflingor av olika sorter i ett återvinningsverk?",
                   options: [
                       "Genom att använda starka magneter som drar till sig plasten.",
                       "Genom att tillsätta enzymer som klipper sönder de tyngsta bitarna.",
                       "Genom att koka dem tills de alla förångas vid olika temperaturer.",
                       "Genom att lägga dem i vattenbad där de flyter eller sjunker."
                   ],
                   correct: 3,
                   explanation: "Olika plaster har olika <strong>densitet</strong>; genom att använda vätskor kan man få vissa att flyta och andra att sjunka."
               }
           ]
       },
       {
           title: "Del 4: Blandningar",
           icon: "🧪",
           text: "En <strong>blandning</strong> består av ämnen som inte reagerat kemiskt. I en <strong>lösning</strong> är ämnena helt uppdelade. Om man inte kan lösa mer är lösningen <strong>mättad</strong>. Andra typer är <strong>uppslamningar</strong> (fasta bitar i vätska) och <strong>emulsioner</strong> (t.ex. olja och vatten). En <strong>legering</strong> är en blandning av metaller, och en <strong>aerosol</strong> är partiklar i gas.",
           questions: [
               {
                   q: "Vad kallas det när du skakar olja och vatten så att oljan bildar små droppar i vattnet, men sedan lägger sig i ett lager på toppen igen?",
                   options: [
                       "Emulsion",
                       "Legering",
                       "Aerosol",
                       "Lösning"
                   ],
                   correct: 0,
                   explanation: "En <strong>emulsion</strong> är en blandning av två vätskor som egentligen inte löser sig i varandra, likt dressing."
               },
               {
                   q: "Vad kännetecknar en mättad sockerlösning?",
                   options: [
                       "Allt socker har förvandlats till flytande koldioxid och vatten.",
                       "Det går inte att lösa mer socker i den aktuella temperaturen.",
                       "Lösningen leder nu ström på grund av de fria sockerjonerna.",
                       "Sockermolekylerna har reagerat och bildat en mörk fällning."
                   ],
                   correct: 1,
                   explanation: "En lösning är <strong>mättad</strong> när vätskan inte längre kan hålla isär fler partiklar av det lösta ämnet."
               },
               {
                   q: "Vilken typ av blandning är svenska mynt gjorda av?",
                   options: [
                       "Emulsioner",
                       "Uppslamningar",
                       "Legeringar",
                       "Aerosoler"
                   ],
                   correct: 2,
                   explanation: "En <strong>legering</strong> är en blandning av två eller flera sammansmälta metaller."
               },
               {
                   q: "Vad är en aerosol ett exempel på?",
                   options: [
                       "Socker löst i varmt te.",
                       "Matolja och vinäger.",
                       "Brons (koppar och tenn).",
                       "Rök eller dimma i luft."
                   ],
                   correct: 3,
                   explanation: "En <strong>aerosol</strong> består av små partiklar (fasta eller flytande) som är blandade i en gas."
               }
           ]
       },
       {
           title: "Del 5: Lika löser lika (Polaritet)",
           icon: "🧲",
           text: "Vatten är en <strong>polär</strong> molekyl (har + och - sida). Ett viktigt begrepp är <strong>'lika löser lika'</strong>: polära ämnen (som socker) löser sig i polära lösningsmedel (som vatten), medan <strong>opolära</strong> ämnen (som fett) löser sig i opolära lösningsmedel.",
           questions: [
               {
                   q: "Varför kan man inte tvätta bort en oljebaserad färgfläck med bara vanligt kranvatten?",
                   options: [
                       "För att vattenmolekyler är för små för att bära bort färgpartiklar.",
                       "För att färgen och vattnet har olika egenskaper (opolär vs polär).",
                       "För att vattnet reagerar med färgen och bildar ett hårdare lager.",
                       "För att densiteten hos vatten är för låg för att tränga in i fläcken."
                   ],
                   correct: 1,
                   explanation: "Oljebaserad färg är <strong>opolär</strong> och vatten är polärt; enligt regeln 'lika löser lika' krävs ett opolärt lösningsmedel."
               },
               {
                   q: "Om en morot lämnar en orange fläck på en skärbräda, varför går den fläcken ofta lättare bort om man gnider med lite matolja?",
                   options: [
                       "För att matoljan fräter bort det översta lagret av skärbrädan.",
                       "För att oljans höga densitet trycker ut färgämnet ur träet.",
                       "För att färgämnet i moroten liknar oljemolekylerna (långa kolkedjor).",
                       "För att oljan kokar bort färgämnet genom en endoterm reaktion."
                   ],
                   correct: 2,
                   explanation: "Färgämnet i morötter består av molekyler med långa kolkedjor som påminner om fettmolekyler (<strong>opolära</strong>), och löser sig därför i olja."
               },
               {
                   q: "Vad innebär det att en vattenmolekyl är polär?",
                   options: [
                       "Att den bara kan existera vid jordens nordpol eller sydpol.",
                       "Att den har en jämn fördelning av elektrisk laddning i hela molekylen.",
                       "Att molekylen har en positiv sida och en negativ sida.",
                       "Att den alltid dras till metaller genom metallbindningar."
                   ],
                   correct: 2,
                   explanation: "Vattenmolekylens vinklade form gör att laddningarna hamnar på olika ställen, vilket ger den dess unika <strong>polära</strong> egenskaper."
               }
           ]
       },
       {
           title: "Del 6: Separationsmetoder",
           icon: "⚗️",
           text: "För att dela upp blandningar används olika metoder: <strong>Filtrering</strong> (skiljer fast från flytande), <strong>Sedimentering</strong> (partiklar sjunker), <strong>Indunstning</strong> (vätskan dunstar), <strong>Destillation</strong> (kokning/kondensering), <strong>Centrifugering</strong> (snabb rotation) och <strong>Dekantering</strong> (hälla av).",
           questions: [
               {
                   q: "Vilken metod är bäst om du vill få fram rent dricksvatten ur saltvatten och vill spara både saltet och vattnet?",
                   options: [
                       "Filtrering genom papper.",
                       "Sedimentering i bägare.",
                       "Indunstning i solen.",
                       "Destillation genom kokning."
                   ],
                   correct: 3,
                   explanation: "Vid <strong>destillation</strong> kokas vattnet till ånga (som tas tillvara och kyls ner) medan saltet blir kvar."
               },
               {
                   q: "Vad kallas det när man häller av vätskan försiktigt efter att fasta partiklar sjunkit till botten i en bägare?",
                   options: [
                       "Dekantering",
                       "Destillering",
                       "Kondensering",
                       "Polymerisering"
                   ],
                   correct: 0,
                   explanation: "Att <strong>dekantera</strong> innebär att man försiktigt häller av vätskan från en fällning eller ett sediment."
               },
               {
                   q: "Hur kan man få bort grumlig lera från ett vattenprov för att göra det klart, men inte nödvändigtvis drickbart?",
                   options: [
                       "Genom att tillsätta socker som binder leran.",
                       "Genom att använda kolsyra som löser upp leran.",
                       "Genom att låta vattnet rinna genom ett filter.",
                       "Genom att frysa vattnet så att leran fastnar i isen."
                   ],
                   correct: 2,
                   explanation: "<strong>Filtrering</strong> (eller sedimentering) tar bort de fasta partiklarna som gör vattnet grumligt."
               },
               {
                   q: "När används metoden indunstning i vardagen?",
                   options: [
                       "När man torkar tvätt eller låter vatten försvinna från ett saltbad.",
                       "När man separerar grädde från mjölk i en stor roterande trumma.",
                       "När man blandar saftkoncentrat med vatten för att få rätt smak.",
                       "När man kokar kaffe och låter bönorna ligga kvar i filtret."
                   ],
                   correct: 0,
                   explanation: "Vid <strong>indunstning</strong> får vätskan (vattnet) dunsta bort medan de fasta ämnena blir kvar."
               },
               {
                   q: "Varför används centrifugering vid t.ex. blodprov?",
                   options: [
                       "För att döda farliga bakterier med hjälp av hög värme.",
                       "För att blanda ut blodet med syre så att det ändrar färg.",
                       "För att balansera pH-värdet så att provet blir neutralt.",
                       "För att skilja tunga och lätta delar genom snabb rotation."
                   ],
                   correct: 3,
                   explanation: "<strong>Centrifugen</strong> fungerar som en karusell där de tyngre partiklarna pressas utåt/nedåt mer än de lätta."
               }
           ]
       }
   ];


   // --- STATE MANAGEMENT ---
   let currentSectionIndex = 0;
   let currentQuestionIndex = 0; // Relative to current section
   let score = 0;
   let userAnswers = [];
   let state = 'intro'; // 'intro', 'question', 'summary'


   // --- DOM ELEMENTS ---
   const app = document.getElementById('app');
   const headerTitle = document.getElementById('header-title');
   const progressBar = document.getElementById('progress-bar');


   // --- MAIN RENDER FUNCTION ---
   function render() {
       if (state === 'summary') {
           renderSummary();
           return;
       }


       const section = quizData[currentSectionIndex];


       // Update Header with smooth fade
       headerTitle.style.opacity = '0';
       setTimeout(() => {
           headerTitle.innerText = section.title;
           headerTitle.style.transition = 'opacity 0.2s';
           headerTitle.style.opacity = '1';
       }, 150);


       // Calculate total progress
       let totalQuestions = 0;
       let answeredQuestions = 0;
      
       quizData.forEach((sec, idx) => {
           totalQuestions += sec.questions.length;
           if (idx < currentSectionIndex) {
               answeredQuestions += sec.questions.length;
           } else if (idx === currentSectionIndex && state === 'question') {
               answeredQuestions += currentQuestionIndex;
           }
       });
       const pct = (answeredQuestions / totalQuestions) * 100;
       progressBar.style.width = `${pct}%`;


       if (state === 'intro') {
           renderSectionIntro(section);
       } else if (state === 'question') {
           renderQuestion(section.questions[currentQuestionIndex]);
       }
   }


   // --- RENDER SECTION TEXT ---
   function renderSectionIntro(section) {
       // Simple animation class reset
       app.classList.remove('fade-in');
       void app.offsetWidth; // trigger reflow
       app.classList.add('fade-in');


       app.innerHTML = `
           <div class="fact-box">
               <span class="fact-icon">${section.icon}</span>
               <div class="fact-content">
                   <h2>Fakta</h2>
                   <p style="line-height: 1.6; font-size: 1rem; margin-top:0;">${section.text}</p>
               </div>
           </div>
           <button class="btn" onclick="startQuestions()">Starta frågor för denna del</button>
       `;
   }


   // --- RENDER QUESTION ---
   function renderQuestion(q) {
       const totalInCurrent = quizData[currentSectionIndex].questions.length;
      
       // Render with reset styles for feedback box
       app.innerHTML = `
           <div class="question-meta">Del ${currentSectionIndex + 1} • Fråga ${currentQuestionIndex + 1}/${totalInCurrent}</div>
           <h2 style="color: var(--text-main); font-weight: 600; margin-bottom:15px;">${q.q}</h2>
           <div class="options-grid">
               ${q.options.map((opt, idx) => `
                   <button class="option-btn" onclick="handleAnswer(${idx})" id="opt-${idx}">${opt}</button>
               `).join('')}
           </div>
           <div id="feedback" class="feedback-box">
               <h3 id="feedback-title"></h3>
               <p id="feedback-text" style="margin: 5px 0 15px 0; font-size: 0.95rem; line-height: 1.6;"></p>
               <button class="btn" id="next-btn" onclick="nextStep()" style="margin-top:0; width: auto; min-width: 150px;">Nästa fråga ➔</button>
           </div>
       `;
   }


   // --- RENDER SUMMARY ---
   function renderSummary() {
       headerTitle.innerText = "Sammanfattning";
       progressBar.style.width = '100%';
      
       let totalQ = 0;
       quizData.forEach(s => totalQ += s.questions.length);
      
       // Calculate score
       let correctCount = userAnswers.filter(a => a.isCorrect).length;
       let pct = Math.round((correctCount / totalQ) * 100);
      
       let gradeTitle = "";
      
       if(pct > 90) { gradeTitle = "Fantastiskt bra! 🏆"; }
       else if(pct > 70) { gradeTitle = "Mycket bra jobbat! 🌟"; }
       else if(pct > 50) { gradeTitle = "Godkänt! 👍"; }
       else { gradeTitle = "Fortsätt kämpa! 💪"; }


       let html = `
           <div class="summary-stats">
               <h2 style="color:var(--brand-color); margin:0 0 10px 0;">${gradeTitle}</h2>
               <span class="summary-score">${correctCount}/${totalQ}</span>
               <span style="color:#666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Rätt svar</span>
               <button class="btn" onclick="location.reload()" style="background: transparent; border: 2px solid var(--accent-color); color: var(--accent-color); margin-top: 20px; box-shadow:none; width: auto; padding: 10px 30px;">Gör om testet</button>
           </div>
           <h3 style="margin: 0 0 10px 0; font-size: 1.1rem; color: var(--text-muted);">Dina svar:</h3>
           <div class="summary-list">
       `;


       userAnswers.forEach((ans, idx) => {
           const isCorrect = ans.isCorrect;
          
           html += `
               <div class="summary-item">
                   <span class="summary-question">${idx + 1}. ${ans.question}</span>
                   <div class="summary-answer-row">
                       ${isCorrect
                           ? `<span class="summary-correct-text">✔ ${ans.userAnswer}</span>`
                           : `<span class="summary-wrong-text">✖ ${ans.userAnswer}</span> <span style="margin: 0 5px; color:#999;">➔</span> <span class="real-answer">${ans.correctAnswer}</span>`
                       }
                   </div>
               </div>
           `;
       });


       html += `</div>`;
       app.innerHTML = html;
   }


   // --- LOGIC FUNCTIONS ---
   window.startQuestions = function() {
       state = 'question';
       currentQuestionIndex = 0;
       render();
   };


   window.handleAnswer = function(selectedIndex) {
       // Disable all buttons
       const buttons = document.querySelectorAll('.option-btn');
       buttons.forEach(b => b.disabled = true);


       const section = quizData[currentSectionIndex];
       const currentQ = section.questions[currentQuestionIndex];
       const isCorrect = selectedIndex === currentQ.correct;


       // Visual feedback on buttons
       const selectedBtn = document.getElementById(`opt-${selectedIndex}`);
       const correctBtn = document.getElementById(`opt-${currentQ.correct}`);


       if (isCorrect) {
           selectedBtn.classList.add('correct');
       } else {
           selectedBtn.classList.add('incorrect');
           correctBtn.classList.add('correct'); // Show which one was right
       }


       // Show feedback box
       const feedbackBox = document.getElementById('feedback');
       const feedbackTitle = document.getElementById('feedback-title');
       const feedbackText = document.getElementById('feedback-text');
       const nextBtn = document.getElementById('next-btn');


       feedbackBox.style.display = 'block';
      
       // Add class for success/error styling
       if (isCorrect) {
           feedbackBox.className = "feedback-box success";
           feedbackTitle.innerHTML = "Rätt svar!";
       } else {
           feedbackBox.className = "feedback-box error";
           feedbackTitle.innerHTML = "Inte riktigt...";
       }
      
       feedbackText.innerHTML = currentQ.explanation; // Use innerHTML to render <strong> tags


       // Check if last question of entire quiz
       const isLastQuestionOverall = (currentSectionIndex === quizData.length - 1) && (currentQuestionIndex === section.questions.length - 1);
      
       if(isLastQuestionOverall) {
           nextBtn.innerText = "Se resultat 🏁";
       } else if (currentQuestionIndex === section.questions.length - 1) {
           nextBtn.innerText = "Nästa del ➔";
       }


       // Scroll to feedback if needed on mobile, but gently
       const rect = feedbackBox.getBoundingClientRect();
       const isVisible = (rect.top >= 0) && (rect.bottom <= window.innerHeight);
       if (!isVisible) {
            setTimeout(() => {
               feedbackBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
           }, 100);
       }


       // Save data
       userAnswers.push({
           question: currentQ.q,
           userAnswer: currentQ.options[selectedIndex],
           correctAnswer: currentQ.options[currentQ.correct],
           isCorrect: isCorrect
       });
   };


   window.nextStep = function() {
       const section = quizData[currentSectionIndex];
      
       // Reset feedback styles for next render
       const feedbackBox = document.getElementById('feedback');
       if(feedbackBox) {
           feedbackBox.style.display = 'none';
       }


       // Check if there are more questions in this section
       if (currentQuestionIndex < section.questions.length - 1) {
           currentQuestionIndex++;
           render();
       } else {
           // End of section, move to next section
           if (currentSectionIndex < quizData.length - 1) {
               currentSectionIndex++;
               state = 'intro';
               render();
           } else {
               // End of quiz
               state = 'summary';
               render();
           }
       }
   };


   // --- INIT ---
   render();


</script>


</body>
</html>